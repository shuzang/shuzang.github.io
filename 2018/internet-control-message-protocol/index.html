<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>计算机网络-ICMP协议 - Shuzang's Blog</title><meta name=author content><meta name=author-link content><meta name=description content="网络层除了主要的 IP 协议外，还有 ICMP（Internet Control Message Protocol） 协议，ping 和 traceroute 都会用到它，本文进行介绍。"><meta name=keywords content="计算机基础"><meta itemprop=name content="计算机网络-ICMP协议"><meta itemprop=description content="网络层除了主要的 IP 协议外，还有 ICMP（Internet Control Message Protocol） 协议，ping 和 traceroute 都会用到它，本文进行介绍。"><meta itemprop=datePublished content="2018-10-01T00:00:00+00:00"><meta itemprop=dateModified content="2020-08-20T00:00:00+00:00"><meta itemprop=wordCount content="2683"><meta itemprop=image content="https://shuzang.github.io/logo.png"><meta itemprop=keywords content="计算机基础,"><meta property="og:title" content="计算机网络-ICMP协议"><meta property="og:description" content="网络层除了主要的 IP 协议外，还有 ICMP（Internet Control Message Protocol） 协议，ping 和 traceroute 都会用到它，本文进行介绍。"><meta property="og:type" content="article"><meta property="og:url" content="https://shuzang.github.io/2018/internet-control-message-protocol/"><meta property="og:image" content="https://shuzang.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-20T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shuzang.github.io/logo.png"><meta name=twitter:title content="计算机网络-ICMP协议"><meta name=twitter:description content="网络层除了主要的 IP 协议外，还有 ICMP（Internet Control Message Protocol） 协议，ping 和 traceroute 都会用到它，本文进行介绍。"><meta name=application-name content="Shuzang's Blog"><meta name=apple-mobile-web-app-title content="Shuzang's Blog"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://shuzang.github.io/2018/internet-control-message-protocol/><link rel=prev href=https://shuzang.github.io/2018/%E8%87%AA%E7%84%B6%E8%BE%A9%E8%AF%81%E6%B3%95/><link rel=next href=https://shuzang.github.io/2018/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%AE%A1%E7%90%86%E4%B8%96%E7%95%8C/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://unpkg.com/@fortawesome/fontawesome-free@6.2.0/css/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.2.0/css/all.min.css></noscript><link rel=preload href=https://unpkg.com/animate.css@4.1.1/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"计算机网络-ICMP协议","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shuzang.github.io\/2018\/internet-control-message-protocol\/"},"genre":"posts","keywords":"计算机基础","wordcount":2683,"url":"https:\/\/shuzang.github.io\/2018\/internet-control-message-protocol\/","datePublished":"2018-10-01T00:00:00+00:00","dateModified":"2020-08-20T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"作者"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/avatar.png data-title="Shuzang's Blog" data-alt="Shuzang's Blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collection/><i class="fa-solid fa-bookmark fa-fw fa-sm" aria-hidden=true></i> 集子</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/avatar.png data-title=https://picped-1301226557.cos.ap-beijing.myqcloud.com/avatar.png data-alt=https://picped-1301226557.cos.ap-beijing.myqcloud.com/avatar.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collection/><i class="fa-solid fa-bookmark fa-fw fa-sm" aria-hidden=true></i> 集子</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>计算机网络-ICMP协议</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i></span></span>
<span class=post-category>收录于 <a href=/categories/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 爱编程爱技术的孩子</a></span></div><div class=post-meta-line><span title="发布于 2018-10-01 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2018-10-01>2018-10-01</time></span>&nbsp;<span title="更新于 2020-08-20 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2020-08-20>2020-08-20</time></span>&nbsp;<span title="2683 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2700 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 6 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-icmp>1. ICMP</a></li><li><a href=#2-traceroute>2. Traceroute</a></li><li><a href=#3-ping>3. Ping</a><ul><li><a href=#31-原理>3.1 原理</a></li><li><a href=#32-c语言实现>3.2 C语言实现</a></li></ul></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden=true></i>警告<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>本文最后更新于 2020-08-20，文中内容可能已过时。</div></div></div><p>网络层除了主要的 IP 协议外，还有 ICMP（Internet Control Message Protocol） 协议，ping 和 traceroute 都会用到它，本文进行介绍。</p><h2 id=1-icmp>1. ICMP</h2><p>网际控制报文协议 ICMP，目的是更有效的转发 IP 数据报，提高交付成功的机会。通常被主机或路由器用来报告差错情况和提供有关异常情况的报告。</p><p>ICMP 虽然是网络层协议，但其报文是作为 IP 数据报的数据部分传输的。ICMP 的报文格式如下</p><p><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_191.jpg srcset="https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_191.jpg?size=small, https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_191.jpg?size=medium 1.5x, https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_191.jpg?size=large 2x" sizes=auto data-title=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_191.jpg data-alt=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_191.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>ICMP 报文有两种：差错报告报文和询问报文，报文的前四字节是统一的格式，有三个字段：类型、代码和检验和，后面四个字节与类型有关，随后就是数据部分。下表给出几种常用的报文类型</p><p><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_192.jpg srcset="https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_192.jpg?size=small, https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_192.jpg?size=medium 1.5x, https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_192.jpg?size=large 2x" sizes=auto data-title=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_192.jpg data-alt=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_192.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>代码字段是为了进一步区分某种类型的几种不同情况，比如类型12，又可以分为下面两种</p><table><thead><tr><th>类型</th><th>代码</th><th>描述</th></tr></thead><tbody><tr><td>12</td><td>0</td><td>IP header bad (catchall error)——坏的IP首部（包括各种差错）</td></tr><tr><td>12</td><td>1</td><td>Required options missing——缺少必需的选项</td></tr></tbody></table><p>校验和字段用来检验整个 ICMP 报文，因为 IP 数据报首部的校验和并不检验 IP 数据报的数据部分，不能保证传输的 ICMP 报文不产生差错。</p><p>所有的 ICMP 差错报告报文中的数据字段都具有相同的格式，把收到的需要进行差错报告的 IP 数据报的首部和数据字段的前 8 个字节提取出来作为 ICMP 报文的数据字段，然后添加 ICMP 首部，就构成了 ICMP 差错报告报文。如下图</p><p><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_193.jpg srcset="https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_193.jpg?size=small, https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_193.jpg?size=medium 1.5x, https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_193.jpg?size=large 2x" sizes=auto data-title=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_193.jpg data-alt=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_epub_655484_193.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>提取收到的数据报的数据字段前 8 个字节是为了得到运输层的端口号以及运输层报文的发送序号，这些信息对源点通知高层协议是有用的。</p><p>常用的 ICMP 询问报文有两种</p><ol><li><strong>回送请求和回答</strong>： ICMP回送请求报文是由主机或路由器向一个特定的目的主机发出的询问。收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。这种询问报文用来测试目的站是否可达以及了解其有关状态。</li><li><strong>时间戳请求和回答</strong>：ICMP时间戳请求报文是请某个主机或路由器回答当前的日期和时间。在ICMP时间戳回答报文中有一个32位的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。时间戳请求与回答可用来进行时钟同步和测量时间。</li></ol><h2 id=2-traceroute>2. Traceroute</h2><p>ICMP 的一个很有用的应用是 traceroute，用来跟踪一个分组从源点到终点的路径，Windows 系统中 命令为 tracert。原理如下：</p><p>Traceroute从源主机向目的主机发送一连串的 IP 数据报，数据报中封装的是无法交付的 UDP 用户数据报（使用非法端口）。第一个数据报 P1 的生存时间 TTL 设置为1。当 P1 到达路径上的第一个路由器 R1 时，路由器 R1 先收下它，接着把 TTL 的值减1。由于 TTL 等于零了，R1 就把 P1 丢弃了，并向源主机发送一个ICMP<strong>时间超过</strong>差错报告报文。</p><p>源主机接着发送第二个数据报 P2，并把 TTL 设置为 2。P2 先到达路由器 R1，R1 收下后把 TTL 减1再转发给路由器 R2。R2 收到 P2 时 TTL 为1，但减1后 TTL 变为零了。R2 就丢弃 P2，并向源主机发送一个 ICMP 时间超过差错报告报文。这样一直继续下去。当最后一个数据报刚刚到达目的主机时，数据报的 TTL 是1。主机不转发数据报，也不把 TTL 值减1。但因IP数据报中封装的是无法交付的运输层的 UDP 用户数据报，因此目的主机要向源主机发送 ICMP 终点不可达差错报告报文。</p><p>这样，源主机达到了自己的目的，因为这些路由器和最后目的主机发来的 ICMP 报文正好给出了源主机想知道的路由信息——到达目的主机所经过的路由器的IP地址，以及到达其中的每一个路由器的往返时间。下面是向 baidu.com 发出 tracert 命令后得到的结果</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>&gt;</span> <span class=n>tracert</span> <span class=n>www</span><span class=p>.</span><span class=py>baidu</span><span class=p>.</span><span class=py>com</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>通过最多</span> <span class=mf>30</span> <span class=n>个跃点跟踪</span>
</span></span><span class=line><span class=cl><span class=n>到</span> <span class=n>www</span><span class=p>.</span><span class=py>a</span><span class=p>.</span><span class=py>shifen</span><span class=p>.</span><span class=py>com</span> <span class=p>[</span><span class=mf>61.135</span><span class=p>.</span><span class=py>169</span><span class=p>.</span><span class=mf>121</span><span class=p>]</span> <span class=n>的路由</span><span class=err>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=mf>1</span>     <span class=mf>1</span> <span class=n>ms</span>    <span class=p>&lt;</span><span class=mf>1</span> <span class=n>毫秒</span>   <span class=p>&lt;</span><span class=mf>1</span> <span class=n>毫秒</span> <span class=n>laptop</span> <span class=p>[</span><span class=mf>192.168</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=mf>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=mf>2</span>     <span class=mf>6</span> <span class=n>ms</span>     <span class=mf>6</span> <span class=n>ms</span>     <span class=mf>3</span> <span class=n>ms</span>  <span class=mf>1.28</span><span class=p>.</span><span class=py>220</span><span class=p>.</span><span class=py>60</span><span class=p>.</span><span class=nb>adsl-pool</span><span class=p>.</span><span class=py>sx</span><span class=p>.</span><span class=py>cn</span> <span class=p>[</span><span class=mf>60.220</span><span class=p>.</span><span class=py>28</span><span class=p>.</span><span class=mf>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=mf>3</span>    <span class=mf>21</span> <span class=n>ms</span>    <span class=mf>18</span> <span class=n>ms</span>     <span class=mf>5</span> <span class=n>ms</span>  <span class=mf>201.5</span><span class=p>.</span><span class=py>220</span><span class=p>.</span><span class=py>60</span><span class=p>.</span><span class=nb>adsl-pool</span><span class=p>.</span><span class=py>sx</span><span class=p>.</span><span class=py>cn</span> <span class=p>[</span><span class=mf>60.220</span><span class=p>.</span><span class=py>5</span><span class=p>.</span><span class=mf>201</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=mf>4</span>    <span class=mf>36</span> <span class=n>ms</span>    <span class=mf>14</span> <span class=n>ms</span>    <span class=mf>13</span> <span class=n>ms</span>  <span class=mf>253.8</span><span class=p>.</span><span class=py>220</span><span class=p>.</span><span class=py>60</span><span class=p>.</span><span class=nb>adsl-pool</span><span class=p>.</span><span class=py>sx</span><span class=p>.</span><span class=py>cn</span> <span class=p>[</span><span class=mf>60.220</span><span class=p>.</span><span class=py>8</span><span class=p>.</span><span class=mf>253</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=mf>5</span>    <span class=mf>18</span> <span class=n>ms</span>    <span class=mf>22</span> <span class=n>ms</span>     <span class=p>*</span>     <span class=mf>219.158</span><span class=p>.</span><span class=py>11</span><span class=p>.</span><span class=py>113</span>
</span></span><span class=line><span class=cl>  <span class=mf>6</span>    <span class=mf>48</span> <span class=n>ms</span>     <span class=p>*</span>       <span class=mf>26</span> <span class=n>ms</span>  <span class=mf>124.65</span><span class=p>.</span><span class=py>194</span><span class=p>.</span><span class=py>158</span>
</span></span><span class=line><span class=cl>  <span class=mf>7</span>    <span class=mf>86</span> <span class=n>ms</span>    <span class=mf>36</span> <span class=n>ms</span>    <span class=mf>22</span> <span class=n>ms</span>  <span class=mf>124.65</span><span class=p>.</span><span class=py>58</span><span class=p>.</span><span class=py>54</span>
</span></span><span class=line><span class=cl>  <span class=mf>8</span>    <span class=mf>64</span> <span class=n>ms</span>    <span class=mf>22</span> <span class=n>ms</span>    <span class=mf>21</span> <span class=n>ms</span>  <span class=mf>123.125</span><span class=p>.</span><span class=py>248</span><span class=p>.</span><span class=py>46</span>
</span></span><span class=line><span class=cl>  <span class=mf>9</span>     <span class=p>*</span>        <span class=p>*</span>        <span class=p>*</span>     <span class=n>请求超时</span><span class=err>。</span>
</span></span><span class=line><span class=cl> <span class=mf>10</span>     <span class=p>*</span>        <span class=p>*</span>        <span class=p>*</span>     <span class=n>请求超时</span><span class=err>。</span>
</span></span><span class=line><span class=cl> <span class=mf>11</span>    <span class=mf>25</span> <span class=n>ms</span>    <span class=mf>18</span> <span class=n>ms</span>    <span class=mf>75</span> <span class=n>ms</span>  <span class=mf>61.135</span><span class=p>.</span><span class=py>169</span><span class=p>.</span><span class=py>121</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>跟踪完成</span><span class=err>。</span></span></span></code></pre></td></tr></table></div></div><h2 id=3-ping>3. Ping</h2><p>ICMP 的另一个重要应用是分组网间探测 PING (Packet InterNetGroper)，用来测试两个主机之间的连通性。Ping 主要使用 ICMP 回送请求和回送回答报文，这是应用层直接使用网络层 ICMP 的一个例子，没有通过运输层的 TCP 或 UDP。</p><h3 id=31-原理>3.1 原理</h3><p>下面是向 baidu.com 发出的 Ping 请求，计算机连续发出了四个 ICMP 回送请求报文，目标服务器收到后，就返回 ICMP 回收回答报文，往返的 ICMP 报文上都有时间戳，因此很容易得出往返时间。最后会显示出统计结果：发送到哪个机器（IP地址），发送的、收到的和丢失的分组数（但不给出分组丢失的原因），往返时间的最小值、最大值和平均值。</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>&gt;</span>  <span class=n>ping</span> <span class=n>baidu</span><span class=p>.</span><span class=py>com</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>正在</span> <span class=n>Ping</span> <span class=n>baidu</span><span class=p>.</span><span class=py>com</span> <span class=p>[</span><span class=mf>39.156</span><span class=p>.</span><span class=py>69</span><span class=p>.</span><span class=mf>79</span><span class=p>]</span> <span class=n>具有</span> <span class=mf>32</span> <span class=n>字节的数据</span><span class=err>:</span>
</span></span><span class=line><span class=cl><span class=n>来自</span> <span class=mf>39.156</span><span class=p>.</span><span class=py>69</span><span class=p>.</span><span class=py>79</span> <span class=n>的回复</span><span class=err>:</span> <span class=n>字节</span><span class=p>=</span><span class=mf>32</span> <span class=n>时间</span><span class=p>=</span><span class=n>34ms</span> <span class=n>TTL</span><span class=p>=</span><span class=mf>48</span>
</span></span><span class=line><span class=cl><span class=n>来自</span> <span class=mf>39.156</span><span class=p>.</span><span class=py>69</span><span class=p>.</span><span class=py>79</span> <span class=n>的回复</span><span class=err>:</span> <span class=n>字节</span><span class=p>=</span><span class=mf>32</span> <span class=n>时间</span><span class=p>=</span><span class=n>54ms</span> <span class=n>TTL</span><span class=p>=</span><span class=mf>48</span>
</span></span><span class=line><span class=cl><span class=n>来自</span> <span class=mf>39.156</span><span class=p>.</span><span class=py>69</span><span class=p>.</span><span class=py>79</span> <span class=n>的回复</span><span class=err>:</span> <span class=n>字节</span><span class=p>=</span><span class=mf>32</span> <span class=n>时间</span><span class=p>=</span><span class=n>49ms</span> <span class=n>TTL</span><span class=p>=</span><span class=mf>48</span>
</span></span><span class=line><span class=cl><span class=n>来自</span> <span class=mf>39.156</span><span class=p>.</span><span class=py>69</span><span class=p>.</span><span class=py>79</span> <span class=n>的回复</span><span class=err>:</span> <span class=n>字节</span><span class=p>=</span><span class=mf>32</span> <span class=n>时间</span><span class=p>=</span><span class=n>37ms</span> <span class=n>TTL</span><span class=p>=</span><span class=mf>48</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>39.156</span><span class=p>.</span><span class=py>69</span><span class=p>.</span><span class=py>79</span> <span class=n>的</span> <span class=n>Ping</span> <span class=n>统计信息</span><span class=err>:</span>
</span></span><span class=line><span class=cl>    <span class=n>数据包</span><span class=err>:</span> <span class=n>已发送</span> <span class=p>=</span> <span class=mf>4</span><span class=err>，</span><span class=n>已接收</span> <span class=p>=</span> <span class=mf>4</span><span class=err>，</span><span class=n>丢失</span> <span class=p>=</span> <span class=mf>0</span> <span class=p>(</span><span class=mf>0</span><span class=p>%</span> <span class=n>丢失</span><span class=p>)</span><span class=err>，</span>
</span></span><span class=line><span class=cl><span class=n>往返行程的估计时间</span><span class=p>(</span><span class=n>以毫秒为单位</span><span class=p>)</span><span class=err>:</span>
</span></span><span class=line><span class=cl>    <span class=n>最短</span> <span class=p>=</span> <span class=n>34ms</span><span class=err>，</span><span class=n>最长</span> <span class=p>=</span> <span class=n>54ms</span><span class=err>，</span><span class=n>平均</span> <span class=p>=</span> <span class=n>43ms</span></span></span></code></pre></td></tr></table></div></div><p>注：在 Linux 下，ping 命令会持续不断地发出 ICMP 回送请求报文，而不是发 4 个就停止，需要手动给出停止信号。</p><h3 id=32-c语言实现>3.2 C语言实现</h3><p>下面给出一个使用 C 语言的 Ping 命令实现，主要使用 RAW 模式的 SOCKET 编程，因为基于 UDP 的 socket 编程和基于 TCP 的 socket 编程都无法对下一层（网络层）的数据包进行操作。</p><p><strong>所用的API函数</strong></p><table><thead><tr><th>功能</th><th>函数</th></tr></thead><tbody><tr><td>创建socket</td><td>socket(af, type, protocol)</td></tr><tr><td>关闭socket</td><td>closesocket(socket)</td></tr><tr><td>发送数据</td><td>sendto(s, buf, len, flags, to, tolen)</td></tr><tr><td>接收数据</td><td>recvfrom(s, buf, len, flags, from, fromlen)</td></tr><tr><td>将域名翻译为IP</td><td>gethostbyname(name)</td></tr><tr><td>将IP转换为点分十进制格式</td><td>Inet_ntoa(ip)</td></tr><tr><td>WSAStartupWSACleanup</td><td>其它socket函数使用前和使用后用这两个</td></tr></tbody></table><p>ICMP数据头结构定义如下</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=n>_ihdr</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=n>BYTE</span> <span class=n>i_type</span><span class=p>;</span>      <span class=c1>//类型
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=n>BYTE</span> <span class=n>i_code</span><span class=p>;</span>      <span class=c1>//代码
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=n>USHORT</span> <span class=n>i_cksum</span><span class=p>;</span>      <span class=c1>//校验和
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=n>USHORT</span> <span class=n>i_id</span><span class=p>;</span>      <span class=c1>//标识符
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=n>USHORT</span> <span class=n>i_seq</span><span class=p>;</span>      <span class=c1>//序号
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=cm>/* 下面的时间戳不是标准ICMP头部，这个程序里是为了容易计算世界定义的 */</span>
</span></span><span class=line><span class=cl>   <span class=n>ULONG</span> <span class=n>timestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>IcmpHeader</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>IP数据包头结构定义如下</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=n>iphdr</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>unsigned</span> <span class=kt>char</span> <span class=nl>h_len</span> <span class=p>:</span> <span class=mi>4</span><span class=p>;</span>     <span class=c1>// 首部长度
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>char</span> <span class=nl>version</span> <span class=p>:</span> <span class=mi>4</span><span class=p>;</span>    <span class=c1>// 版本号
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>tos</span><span class=p>;</span>        <span class=c1>// 服务类型
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>short</span> <span class=n>total_len</span><span class=p>;</span>     <span class=c1>// 总长度
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>short</span> <span class=n>ident</span><span class=p>;</span>       <span class=c1>// 标识
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>short</span> <span class=n>frag_and_flags</span><span class=p>;</span>    <span class=c1>// 标志和片偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>ttl</span><span class=p>;</span>        <span class=c1>//跳数
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>proto</span><span class=p>;</span>       <span class=c1>// 协议
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>short</span> <span class=n>checksum</span><span class=p>;</span>     <span class=c1>// 校验和
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>sourceIP</span><span class=p>;</span>      <span class=c1>//源地址
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>destIP</span><span class=p>;</span>        <span class=c1>//目的地址
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span> <span class=n>IpHeader</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><p>程序实现的功能包括对域名和 IP 地址发出的 Ping 命令，举例如下</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>&gt;</span> <span class=n>ping</span> <span class=mf>192.168</span><span class=p>.</span><span class=py>1</span><span class=p>.</span><span class=py>1</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span> <span class=n>ping</span> <span class=p>[</span><span class=no>www.neu.edu.cn</span><span class=p>](</span><span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>www</span><span class=p>.</span><span class=py>neu</span><span class=p>.</span><span class=py>edu</span><span class=p>.</span><span class=n>cn</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>程序流程如下</p><p><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_ping%e7%a8%8b%e5%ba%8f.png srcset="https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_ping%e7%a8%8b%e5%ba%8f.png?size=small, https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_ping%e7%a8%8b%e5%ba%8f.png?size=medium 1.5x, https://picped-1301226557.cos.ap-beijing.myqcloud.com/BC_20181001_ping%e7%a8%8b%e5%ba%8f.png?size=large 2x" sizes=auto data-title=ping程序实现 data-alt=ping程序实现 style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>代码放在了 <a href=https://gist.github.com/shuzang/26b2052e5283fa0ff596c43fa3c52265.js target=_blank rel="external nofollow noopener noreferrer">Github Gist</a>，测试结果如下参数</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>www</span><span class=p>.</span><span class=n>neu</span><span class=p>.</span><span class=n>edu</span><span class=p>.</span><span class=n>cn</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>0.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>15</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>1.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>0</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>2.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>32</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>3.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>0</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>4.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>0</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>5.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>16</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>6.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>15</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>7.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>16</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>8.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>16</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>9.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>0</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>10.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>0</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>11.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>16</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>12.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>16</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>13.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>0</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>14.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>31</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>15.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>0</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>16.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>0</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>17.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>16</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=mi>32</span> <span class=n>bytes</span> <span class=n>from</span> <span class=mf>202.118.1.7</span><span class=o>:</span> <span class=n>icmp_seq</span> <span class=o>=</span> <span class=mf>18.</span>  <span class=nl>time</span><span class=p>:</span> <span class=mi>1188</span> <span class=n>ms</span>
</span></span><span class=line><span class=cl><span class=o>-</span>    
</span></span></code></pre></td></tr></table></div></div><p>注意：</p><ul><li><p>Sleep(1000)，删除会使被ping的目的机非常繁忙</p></li><li><p>发送的ICMP报文中的数据部分最大可以设置为65535-20-8个字节，这将使网络拥堵</p></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2020-08-20 00:00:00">更新于 2020-08-20&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/2018/internet-control-message-protocol/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Pocket" data-sharer=pocket data-url=https://shuzang.github.io/2018/internet-control-message-protocol/><i class="fa-brands fa-get-pocket fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://shuzang.github.io/2018/internet-control-message-protocol/ data-title=计算机网络-ICMP协议><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/ class=post-tag>计算机基础</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2018/%E8%87%AA%E7%84%B6%E8%BE%A9%E8%AF%81%E6%B3%95/ class=post-nav-item rel=prev title=自然辩证法><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>自然辩证法</a>
<a href=/2018/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%AE%A1%E7%90%86%E4%B8%96%E7%95%8C/ class=post-nav-item rel=next title=人工智能管理世界>人工智能管理世界<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-reward><div class=comment></div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>赞赏</label><div class=reward-ways data-mode=static><div><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/alipay.png data-title=" 支付宝" data-alt=" 支付宝" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span>支付宝</span></div><div><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/wechatpay.png data-title=" 微信" data-alt=" 微信" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span>微信</span></div></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">Hava a great day !</div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=/></a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/shuzang/shuzang.github.io title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=https://unpkg.com/lightgallery@2.6.1/css/lightgallery-bundle.min.css><link rel=preload href=https://unpkg.com/katex@0.16.2/dist/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/katex@0.16.2/dist/katex.min.css></noscript><link rel=stylesheet href=https://unpkg.com/pace-js@1.2.4/themes/blue/pace-theme-minimal.css><script src=https://unpkg.com/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://unpkg.com/fuse.js@6.6.2/dist/fuse.min.js defer></script><script src=https://unpkg.com/twemoji@14.0.2/dist/twemoji.min.js defer></script><script src=https://unpkg.com/lightgallery@2.6.1/lightgallery.min.js defer></script><script src=https://unpkg.com/lightgallery@2.6.1/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=https://unpkg.com/lightgallery@2.6.1/plugins/zoom/lg-zoom.min.js defer></script><script src=https://unpkg.com/sharer.js@0.5.1/sharer.min.js async defer></script><script src=https://unpkg.com/katex@0.16.2/dist/katex.min.js defer></script><script src=https://unpkg.com/katex@0.16.2/dist/contrib/auto-render.min.js defer></script><script src=https://unpkg.com/katex@0.16.2/dist/contrib/copy-tex.min.js defer></script><script src=https://unpkg.com/katex@0.16.2/dist/contrib/mhchem.min.js defer></script><script src=https://unpkg.com/pangu@4.0.7/dist/browser/pangu.min.js defer></script><script src=https://unpkg.com/pace-js@1.2.4/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{enable:!1},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0}</script><script src=/js/theme.min.js defer></script></body></html>