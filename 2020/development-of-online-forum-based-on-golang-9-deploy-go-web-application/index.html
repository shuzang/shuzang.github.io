<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>基于Go语言开发在线论坛9-部署Go Web应用 - Shuzang's Blog</title><meta name=author content="Shuzang"><meta name=author-link content><meta name=description content="部署 Go 应用相对简单，因为所有应用代码都被打包成一个二进制文件了（视图模板、静态资源和配置文件等非 Go 代码除外），并且不需要依赖其他库，不需要额外的运行时环境（比如 Java 需要再安装 JVM），也不需要部署额外的 HTTP 服务器。"><meta name=keywords content="Go实战"><meta itemprop=name content="基于Go语言开发在线论坛9-部署Go Web应用"><meta itemprop=description content="部署 Go 应用相对简单，因为所有应用代码都被打包成一个二进制文件了（视图模板、静态资源和配置文件等非 Go 代码除外），并且不需要依赖其他库，不需要额外的运行时环境（比如 Java 需要再安装 JVM），也不需要部署额外的 HTTP 服务器。"><meta itemprop=datePublished content="2020-06-07T20:50:00+08:00"><meta itemprop=dateModified content="2020-06-07T00:00:00+00:00"><meta itemprop=wordCount content="1929"><meta itemprop=image content="https://shuzang.github.io/logo.png"><meta itemprop=keywords content="Go实战,"><meta property="og:title" content="基于Go语言开发在线论坛9-部署Go Web应用"><meta property="og:description" content="部署 Go 应用相对简单，因为所有应用代码都被打包成一个二进制文件了（视图模板、静态资源和配置文件等非 Go 代码除外），并且不需要依赖其他库，不需要额外的运行时环境（比如 Java 需要再安装 JVM），也不需要部署额外的 HTTP 服务器。"><meta property="og:type" content="article"><meta property="og:url" content="https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-9-deploy-go-web-application/"><meta property="og:image" content="https://shuzang.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-07T20:50:00+08:00"><meta property="article:modified_time" content="2020-06-07T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shuzang.github.io/logo.png"><meta name=twitter:title content="基于Go语言开发在线论坛9-部署Go Web应用"><meta name=twitter:description content="部署 Go 应用相对简单，因为所有应用代码都被打包成一个二进制文件了（视图模板、静态资源和配置文件等非 Go 代码除外），并且不需要依赖其他库，不需要额外的运行时环境（比如 Java 需要再安装 JVM），也不需要部署额外的 HTTP 服务器。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-9-deploy-go-web-application/><link rel=prev href=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-8-message-view-and-date-time-localizationsingleton-mode/><link rel=next href=https://shuzang.github.io/2020/how-to-avoid-information-overload/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><meta name=google-site-verification content="UA-209130979-1"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"基于Go语言开发在线论坛9-部署Go Web应用","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shuzang.github.io\/2020\/development-of-online-forum-based-on-golang-9-deploy-go-web-application\/"},"genre":"posts","keywords":"Go实战","wordcount":1929,"url":"https:\/\/shuzang.github.io\/2020\/development-of-online-forum-based-on-golang-9-deploy-go-web-application\/","datePublished":"2020-06-07T20:50:00+08:00","dateModified":"2020-06-07T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"xueyuanjun"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title="Shuzang's Blog" data-alt="Shuzang's Blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Posts</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title=/images/avatar.png data-alt=/images/avatar.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Posts</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>基于Go语言开发在线论坛9-部署Go Web应用</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
xueyuanjun</span></span>
<span class=post-category>收录于 <a href=/categories/golang%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Golang学习之路</a></span></div><div class=post-meta-line><span title="发布于 2020-06-07 20:50:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2020-06-07>2020-06-07</time></span>&nbsp;<span title="更新于 2020-06-07 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2020-06-07>2020-06-07</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 1929 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 4 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-构建应用>1. 构建应用</a></li><li><a href=#2-部署应用>2. 部署应用</a><ul><li><a href=#21-部署代码>2.1 部署代码</a></li><li><a href=#22-数据库初始化>2.2 数据库初始化</a></li><li><a href=#23-访问应用>2.3 访问应用</a></li></ul></li><li><a href=#3-通过-nginx-做反向代理>3. 通过 Nginx 做反向代理</a></li><li><a href=#4-通过-supervisor-维护应用守护进程>4. 通过 Supervisor 维护应用守护进程</a></li></ul></nav></div></div><div class=content id=content><p>部署 Go 应用相对简单，因为所有应用代码都被打包成一个二进制文件了（视图模板、静态资源和配置文件等非 Go 代码除外），并且不需要依赖其他库，不需要额外的运行时环境（比如 Java 需要再安装 JVM），也不需要部署额外的 HTTP 服务器。</p><p>对于在线论坛项目，包含了静态资源文件（CSS、JavaScript、图片），所以我们将在 Go Web 应用之前前置一个 Nginx 服务器处理静态资源请求，然后通过反向代理处理动态资源请求（指向 Go 处理器方法的请求），对于那些不包含静态资源和视图模板的纯 API 项目，通常只需要打包一份二进制文件部署到服务器即可，更加便捷。</p><blockquote><p>注：其实 Go 应用部署的最佳实践是基于 Docker，后续我们在部署专题中再介绍如何基于 Docker 将应用快速部署到远程云服务器。</p></blockquote><h2 id=1-构建应用>1. 构建应用</h2><p>首先，我们可以在本地项目根目录下通过如下命令将应用代码打包成二进制可执行文件：</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>GOOS</span><span class=p>=</span><span class=nx>linux</span> <span class=nx>GOARCH</span><span class=p>=</span><span class=nx>amd64</span> <span class=k>go</span> <span class=nx>build</span></span></span></code></pre></td></tr></table></div></div><p>注意这里指定了 <code>GOOS</code> 和 <code>GOARCH</code> 选项进行交叉编译，因为我们是在 Win10 系统（<code>amd64</code>）中打包，并且目标二进制文件需要在 Linux 服务器（<code>linux</code>）执行。该命令执行成功后会在当前目录下生成和项目名称相同的二进制文件：</p><p><img loading=lazy src=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871088999900.jpg srcset="https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871088999900.jpg, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871088999900.jpg 1.5x, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871088999900.jpg 2x" sizes=auto data-title=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871088999900.jpg data-alt=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871088999900.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>然后我们可以将代码提交到 Github 或者其他代码仓库。</p><h2 id=2-部署应用>2. 部署应用</h2><h3 id=21-部署代码>2.1 部署代码</h3><p>再登录服务器到部署目录下拉取代码：</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/nonfu/chitchat</span></span></code></pre></td></tr></table></div></div><p>初次拉取使用 <code>git clone</code>，后续在 <code>chitchat</code> 目录下运行 <code>git pull</code> 即可。</p><p>然后我们进入 <code>chitchat</code> 目录，配置 <code>config.json</code> 进行服务端数据库配置（正式项目不要将 <code>config.json</code> 提交到代码仓库，以免安全风险和后续拉取代码覆盖），确保 <code>logs</code> 目录对 Web 用户具有写权限（比如配置权限为 <code>777</code>，或者所属用户与 Web 用户组一致）。</p><blockquote><p>注：当然我们这里部署代码的方式比较原始，对于多人协作的大型项目，可以借助持续集成工具（比如 Jenkins）进行自动化部署，并且由于项目比较简单，就不再演示单元测试、CI/CD 等其他 DevOps 工具的使用了。</p></blockquote><h3 id=22-数据库初始化>2.2 数据库初始化</h3><p>在服务端 MySqL 数据库中创建 <code>chitchat</code> 数据库，并初始化对应数据表。如果不了解如何安装和创建数据库，可以参考这篇教程：<a href=https://xueyuanjun.com/post/9749.html#bkmrk-%E5%88%9B%E5%BB%BA%E7%BA%BF%E4%B8%8A%E6%95%B0%E6%8D%AE%E5%BA%93 target=_blank rel="external nofollow noopener noreferrer">将博客应用自动部署到线上服务器完整流程详解</a>。</p><h3 id=23-访问应用>2.3 访问应用</h3><p>完成以上工作后，我们就可以在 <code>chitchat</code> 项目目录下运行 <code>chitchat</code> 二进制文件启动应用了：</p><p><img loading=lazy src=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871116372180.jpg srcset="https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871116372180.jpg, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871116372180.jpg 1.5x, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871116372180.jpg 2x" sizes=auto data-title=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871116372180.jpg data-alt=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871116372180.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>然后我们在本地 <code>hosts</code> 文件中自定义一个测试域名与服务器 IP 的映射：</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>your-server-ip-address chitchat.test</span></span></code></pre></td></tr></table></div></div><p>将上述 <code>your-server-ip-address</code> 替换成自己的远程服务器 IP 地址，然后我们就可以在浏览器中通过 <code>http://chitchat.test:8080</code> 访问应用了：</p><p><img loading=lazy src=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871123187423.jpg srcset="https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871123187423.jpg, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871123187423.jpg 1.5x, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871123187423.jpg 2x" sizes=auto data-title=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871123187423.jpg data-alt=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871123187423.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h2 id=3-通过-nginx-做反向代理>3. 通过 Nginx 做反向代理</h2><p>虽然上述方式可以正常运行，但是如果要高效处理静态资源文件并对其做缓存，可以借助 Nginx 作为反向代理服务器来完成，我们在 Nginx 虚拟主机配置目录 <code>/etc/nginx/sites-available</code> 中新增一个配置文件 <code>chitchat.conf</code>（以 Ubuntu 服务器为例）：</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>      <span class=mi>80</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>chitchat.test</span> <span class=s>www.chitchat.test</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 静态资源交由 Nginx 管理，并缓存一天
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>location</span> <span class=s>/static</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>root</span>        <span class=s>/var/www/chitchat/public</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>expires</span>     <span class=s>1d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>add_header</span>  <span class=s>Cache-Control</span> <span class=s>public</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>access_log</span>  <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>try_files</span> <span class=nv>$uri</span> <span class=s>@goweb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>try_files</span> <span class=s>/_not_exists_</span> <span class=s>@goweb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 动态请求默认通过 Go Web 服务器处理
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>location</span> <span class=s>@goweb</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$http_host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Scheme</span> <span class=nv>$scheme</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_redirect</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:8080</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kn>error_log</span> <span class=s>/var/log/nginx/chitchat_error.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>access_log</span> <span class=s>/var/log/nginx/chitchat_access.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后再启用该配置文件：</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ln -s /etc/nginx/sites-available/chitchat /etc/nginx/sites-enabled/chitchat</span></span></code></pre></td></tr></table></div></div><p>重启 Nginx 服务：</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>service nginx restart</span></span></code></pre></td></tr></table></div></div><p>与此同时，我们可以把 <code>chitchat/config.json</code> 中的 <code>App</code> 配置项启动 IP 地址改为 <code>127.0.0.1</code>：</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=s2>&#34;App&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Address&#34;</span>: <span class=s2>&#34;127.0.0.1:8080&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Static&#34;</span>: <span class=s2>&#34;public&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Log&#34;</span>: <span class=s2>&#34;logs&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Locale&#34;</span>: <span class=s2>&#34;locales&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Language&#34;</span>: <span class=s2>&#34;zh&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>,</span></span></code></pre></td></tr></table></div></div><p>并再次重启这个 Go 应用，这样就只能通过 Nginx 访问应用，在浏览器中访问 <code>http://chitchat.test</code>：</p><p><img loading=lazy src=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871168431728.jpg srcset="https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871168431728.jpg, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871168431728.jpg 1.5x, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871168431728.jpg 2x" sizes=auto data-title=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871168431728.jpg data-alt=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871168431728.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>而当你试图再通过 <code>http://chitchat.test:8080</code> 访问应用，则会报错：</p><p><img loading=lazy src=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169152394.jpg srcset="https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169152394.jpg, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169152394.jpg 1.5x, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169152394.jpg 2x" sizes=auto data-title=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169152394.jpg data-alt=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169152394.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>我们可以测试下注册登录功能以及创建新群组功能：</p><p><img loading=lazy src=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169671758.jpg srcset="https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169671758.jpg, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169671758.jpg 1.5x, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169671758.jpg 2x" sizes=auto data-title=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169671758.jpg data-alt=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871169671758.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><h2 id=4-通过-supervisor-维护应用守护进程>4. 通过 Supervisor 维护应用守护进程</h2><p>看起来一切都 OK 了，但是目前这种模式下，用户退出后 Go Web 应用进程会关闭，这显然是不行的，而且如果 Go Web 应用进程因为其他异常挂掉，也无法自动重启，每次需要我们登录到服务器进行启动操作，这很不方便，也影响在线应用的稳定性，为此，我们需要借助第三方进程监控工具帮我们实现 Go Web 应用进程以后台守护进程的方式运行。常见的进程监控工具有 Supervisor、Upstart、systemd 等，由于我的服务器之前部署过 Supervisor，所以我就借助它来管理 Go Web 应用进程。</p><blockquote><p>注：对 Supervisor 安装配置不了解的同学，可以参考这篇教程 —— <a href=https://xueyuanjun.com/post/21566#bkmrk-%E9%83%A8%E7%BD%B2-horizon target=_blank rel="external nofollow noopener noreferrer">队列系统解决方案：Horizon</a>。</p></blockquote><p>首先创建对应的 Supervisor 配置文件 <code>/etc/supervisor/conf.d/chitchat.conf</code>，这里需要设置进程启动目录及命令、进程意外挂掉后是否自动重启、以及日志文件路径等：</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[program:chitchat]
</span></span><span class=line><span class=cl>process_name=%(program_name)s
</span></span><span class=line><span class=cl>directory=/var/www/chitchat
</span></span><span class=line><span class=cl>command=/var/www/chitchat/chitchat
</span></span><span class=line><span class=cl>autostart=true
</span></span><span class=line><span class=cl>autorestart=true
</span></span><span class=line><span class=cl>user=root
</span></span><span class=line><span class=cl>redirect_stderr=true
</span></span><span class=line><span class=cl>stdout_logfile=/var/www/chitchat/logs/chitchat.log</span></span></code></pre></td></tr></table></div></div><blockquote><p>注意：我们需要进入 <code>chitchat</code> 所在目录执行启动命令，否则会找不到配置文件和其他资源路径，所以需要配置 <code>directory</code> 选项。</p></blockquote><p>然后关闭之前通过手动运行 <code>chitchat</code> 启动的 Go Web 服务器，再运行如下指令通过 Supervisor 启动并维护 Go Web 应用进程：</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>supervisorctl reread
</span></span><span class=line><span class=cl>supervisorctl update
</span></span><span class=line><span class=cl>supervisorctl start chitchat</span></span></code></pre></td></tr></table></div></div><p>你可以通过 <code>ps -ef | grep chitchat</code> 查看进程是否启动成功：</p><p><img loading=lazy src=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871330990937.jpg srcset="https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871330990937.jpg, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871330990937.jpg 1.5x, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871330990937.jpg 2x" sizes=auto data-title=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871330990937.jpg data-alt=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871330990937.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>启动成功后，就可以在浏览器通过 <code>http://chitchat.test</code> 访问部署在远程服务器的在线论坛了：</p><p><img loading=lazy src=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871331767149.jpg srcset="https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871331767149.jpg, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871331767149.jpg 1.5x, https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871331767149.jpg 2x" sizes=auto data-title=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871331767149.jpg data-alt=https://qcdn.xueyuanjun.com/storage/uploads/images/gallery/2020-04/image-15871331767149.jpg style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>并且无论是否退出远程服务器还是关闭 Go Web 应用进程，都不会影响在线论坛的访问，因为它是以守护进程的方式运行的，并且可以在关闭后自动重启。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2020-06-07 00:00:00">更新于 2020-06-07&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/2020/development-of-online-forum-based-on-golang-9-deploy-go-web-application/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-9-deploy-go-web-application/ data-title="基于Go语言开发在线论坛9-部署Go Web应用" data-hashtags=Go实战><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-9-deploy-go-web-application/ data-hashtag=Go实战><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-9-deploy-go-web-application/ data-title="基于Go语言开发在线论坛9-部署Go Web应用"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/go%E5%AE%9E%E6%88%98/ class=post-tag>Go实战</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2020/development-of-online-forum-based-on-golang-8-message-view-and-date-time-localizationsingleton-mode/ class=post-nav-item rel=prev title=基于Go语言开发在线论坛8-消息、视图和日期时间本地化><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>基于Go语言开发在线论坛8-消息、视图和日期时间本地化</a>
<a href=/2020/how-to-avoid-information-overload/ class=post-nav-item rel=next title=如何避免信息过载>如何避免信息过载<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.117.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/>Shuzang</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/shuzang title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0}</script><script src=/js/theme.min.js defer></script></body></html>