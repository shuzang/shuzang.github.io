<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>基于Go语言开发在线论坛3-访问论坛首页 - Shuzang's Blog</title><meta name=author content="Shuzang"><meta name=author-link content><meta name=description content="前两篇分别介绍了整体设计及数据表的创建、模型类的编写，本篇了解如何在服务端处理用户请求，并启动论坛首页。文章转自学院君的教程，略有改动。"><meta name=keywords content="Go实战"><meta itemprop=name content="基于Go语言开发在线论坛3-访问论坛首页"><meta itemprop=description content="前两篇分别介绍了整体设计及数据表的创建、模型类的编写，本篇了解如何在服务端处理用户请求，并启动论坛首页。文章转自学院君的教程，略有改动。"><meta itemprop=datePublished content="2020-05-29T09:08:00+08:00"><meta itemprop=dateModified content="2020-06-14T00:00:00+00:00"><meta itemprop=wordCount content="2049"><meta itemprop=image content="https://shuzang.github.io/logo.png"><meta itemprop=keywords content="Go实战,"><meta property="og:title" content="基于Go语言开发在线论坛3-访问论坛首页"><meta property="og:description" content="前两篇分别介绍了整体设计及数据表的创建、模型类的编写，本篇了解如何在服务端处理用户请求，并启动论坛首页。文章转自学院君的教程，略有改动。"><meta property="og:type" content="article"><meta property="og:url" content="https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-3-visit-forum-homepage/"><meta property="og:image" content="https://shuzang.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-29T09:08:00+08:00"><meta property="article:modified_time" content="2020-06-14T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shuzang.github.io/logo.png"><meta name=twitter:title content="基于Go语言开发在线论坛3-访问论坛首页"><meta name=twitter:description content="前两篇分别介绍了整体设计及数据表的创建、模型类的编写，本篇了解如何在服务端处理用户请求，并启动论坛首页。文章转自学院君的教程，略有改动。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-3-visit-forum-homepage/><link rel=prev href=https://shuzang.github.io/2020/golang-cryptographic-algorithm/><link rel=next href=https://shuzang.github.io/2020/golang-start-http-server/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><meta name=google-site-verification content="UA-209130979-1"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"基于Go语言开发在线论坛3-访问论坛首页","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shuzang.github.io\/2020\/development-of-online-forum-based-on-golang-3-visit-forum-homepage\/"},"genre":"posts","keywords":"Go实战","wordcount":2049,"url":"https:\/\/shuzang.github.io\/2020\/development-of-online-forum-based-on-golang-3-visit-forum-homepage\/","datePublished":"2020-05-29T09:08:00+08:00","dateModified":"2020-06-14T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"xueyuanjun"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title="Shuzang's Blog" data-alt="Shuzang's Blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title=/images/avatar.png data-alt=/images/avatar.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>基于Go语言开发在线论坛3-访问论坛首页</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
xueyuanjun</span></span>
<span class=post-category>收录于 <a href=/categories/golang%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Golang学习之路</a></span></div><div class=post-meta-line><span title="发布于 2020-05-29 09:08:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2020-05-29>2020-05-29</time></span>&nbsp;<span title="更新于 2020-06-14 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2020-06-14>2020-06-14</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2049 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 5 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-路由器定义>1. 路由器定义</a></li><li><a href=#2-启动http服务器>2. 启动HTTP服务器</a></li><li><a href=#3-处理静态资源>3. 处理静态资源</a></li><li><a href=#4-编写处理器实现>4. 编写处理器实现</a><ul><li><a href=#41-首页处理器方法>4.1 首页处理器方法</a></li><li><a href=#42-创建视图模板>4.2 创建视图模板</a></li><li><a href=#43-渲染视图模板>4.3 渲染视图模板</a></li><li><a href=#44-注册首页路由>4.4 注册首页路由</a></li></ul></li><li><a href=#5-访问论坛首页>5. 访问论坛首页</a></li></ul></nav></div></div><div class=content id=content><p>前两篇分别介绍了整体设计及数据表的创建、模型类的编写，本篇了解如何在服务端处理用户请求，并启动论坛首页。文章转自学院君的教程，略有改动。</p><p><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_Jietu20200330-021118.jpg srcset="https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_Jietu20200330-021118.jpg, https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_Jietu20200330-021118.jpg 1.5x, https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_Jietu20200330-021118.jpg 2x" sizes=auto data-title=首页视图 data-alt=首页视图 style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>用户请求的处理流程如下：</p><ol><li>客户端发送请求；</li><li>服务端路由器（multiplexer）将请求分发给指定处理器（handler）；</li><li>处理器处理请求，完成对应的业务逻辑；</li><li>处理器调用模板引擎生成 HTML 并将响应返回给客户端。</li></ol><p>接下来我们按照这个流程来编写服务端代码。</p><h2 id=1-路由器定义>1. 路由器定义</h2><p>这里我们基于 <a href=https://github.com/gorilla/mux target=_blank rel="external nofollow noopener noreferrer">gorilla/mux</a> 来实现路由器，所以需要安装对应依赖：</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go get -u github.com/gorilla/mux</span></span></code></pre></td></tr></table></div></div><p>将路由器定义在 <code>routes</code> 目录下的 <code>router.go</code> 中</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>routes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/gorilla/mux&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 返回一个 mux.Router 类型指针，从而可以当作处理器使用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewRouter</span><span class=p>()</span> <span class=o>*</span><span class=nx>mux</span><span class=p>.</span><span class=nx>Router</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建 mux.Router 路由器示例
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>router</span> <span class=o>:=</span> <span class=nx>mux</span><span class=p>.</span><span class=nf>NewRouter</span><span class=p>().</span><span class=nf>StrictSlash</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 遍历 web.go 中定义的所有 webRoutes
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>route</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>webRoutes</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 将每个 web 路由应用到路由器
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>router</span><span class=p>.</span><span class=nf>Methods</span><span class=p>(</span><span class=nx>route</span><span class=p>.</span><span class=nx>Method</span><span class=p>).</span>
</span></span><span class=line><span class=cl>            <span class=nf>Path</span><span class=p>(</span><span class=nx>route</span><span class=p>.</span><span class=nx>Pattern</span><span class=p>).</span>
</span></span><span class=line><span class=cl>            <span class=nf>Name</span><span class=p>(</span><span class=nx>route</span><span class=p>.</span><span class=nx>Name</span><span class=p>).</span>
</span></span><span class=line><span class=cl>            <span class=nf>Handler</span><span class=p>(</span><span class=nx>route</span><span class=p>.</span><span class=nx>HandlerFunc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>router</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>将所有路由定义在同一目录的 <code>routes.go</code> 中：</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>routes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义一个 WebRoute 结构体用于存放单个路由
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WebRoute</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Name</span>        <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Method</span>      <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Pattern</span>     <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>HandlerFunc</span> <span class=nx>http</span><span class=p>.</span><span class=nx>HandlerFunc</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 声明 WebRoutes 切片存放所有 Web 路由
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WebRoutes</span> <span class=p>[]</span><span class=nx>WebRoute</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义所有 Web 路由
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>webRoutes</span> <span class=p>=</span> <span class=nx>WebRoutes</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h2 id=2-启动http服务器>2. 启动HTTP服务器</h2><p>最后在项目根目录下的 <code>main.go</code> 中引入上述路由器来启动 HTTP 服务器：</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span> <span class=s>&#34;github.com/xueyuanjun/chitchat/routes&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>startWebServer</span><span class=p>(</span><span class=s>&#34;8080&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 通过指定端口启动 Web 服务器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>startWebServer</span><span class=p>(</span><span class=nx>port</span> <span class=kt>string</span><span class=p>)</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>r</span> <span class=o>:=</span> <span class=nf>NewRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>http</span><span class=p>.</span><span class=nf>Handle</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>  <span class=c1>// 通过 router.go 中定义的路由器来分发请求
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Starting HTTP service at &#34;</span> <span class=o>+</span> <span class=nx>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>err</span> <span class=o>:=</span> <span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:&#34;</span> <span class=o>+</span> <span class=nx>port</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span> <span class=c1>// 启动协程监听请求
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;An error occured starting HTTP listener at port &#34;</span> <span class=o>+</span> <span class=nx>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Error: &#34;</span> <span class=o>+</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里我们指定 HTTP 服务器监听 <code>8080</code> 端口，使用的路由器正是上述 <code>router.go</code> 中 <code>NewRouter</code> 方法返回的 <code>mux.Router</code> 指针类型实例，这里可以看到引用的时候并没有带上包名前缀，之所以可以这么做是因为通过特殊符号 <code>.</code> 引入了 <code>routes</code>包，通过这种方式引入的包可以直接调用包中对外可见的变量、方法和结构体，而不需要加上包名前缀。</p><h2 id=3-处理静态资源>3. 处理静态资源</h2><p>在线论坛涉及到前端静态资源文件的处理，我们可以在 <code>startWebServer</code> 方法中新增如下这两行代码：</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>r</span> <span class=o>:=</span> <span class=nf>NewRouter</span><span class=p>()</span> <span class=c1>// 通过 router.go 中定义的路由器来分发请求
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 处理静态资源文件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>assets</span> <span class=o>:=</span> <span class=nx>http</span><span class=p>.</span><span class=nf>FileServer</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>Dir</span><span class=p>(</span><span class=s>&#34;public&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nx>r</span><span class=p>.</span><span class=nf>PathPrefix</span><span class=p>(</span><span class=s>&#34;/static/&#34;</span><span class=p>).</span><span class=nf>Handler</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>StripPrefix</span><span class=p>(</span><span class=s>&#34;/static/&#34;</span><span class=p>,</span> <span class=nx>assets</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>http</span><span class=p>.</span><span class=nf>Handle</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span> <span class=c1>// 应用路由器到 HTTP 服务器
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></td></tr></table></div></div><p>其中 <code>http.FileServer</code> 用于初始化文件服务器和目录为当前目录下的 <code>public</code> 目录。</p><p>然后在第二段代码中指定静态资源路由及处理逻辑：将 <code>/static/</code> 前缀的 URL 请求去除 <code>static</code> 前缀，然后在文件服务器查找指定文件路径是否存在（<code>public</code> 目录下的相对地址）。</p><p>比如 URL 请求路径为 <code>http://localhost:8080/static/css/bootstrap.min.css</code>，对应的查找路径是：</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=p>&lt;</span><span class=nx>application</span> <span class=nx>root</span><span class=p>&gt;</span><span class=o>/</span><span class=nx>public</span><span class=o>/</span><span class=nx>css</span><span class=o>/</span><span class=nx>bootstrap</span><span class=p>.</span><span class=nx>min</span><span class=p>.</span><span class=nx>css</span></span></span></code></pre></td></tr></table></div></div><p>对于静态资源文件直接返回文件内容，不会进行额外处理。</p><h2 id=4-编写处理器实现>4. 编写处理器实现</h2><h3 id=41-首页处理器方法>4.1 首页处理器方法</h3><p>做好上述准备工作后，接下来，我们来创建论坛首页的路由处理器，在 <code>handlers</code> 目录下新增一个 <code>index.go</code> 来定义首页的处理器方法：</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>handlers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;github.com/xueyuanjun/chitchat/models&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;html/template&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 论坛首页路由处理器方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Index</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>files</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;views/layout.html&#34;</span><span class=p>,</span> <span class=s>&#34;views/navbar.html&#34;</span><span class=p>,</span> <span class=s>&#34;views/index.html&#34;</span><span class=p>,}</span>
</span></span><span class=line><span class=cl>    <span class=nx>templates</span> <span class=o>:=</span> <span class=nx>template</span><span class=p>.</span><span class=nf>Must</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nf>ParseFiles</span><span class=p>(</span><span class=nx>files</span><span class=o>...</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nx>threads</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>models</span><span class=p>.</span><span class=nf>Threads</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>templates</span><span class=p>.</span><span class=nf>ExecuteTemplate</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;layout&#34;</span><span class=p>,</span> <span class=nx>threads</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=42-创建视图模板>4.2 创建视图模板</h3><p>这里我们使用 Go 自带的 <code>html/template</code> 作为模板引擎，需要传入位于 <code>views</code> 目录下的视图模板文件，这里传入了多个模板文件，包括主布局文件 <code>layout.html</code>：</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ define &#34;layout&#34; }}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;utf-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>meta</span> <span class=na>http-equiv</span><span class=o>=</span><span class=s>&#34;X-UA-Compatible&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;IE=9&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>ChitChat<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/static/css/bootstrap.min.css&#34;</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/static/css/font-awesome.min.css&#34;</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    {{ template &#34;navbar&#34; . }}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;container&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        {{ template &#34;content&#34; . }}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span> <span class=c>&lt;!-- /container --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;/static/js/jquery-2.1.1.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;/static/js/bootstrap.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{{ end }}</span></span></code></pre></td></tr></table></div></div><p>顶部导航模板 <code>navbar.html</code>：</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ define &#34;navbar&#34; }}
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;navbar navbar-default navbar-static-top&#34;</span> <span class=na>role</span><span class=o>=</span><span class=s>&#34;navigation&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;container&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;navbar-header&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;navbar-toggle collapsed&#34;</span> <span class=na>data-toggle</span><span class=o>=</span><span class=s>&#34;collapse&#34;</span> <span class=na>data-target</span><span class=o>=</span><span class=s>&#34;.navbar-collapse&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;sr-only&#34;</span><span class=p>&gt;</span>Toggle navigation<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;icon-bar&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;icon-bar&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;icon-bar&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;</span><span class=nt>a</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;navbar-brand&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;fa fa-comments-o&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					ChitChat
</span></span><span class=line><span class=cl>				<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;navbar-collapse collapse&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;</span><span class=nt>ul</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;nav navbar-nav&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span>Home<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;</span><span class=nt>ul</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;nav navbar-nav navbar-right&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/login&#34;</span><span class=p>&gt;</span>Login<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>{{ end }}</span></span></code></pre></td></tr></table></div></div><p>以及首页视图模板 <code>index.html</code>：</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ define &#34;content&#34; }}
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;lead&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/thread/new&#34;</span><span class=p>&gt;</span>Start a thread<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span> or join one below!
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    {{ range . }}
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;panel panel-default&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;panel-heading&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;lead&#34;</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;fa fa-comment-o&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>i</span><span class=p>&gt;</span> {{ .Topic }}<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;panel-body&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				Started by {{ .User.Name }} - {{ .CreatedAtDate }} - {{ .NumReplies }} posts.
</span></span><span class=line><span class=cl>				<span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;pull-right&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>					<span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/thread/read?id={{.Uuid }}&#34;</span><span class=p>&gt;</span>Read more<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    {{ end }}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{{ end }}</span></span></code></pre></td></tr></table></div></div><p>引入多个视图模板是为了提高模板代码的复用性，因为对于同一个应用的不同页面来说，可能基本布局、页面顶部导航和页面底部组件都是一样的，关于视图模板的细节，我们在后面视图模板部分会详细介绍，这里简单了解下即可。</p><h3 id=43-渲染视图模板>4.3 渲染视图模板</h3><p>我们可以从数据库查询群组数据并将该数据传递到模板文件，最后将模板视图渲染出来，对应代码如下：</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>threads</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>models</span><span class=p>.</span><span class=nf>Threads</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>templates</span><span class=p>.</span><span class=nf>ExecuteTemplate</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;layout&#34;</span><span class=p>,</span> <span class=nx>threads</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>编译多个视图模板时，默认以第一个模板名作为最终视图模板名，所以这里第二个参数传入的是 <code>layout</code>，第三个参数传入要渲染的数据 <code>threads</code>，对应的渲染逻辑位于 <code>views/index.html</code> 中：</p><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=p>{{</span> <span class=k>range</span> <span class=p>.</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nx>div</span> <span class=nx>class</span><span class=p>=</span><span class=s>&#34;panel panel-default&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nx>div</span> <span class=nx>class</span><span class=p>=</span><span class=s>&#34;panel-heading&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;</span><span class=nx>span</span> <span class=nx>class</span><span class=p>=</span><span class=s>&#34;lead&#34;</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>i</span> <span class=nx>class</span><span class=p>=</span><span class=s>&#34;fa fa-comment-o&#34;</span><span class=p>&gt;&lt;</span><span class=o>/</span><span class=nx>i</span><span class=p>&gt;</span> <span class=p>{{</span> <span class=p>.</span><span class=nx>Topic</span> <span class=p>}}&lt;</span><span class=o>/</span><span class=nx>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=o>/</span><span class=nx>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=nx>div</span> <span class=nx>class</span><span class=p>=</span><span class=s>&#34;panel-body&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=nx>Started</span> <span class=nx>by</span> <span class=p>{{</span> <span class=p>.</span><span class=nx>User</span><span class=p>.</span><span class=nx>Name</span> <span class=p>}}</span> <span class=o>-</span> <span class=p>{{</span> <span class=p>.</span><span class=nx>CreatedAtDate</span> <span class=p>}}</span> <span class=o>-</span> <span class=p>{{</span> <span class=p>.</span><span class=nx>NumReplies</span> <span class=p>}}</span> <span class=nx>posts</span><span class=p>.</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;</span><span class=nx>div</span> <span class=nx>class</span><span class=p>=</span><span class=s>&#34;pull-right&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>				<span class=p>&lt;</span><span class=nx>a</span> <span class=nx>href</span><span class=p>=</span><span class=s>&#34;/thread/read?id={{.Uuid }}&#34;</span><span class=p>&gt;</span><span class=nx>Read</span> <span class=nx>more</span><span class=p>&lt;</span><span class=o>/</span><span class=nx>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>			<span class=p>&lt;</span><span class=o>/</span><span class=nx>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=p>&lt;</span><span class=o>/</span><span class=nx>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=o>/</span><span class=nx>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{{</span> <span class=nx>end</span> <span class=p>}}</span></span></span></code></pre></td></tr></table></div></div><p>其中 <code>{{ range . }}</code> 表示将处理器方法传入的变量，这里是 <code>threads</code> 进行循环。</p><h3 id=44-注册首页路由>4.4 注册首页路由</h3><p>最好，我们在 <code>routes/routes.go</code> 中注册首页路由及对应的处理器方法 <code>Index</code>：</p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/xueyuanjun/chitchat/handlers&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义所有 Web 路由
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>webRoutes</span> <span class=p>=</span> <span class=nx>WebRoutes</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;home&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;GET&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>handlers</span><span class=p>.</span><span class=nx>Index</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h2 id=5-访问论坛首页>5. 访问论坛首页</h2><p>访问论坛首页之前，我们将相应的前端资源文件拷贝到 <code>public</code> 目录下，此时项目整体目录结构如下：</p><p><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E7%9B%AE%E5%BD%95%E6%A0%BC%E5%BC%8F.png srcset="https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E7%9B%AE%E5%BD%95%E6%A0%BC%E5%BC%8F.png, https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E7%9B%AE%E5%BD%95%E6%A0%BC%E5%BC%8F.png 1.5x, https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E7%9B%AE%E5%BD%95%E6%A0%BC%E5%BC%8F.png 2x" sizes=auto data-title=https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E7%9B%AE%E5%BD%95%E6%A0%BC%E5%BC%8F.png data-alt=https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E7%9B%AE%E5%BD%95%E6%A0%BC%E5%BC%8F.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>然后我们在项目根目录下运行如下代码启动 HTTP 服务器</p><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go run main.go</span></span></code></pre></td></tr></table></div></div><p>然后我们在浏览器访问论坛首页 <code>http://localhost:8080</code>：</p><p><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E9%A6%96%E9%A1%B5.png srcset="https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E9%A6%96%E9%A1%B5.png, https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E9%A6%96%E9%A1%B5.png 1.5x, https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20200529_%E9%A6%96%E9%A1%B5.png 2x" sizes=auto data-title=首页 data-alt=首页 style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2020-06-14 00:00:00">更新于 2020-06-14&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/2020/development-of-online-forum-based-on-golang-3-visit-forum-homepage/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-3-visit-forum-homepage/ data-title=基于Go语言开发在线论坛3-访问论坛首页 data-hashtags=Go实战><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-3-visit-forum-homepage/ data-hashtag=Go实战><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://shuzang.github.io/2020/development-of-online-forum-based-on-golang-3-visit-forum-homepage/ data-title=基于Go语言开发在线论坛3-访问论坛首页><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/go%E5%AE%9E%E6%88%98/ class=post-tag>Go实战</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2020/golang-cryptographic-algorithm/ class=post-nav-item rel=prev title=Golang密码学算法><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Golang密码学算法</a>
<a href=/2020/golang-start-http-server/ class=post-nav-item rel=next title=Golang启动HTTP服务器>Golang启动HTTP服务器<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.117.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/>Shuzang</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/shuzang title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0}</script><script src=/js/theme.min.js defer></script></body></html>