<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Go实现2048小游戏 | Shuzang's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=Description content="书藏的个人博客，包括Golang、数据结构、算法的学习记录，各类生活技能的学习，每周五发布一期自己的生活周刊"><link rel=prev href=https://shuzang.github.io/2020/efficient-use-of-win10-7-windows-terminal-and-winget/><link rel=next href=https://shuzang.github.io/2020/mysql-learning-supplement-temporary-table-and-derived-table/><link rel=canonical href=https://shuzang.github.io/2020/a-cli-implement-of-2048-game-using-go/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go实现2048小游戏"><meta name=twitter:description content="Go 实现一个命令行界面的 2048 游戏，仅涉及 Git 和 Go，用来熟悉基本语言特性。原型项目来自 https://github.com/chhabraamit/2048"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Go实现2048小游戏","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shuzang.github.io\/2020\/a-cli-implement-of-2048-game-using-go\/"},"image":{"@type":"ImageObject","url":"https:\/\/shuzang.github.io\/cover.png","width":800,"height":600},"genre":"posts","keywords":"Go实战","wordcount":3823,"url":"https:\/\/shuzang.github.io\/2020\/a-cli-implement-of-2048-game-using-go\/","datePublished":"2020-10-08T19:35:00\x2b08:00","dateModified":"2020-10-10T00:00:00\x2b00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"shuzang","logo":{"@type":"ImageObject","url":"https:\/\/shuzang.github.io\/logo.png","width":127,"height":40}},"description":""}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/lib/fontawesome-free/all.min.css></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=top-scroll-bar></div><div class=navbar-container><div class="navbar-header animated bounceIn"><a href=https://shuzang.github.io>Shuzang's Blog</a></div><div class=navbar-menu><a class=menu-item href=https://shuzang.github.io/posts>Posts</a><a class=menu-item href=https://shuzang.github.io/tags>Tags</a><a class=menu-item href=https://shuzang.github.io/categories>Categories</a><a class=menu-item href=https://shuzang.github.io/about>About</a><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><nav class=navbar-mobile><div class=top-scroll-bar></div><div class=navbar-container><div class=navbar-header><div class="navbar-header-title animated bounceIn"><a href=https://shuzang.github.io>Shuzang's Blog</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=https://shuzang.github.io/posts>Posts</a><a class=menu-item href=https://shuzang.github.io/tags>Tags</a><a class=menu-item href=https://shuzang.github.io/categories>Categories</a><a class=menu-item href=https://shuzang.github.io/about>About</a><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><main class=main><div class=container><article class=page><h1 class="post-title animated flipInX">Go实现2048小游戏</h1><div class=post-meta><i class="far fa-calendar-alt fa-fw"></i>published on&nbsp;<time datetime=2020-10-08>2020-10-08</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>about 3823 words&nbsp;<span class=post-category><i class="far fa-folder fa-fw"></i>included in&nbsp;<a href=https://shuzang.github.io/categories/golang%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/>Golang学习之路</a>&nbsp;</span></div><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#1-环境准备>1. 环境准备</a></li><li><a href=#2-显示游戏面板>2. 显示游戏面板</a></li><li><a href=#3-添加元素>3. 添加元素</a></li><li><a href=#4-先清屏后显示>4. 先清屏后显示</a></li><li><a href=#5-获取键盘输入>5. 获取键盘输入</a></li><li><a href=#6-数字移动合并>6. 数字移动合并</a></li><li><a href=#7-分数计算>7. 分数计算</a></li><li><a href=#8-代码重构>8. 代码重构</a></li><li><a href=#9-结果与收获>9. 结果与收获</a></li></ul></nav></div></div><div class=post-toc-mobile id=post-toc-mobile><details><summary><div class=post-toc-title><span>Contents</span>
<span><i class="details icon fas fa-angle-down"></i></span></div></summary><div class=post-toc-content><nav id=TableOfContentsMobile><ul><li><a href=#1-环境准备>1. 环境准备</a></li><li><a href=#2-显示游戏面板>2. 显示游戏面板</a></li><li><a href=#3-添加元素>3. 添加元素</a></li><li><a href=#4-先清屏后显示>4. 先清屏后显示</a></li><li><a href=#5-获取键盘输入>5. 获取键盘输入</a></li><li><a href=#6-数字移动合并>6. 数字移动合并</a></li><li><a href=#7-分数计算>7. 分数计算</a></li><li><a href=#8-代码重构>8. 代码重构</a></li><li><a href=#9-结果与收获>9. 结果与收获</a></li></ul></nav></div></details></div><div class=post-content><p>Go 实现一个命令行界面的 2048 游戏，仅涉及 Git 和 Go，用来熟悉基本语言特性。原型项目来自 <a href=https://github.com/chhabraamit/2048>https://github.com/chhabraamit/2048</a></p><a class=post-dummy-target id=1-环境准备></a><h2>1. 环境准备</h2><p>Win10 环境，go 1.14.3，编辑器为 VScode，使用 Github 管理代码。</p><p>首先在网页端建立 Github 仓库，选择 MIT 协议，然后克隆仓库到本地</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ git clone https://github.com/shuzang/2048.git
</code></pre></td></tr></table></div></div><p>在项目根目录创建 <code>main.go</code> 文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Getting started!&#34;</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>初始化项目</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ go mod init github.com/shuzang
</code></pre></td></tr></table></div></div><a class=post-dummy-target id=2-显示游戏面板></a><h2>2. 显示游戏面板</h2><p>2048 的游戏界面是一个 4×4 的网格，我们使用一个二维切片作为底层结构存储数字，然后按照网格的形式输出到终端，数字随机生成。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// game/board.go
</span><span class=c1></span><span class=kn>package</span> <span class=nx>game</span>

<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;math/rand&#34;</span>
	<span class=s>&#34;time&#34;</span>
<span class=p>)</span>

<span class=c1>// 游戏界面规格
</span><span class=c1></span><span class=kd>const</span> <span class=nx>_rows</span><span class=p>,</span> <span class=nx>_cols</span> <span class=p>=</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span>

<span class=kd>type</span> <span class=nx>Board</span> <span class=kd>interface</span> <span class=p>{</span>
	<span class=nf>Display</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>type</span> <span class=nx>board</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>board</span> <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span>
<span class=p>}</span>

<span class=cm>/* 显示 4×4 网格形式的游戏界面
</span><span class=cm>*/</span>
<span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>Display</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>b</span><span class=p>.</span><span class=nx>board</span> <span class=p>=</span> <span class=nf>generate</span><span class=p>(</span><span class=p>)</span>
	<span class=nf>printHorizontalLine</span><span class=p>(</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nf>printVerticalLine</span><span class=p>(</span><span class=p>)</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
            <span class=c1>// 每个数字占7个位置，如果为0，输出空字符
</span><span class=c1></span>			<span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
				<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%7s&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span><span class=c1>// 数字不为0，使其位于中间，方法是使其占4位，然后接着输出3个空字符
</span><span class=c1></span>				<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%4d%3s&#34;</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
			<span class=p>}</span>
			<span class=nf>printVerticalLine</span><span class=p>(</span><span class=p>)</span>
		<span class=p>}</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=p>)</span>
		<span class=nf>printHorizontalLine</span><span class=p>(</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=c1>// 输出横线，4*7+5 = 33
</span><span class=c1></span><span class=kd>func</span> <span class=nf>printHorizontal</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>33</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;-&#34;</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// 输出竖线
</span><span class=c1></span><span class=kd>func</span> <span class=nf>printVertical</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;|&#34;</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// 生成所需的所有随机数
</span><span class=c1></span><span class=kd>func</span> <span class=nf>generate</span><span class=p>(</span><span class=p>)</span> <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span> <span class=p>{</span>
	<span class=c1>// Store all available numbers from 2 to 2048
</span><span class=c1></span>	<span class=nx>nums</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
	<span class=nx>nums</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>nums</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>2</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;=</span> <span class=mi>2048</span><span class=p>;</span> <span class=nx>i</span> <span class=o>*=</span> <span class=mi>2</span> <span class=p>{</span>
		<span class=nx>nums</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>nums</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// generate random numbers for init board
</span><span class=c1></span>	<span class=nx>rand</span><span class=p>.</span><span class=nf>Seed</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(</span><span class=p>)</span><span class=p>.</span><span class=nf>UnixNano</span><span class=p>(</span><span class=p>)</span><span class=p>)</span>
    <span class=nx>matrix</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>_rows</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>matrix</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>_cols</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
			<span class=nx>matrix</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=p>=</span> <span class=nx>nums</span><span class=p>[</span><span class=nx>rand</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=p>)</span><span class=o>%</span><span class=nb>len</span><span class=p>(</span><span class=nx>nums</span><span class=p>)</span><span class=p>]</span>
		<span class=p>}</span>
	<span class=p>}</span>

	<span class=k>return</span> <span class=nx>matrix</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>NewBoard</span><span class=p>(</span><span class=p>)</span> <span class=o>*</span><span class=nx>Board</span> <span class=p>{</span>
	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>board</span><span class=p>{</span><span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>然后修改 main.go 如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// main.go
</span><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>

	<span class=s>&#34;github.com/shuzang/2048/game&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Getting started!&#34;</span><span class=p>)</span>
	<span class=nx>b</span> <span class=o>:=</span> <span class=nx>game</span><span class=p>.</span><span class=nf>NewBoard</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>Display</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>运行 <code>go run main.go</code> 可以看到一个临时的游戏面板。</p><a class=post-dummy-target id=3-添加元素></a><h2>3. 添加元素</h2><p>上面的程序随机生成了 16 个数字填充游戏面板，但这只是初始测试，正式游戏的做法是：初始时随机填充两个数字，然后每个键盘输入新增一个数字。这里还要注意每一步生成的数字有两种选择，2 或 4，我们可以控制这两个数字生成的概率。</p><p>所以添加新元素被抽象为一个独立的函数，如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// game/board.go
</span><span class=c1></span><span class=kd>type</span> <span class=nx>board</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>board</span>  <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span>
	<span class=nx>nx</span><span class=p>,</span> <span class=nx>ny</span> <span class=kt>int</span>
<span class=p>}</span>

<span class=c1>// 被折叠的代码...
</span><span class=c1></span>
<span class=c1>// 随机填充一个新数字
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>AddElement</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>rand</span><span class=p>.</span><span class=nf>Seed</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(</span><span class=p>)</span><span class=p>.</span><span class=nf>UnixNano</span><span class=p>(</span><span class=p>)</span><span class=p>)</span>
	<span class=c1>// 随机选择一个空白位置
</span><span class=c1></span>	<span class=nx>index</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
			<span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
				<span class=nx>index</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>index</span><span class=p>,</span> <span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=nx>i</span><span class=p>,</span> <span class=nx>j</span><span class=p>}</span><span class=p>)</span>
			<span class=p>}</span>
		<span class=p>}</span>
	<span class=p>}</span>
	<span class=nx>next</span> <span class=o>:=</span> <span class=nx>rand</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=p>)</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=nx>index</span><span class=p>)</span>
	<span class=nx>nx</span><span class=p>,</span> <span class=nx>ny</span> <span class=o>:=</span> <span class=nx>index</span><span class=p>[</span><span class=nx>next</span><span class=p>]</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=p>,</span> <span class=nx>index</span><span class=p>[</span><span class=nx>next</span><span class=p>]</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
    
	<span class=c1>// 按概率选择数字 2 和 4
</span><span class=c1></span>	<span class=kd>var</span> <span class=nx>number</span> <span class=kt>int</span>
	<span class=k>if</span> <span class=nx>rand</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=p>)</span><span class=o>%</span><span class=mi>100</span> <span class=p>&lt;</span> <span class=mi>80</span> <span class=p>{</span>
		<span class=nx>number</span> <span class=p>=</span> <span class=mi>2</span>
	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
		<span class=nx>number</span> <span class=p>=</span> <span class=mi>4</span>
	<span class=p>}</span>
	<span class=c1>// 将数字填充到选择的位置
</span><span class=c1></span>    <span class=nx>b</span><span class=p>.</span><span class=nx>nx</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>ny</span> <span class=p>=</span> <span class=nx>nx</span><span class=p>,</span> <span class=nx>ny</span>
	<span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>nx</span><span class=p>]</span><span class=p>[</span><span class=nx>ny</span><span class=p>]</span> <span class=p>=</span> <span class=nx>number</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>NewBoard</span><span class=p>(</span><span class=p>)</span> <span class=o>*</span><span class=nx>board</span> <span class=p>{</span>
	<span class=nx>matrix</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>_rows</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>matrix</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>_cols</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>board</span><span class=p>{</span><span class=nx>board</span><span class=p>:</span> <span class=nx>matrix</span><span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>board 结构体新增了 nx,ny 两个字段，是为了标记新添加的元素在游戏面板中的位置，我们需要将新元素以不同的颜色表示，这里用到了 fatih/color 包。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ go get -v github.com/gatih/color
</code></pre></td></tr></table></div></div><p>导入该包后修改显示函数如下，用不同的颜色输出新添加的元素。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// game/board.go
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>Display</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>c</span> <span class=o>:=</span> <span class=nx>color</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>color</span><span class=p>.</span><span class=nx>FgCyan</span><span class=p>,</span> <span class=nx>color</span><span class=p>.</span><span class=nx>Bold</span><span class=p>)</span>
	<span class=nf>printHorizontalLine</span><span class=p>(</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nf>printVerticalLine</span><span class=p>(</span><span class=p>)</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
			<span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
				<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%7s&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
			<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>i</span> <span class=o>==</span> <span class=nx>b</span><span class=p>.</span><span class=nx>nx</span> <span class=o>&amp;&amp;</span> <span class=nx>j</span> <span class=o>==</span> <span class=nx>b</span><span class=p>.</span><span class=nx>ny</span> <span class=p>{</span>
				<span class=nx>c</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%4d%3s&#34;</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
				<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%4d%3s&#34;</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
			<span class=p>}</span>
			<span class=nf>printVerticalLine</span><span class=p>(</span><span class=p>)</span>
		<span class=p>}</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=p>)</span>
		<span class=nf>printHorizontalLine</span><span class=p>(</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>相应的，主函数修改如下，添加 10 个元素并输出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// main.go
</span><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Getting started!&#34;</span><span class=p>)</span>
    <span class=nx>b</span> <span class=o>:=</span> <span class=nx>game</span><span class=p>.</span><span class=nf>NewBoard</span><span class=p>(</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>Display</span><span class=p>(</span><span class=p>)</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=p>)</span>		
	<span class=p>}</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Game over!&#34;</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><a class=post-dummy-target id=4-先清屏后显示></a><h2>4. 先清屏后显示</h2><p>上面的程序会把每一步的面板都输出到终端，我们应当添加的一个功能是，每一步只输出当前的游戏面板。该功能通过清屏函数实现，注意，清屏的实现在不同操作系统可能会有区别，下面的实现适用于 Windows 系统。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// game/board.go
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>Display</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=c1>// clear screen, but only works on windows
</span><span class=c1></span>	<span class=nx>cmd</span> <span class=o>:=</span> <span class=nx>exec</span><span class=p>.</span><span class=nf>Command</span><span class=p>(</span><span class=s>&#34;cmd&#34;</span><span class=p>,</span> <span class=s>&#34;/c&#34;</span><span class=p>,</span> <span class=s>&#34;cls&#34;</span><span class=p>)</span>
	<span class=nx>cmd</span><span class=p>.</span><span class=nx>Stdout</span> <span class=p>=</span> <span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span>
	<span class=nx>cmd</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>c</span> <span class=o>:=</span> <span class=nx>color</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>color</span><span class=p>.</span><span class=nx>FgCyan</span><span class=p>,</span> <span class=nx>color</span><span class=p>.</span><span class=nx>Bold</span><span class=p>)</span>
	<span class=nf>printHorizontalLine</span><span class=p>(</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nf>printVerticalLine</span><span class=p>(</span><span class=p>)</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
			<span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
				<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%7s&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
			<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>i</span> <span class=o>==</span> <span class=nx>b</span><span class=p>.</span><span class=nx>nx</span> <span class=o>&amp;&amp;</span> <span class=nx>j</span> <span class=o>==</span> <span class=nx>b</span><span class=p>.</span><span class=nx>ny</span> <span class=p>{</span>
				<span class=nx>c</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%4d%3s&#34;</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
				<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%4d%3s&#34;</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
			<span class=p>}</span>

			<span class=nf>printVerticalLine</span><span class=p>(</span><span class=p>)</span>
		<span class=p>}</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=p>)</span>
		<span class=nf>printHorizontalLine</span><span class=p>(</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><a class=post-dummy-target id=5-获取键盘输入></a><h2>5. 获取键盘输入</h2><p>游戏的每一步操作肯定都是根据键盘的输入来的，可以使用 {W, A, S, D} 和 方向键，如果使用 fmt 包中的输入函数，那么每次输入后都需要手动按下回车。为了不必每次输入字符后都敲一下回车键，我们使用 eiannone/keyboard 包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>$ go get -v github.com/eiannone/keyboard
</code></pre></td></tr></table></div></div><p>将键盘输入对应的几个操作定义为几个常量，然后调用 keyboard 包中的 GetKeyStrokes() 函数接收键盘输入，返回对应的常量，最后在 TakeInput() 函数中根据不同常量交给对应的操作函数处理。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// game/board.go
</span><span class=c1></span><span class=kd>type</span> <span class=nx>Key</span> <span class=kt>int</span>

<span class=c1>// 几个操作常量，向四个方向移动、退出和错误按键
</span><span class=c1></span><span class=kd>const</span> <span class=p>(</span>
	<span class=nx>UP</span> <span class=nx>Key</span> <span class=p>=</span> <span class=kc>iota</span>
	<span class=nx>DOWN</span>
	<span class=nx>LEFT</span>
	<span class=nx>RIGHT</span>
	<span class=nx>QUIT</span>
	<span class=nx>ERROR_KEY</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>TakeInput</span><span class=p>(</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
	<span class=nx>key</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>GetKeyStrokes</span><span class=p>(</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=p>)</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=k>if</span> <span class=nx>key</span> <span class=o>==</span> <span class=nx>ERROR_KEY</span> <span class=p>{</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>TakeInput</span><span class=p>(</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=k>switch</span> <span class=nx>key</span> <span class=p>{</span>
	<span class=k>case</span> <span class=nx>UP</span><span class=p>:</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>moveUp</span><span class=p>(</span><span class=p>)</span>
	<span class=k>case</span> <span class=nx>DOWN</span><span class=p>:</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>moveDown</span><span class=p>(</span><span class=p>)</span>
	<span class=k>case</span> <span class=nx>LEFT</span><span class=p>:</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>moveLeft</span><span class=p>(</span><span class=p>)</span>
	<span class=k>case</span> <span class=nx>RIGHT</span><span class=p>:</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>moveRight</span><span class=p>(</span><span class=p>)</span>
	<span class=k>case</span> <span class=nx>QUIT</span><span class=p>:</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;You press ESC, game exit!&#34;</span><span class=p>)</span>
		<span class=k>return</span> <span class=kc>false</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=kc>true</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>GetKeyStrokes</span><span class=p>(</span><span class=p>)</span> <span class=p>(</span><span class=nx>Key</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>char</span><span class=p>,</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>keyboard</span><span class=p>.</span><span class=nf>GetSingleKey</span><span class=p>(</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=k>return</span> <span class=nx>ERROR_KEY</span><span class=p>,</span> <span class=nx>err</span>
	<span class=p>}</span>
	<span class=c1>//fmt.Printf(&#34;You pressed: %c, key %X\r\n&#34;, char, key)
</span><span class=c1></span>	<span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=nx>char</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
		<span class=k>switch</span> <span class=nx>key</span> <span class=p>{</span>
		<span class=k>case</span> <span class=nx>keyboard</span><span class=p>.</span><span class=nx>KeyArrowUp</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>UP</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>case</span> <span class=nx>keyboard</span><span class=p>.</span><span class=nx>KeyArrowDown</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>DOWN</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>case</span> <span class=nx>keyboard</span><span class=p>.</span><span class=nx>KeyArrowLeft</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>LEFT</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>case</span> <span class=nx>keyboard</span><span class=p>.</span><span class=nx>KeyArrowRight</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>RIGHT</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>case</span> <span class=nx>keyboard</span><span class=p>.</span><span class=nx>KeyEsc</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>QUIT</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>default</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>ERROR_KEY</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;Invalid key, please press again!&#34;</span><span class=p>)</span>
		<span class=p>}</span>
	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
		<span class=k>switch</span> <span class=nx>char</span> <span class=p>{</span>
		<span class=k>case</span> <span class=mi>119</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>UP</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>case</span> <span class=mi>97</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>LEFT</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>case</span> <span class=mi>115</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>DOWN</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>case</span> <span class=mi>100</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>RIGHT</span><span class=p>,</span> <span class=kc>nil</span>
		<span class=k>default</span><span class=p>:</span>
			<span class=k>return</span> <span class=nx>ERROR_KEY</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;Invalid key, please press again!&#34;</span><span class=p>)</span>
		<span class=p>}</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>游戏退出有两种情况，一个是上面程序中定义的 QUIT 操作，用于游戏过程中主动输入 ESC 按键退出，另一个是游戏面板 16 个数字已满，Game over，通过添加以下函数实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// game/board.go
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>IsOver</span><span class=p>(</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
	<span class=nx>blank</span> <span class=o>:=</span> <span class=mi>0</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
			<span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
				<span class=nx>blank</span><span class=o>++</span>
			<span class=p>}</span>
		<span class=p>}</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=nx>blank</span> <span class=o>==</span> <span class=mi>0</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>最后是程序开始的逻辑，即输入任意键开始。这部分逻辑在 main 函数中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// main.go
</span><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Use {W A S D} or Arrow keys to move the board&#34;</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Press and key to start\n&#34;</span><span class=p>)</span>
	<span class=nx>_</span><span class=p>,</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>keyboard</span><span class=p>.</span><span class=nf>GetSingleKey</span><span class=p>(</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalln</span><span class=p>(</span><span class=s>&#34;error while taking input to start the game&#34;</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=nx>b</span> <span class=o>:=</span> <span class=nx>game</span><span class=p>.</span><span class=nf>NewBoard</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=p>)</span>
	<span class=k>for</span> <span class=kc>true</span> <span class=p>{</span>
		<span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nf>IsOver</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
			<span class=k>break</span>
		<span class=p>}</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=p>)</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>Display</span><span class=p>(</span><span class=p>)</span>
		<span class=nx>res</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nf>TakeInput</span><span class=p>(</span><span class=p>)</span>
		<span class=k>if</span> <span class=p>!</span><span class=nx>res</span> <span class=p>{</span>
			<span class=k>return</span>
		<span class=p>}</span>

	<span class=p>}</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;game over&#34;</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><a class=post-dummy-target id=6-数字移动合并></a><h2>6. 数字移动合并</h2><p>每个键盘输入都对应一个操作函数，四个方向的数字移动和合并是游戏的核心逻辑。如下，向左移动数字和合并单独实现，向右、向上和向下都能通过矩阵旋转转换为向左移动和合并的问题。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// game/board.go
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>moveLeft</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>old</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
		<span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nf>moveRow</span><span class=p>(</span><span class=nx>old</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>moveRight</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>Reverse</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>moveLeft</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>Reverse</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>moveUp</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>leftRotate90</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>moveLeft</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>rightRotate90</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>moveDown</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>rightRotate90</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>moveLeft</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>leftRotate90</span><span class=p>(</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>rightRotate90</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>matrix</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>_rows</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>matrix</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>_cols</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
			<span class=nx>matrix</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span><span class=p>[</span><span class=nx>_cols</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span>
		<span class=p>}</span>
	<span class=p>}</span>
	<span class=nx>b</span><span class=p>.</span><span class=nx>board</span> <span class=p>=</span> <span class=nx>matrix</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>leftRotate90</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>matrix</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>_rows</span><span class=p>)</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=nx>matrix</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>_cols</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
			<span class=nx>matrix</span><span class=p>[</span><span class=nx>_cols</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=nx>j</span><span class=p>]</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span>
		<span class=p>}</span>
	<span class=p>}</span>
	<span class=nx>b</span><span class=p>.</span><span class=nx>board</span> <span class=p>=</span> <span class=nx>matrix</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>Reverse</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>for</span> <span class=nx>j</span><span class=p>,</span> <span class=nx>k</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>_cols</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>k</span><span class=p>;</span> <span class=nx>j</span><span class=p>,</span> <span class=nx>k</span> <span class=p>=</span> <span class=nx>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=nx>k</span><span class=o>-</span><span class=mi>1</span> <span class=p>{</span>
			<span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>k</span><span class=p>]</span> <span class=p>=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>k</span><span class=p>]</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span>
		<span class=p>}</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>moveRow</span><span class=p>(</span><span class=nx>row</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>)</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span> <span class=p>{</span>
	<span class=nx>index</span> <span class=o>:=</span> <span class=mi>0</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>row</span><span class=p>)</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>if</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>0</span> <span class=p>{</span>
			<span class=nx>row</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span><span class=p>,</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>,</span> <span class=nx>row</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span>
			<span class=nx>index</span><span class=o>++</span>
		<span class=p>}</span>
	<span class=p>}</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>row</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>if</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>==</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=p>{</span>
			<span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>+=</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span>
			<span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=p>=</span> <span class=mi>0</span>
			<span class=nx>i</span><span class=o>++</span>
		<span class=p>}</span>
	<span class=p>}</span>
	<span class=nx>index</span> <span class=p>=</span> <span class=mi>0</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>row</span><span class=p>)</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>if</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>0</span> <span class=p>{</span>
			<span class=nx>row</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span><span class=p>,</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>row</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>,</span> <span class=nx>row</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span>
			<span class=nx>index</span><span class=o>++</span>
		<span class=p>}</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=nx>row</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>由于这部分逻辑比较复杂，需要测试一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// game/board_test.go
</span><span class=c1></span><span class=kn>package</span> <span class=nx>game</span>

<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;reflect&#34;</span>
	<span class=s>&#34;testing&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>TestMoveRow</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>tests</span> <span class=o>:=</span> <span class=p>[</span><span class=p>]</span><span class=kd>struct</span> <span class=p>{</span>
		<span class=nx>name</span>  <span class=kt>string</span>
		<span class=nx>input</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span>
		<span class=nx>want</span>  <span class=p>[</span><span class=p>]</span><span class=kt>int</span>
	<span class=p>}</span><span class=p>{</span>
		<span class=p>{</span>
			<span class=nx>name</span><span class=p>:</span>  <span class=s>&#34;one&#34;</span><span class=p>,</span>
			<span class=nx>input</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>}</span><span class=p>,</span>
			<span class=nx>want</span><span class=p>:</span>  <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>}</span><span class=p>,</span>
		<span class=p>}</span><span class=p>,</span>
		<span class=p>{</span>
			<span class=nx>name</span><span class=p>:</span>  <span class=s>&#34;two&#34;</span><span class=p>,</span>
			<span class=nx>input</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>8</span><span class=p>}</span><span class=p>,</span>
			<span class=nx>want</span><span class=p>:</span>  <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>0</span><span class=p>}</span><span class=p>,</span>
		<span class=p>}</span><span class=p>,</span>
		<span class=p>{</span>
			<span class=nx>name</span><span class=p>:</span>  <span class=s>&#34;three&#34;</span><span class=p>,</span>
			<span class=nx>input</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>8</span><span class=p>}</span><span class=p>,</span>
			<span class=nx>want</span><span class=p>:</span>  <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>0</span><span class=p>}</span><span class=p>,</span>
		<span class=p>}</span><span class=p>,</span>
		<span class=p>{</span>
			<span class=nx>name</span><span class=p>:</span>  <span class=s>&#34;four&#34;</span><span class=p>,</span>
			<span class=nx>input</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>}</span><span class=p>,</span>
			<span class=nx>want</span><span class=p>:</span>  <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>0</span><span class=p>}</span><span class=p>,</span>
		<span class=p>}</span><span class=p>,</span>
		<span class=p>{</span>
			<span class=nx>name</span><span class=p>:</span>  <span class=s>&#34;five&#34;</span><span class=p>,</span>
			<span class=nx>input</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>}</span><span class=p>,</span>
			<span class=nx>want</span><span class=p>:</span>  <span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>}</span><span class=p>,</span>
		<span class=p>}</span><span class=p>,</span>
	<span class=p>}</span>
	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tests</span> <span class=p>{</span>
		<span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
			<span class=k>if</span> <span class=nx>got</span> <span class=o>:=</span> <span class=nf>moveRow</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>input</span><span class=p>)</span><span class=p>;</span> <span class=p>!</span><span class=nx>reflect</span><span class=p>.</span><span class=nf>DeepEqual</span><span class=p>(</span><span class=nx>got</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span> <span class=p>{</span>
				<span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;moveRow() = %v, want %v&#34;</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span>
			<span class=p>}</span>
		<span class=p>}</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>TestLeftRotate90</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
	<span class=kd>type</span> <span class=nx>fields</span> <span class=kd>struct</span> <span class=p>{</span>
		<span class=nx>matrix</span> <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span>
	<span class=p>}</span>

	<span class=nx>tests</span> <span class=o>:=</span> <span class=p>[</span><span class=p>]</span><span class=kd>struct</span> <span class=p>{</span>
		<span class=nx>name</span>   <span class=kt>string</span>
		<span class=nx>fields</span> <span class=nx>fields</span>
		<span class=nx>want</span>   <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span>
	<span class=p>}</span><span class=p>{</span>
		<span class=p>{</span>
			<span class=nx>name</span><span class=p>:</span> <span class=s>&#34;one&#34;</span><span class=p>,</span>
			<span class=nx>fields</span><span class=p>:</span> <span class=nx>fields</span><span class=p>{</span>
				<span class=nx>matrix</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span>
					<span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>9</span><span class=p>}</span><span class=p>,</span>
					<span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>10</span><span class=p>}</span><span class=p>,</span>
					<span class=p>{</span><span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>11</span><span class=p>}</span><span class=p>,</span>
					<span class=p>{</span><span class=mi>16</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=mi>111</span><span class=p>}</span><span class=p>,</span>
				<span class=p>}</span><span class=p>,</span>
			<span class=p>}</span><span class=p>,</span>
			<span class=nx>want</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span>
				<span class=p>{</span><span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>111</span><span class=p>}</span><span class=p>,</span>
				<span class=p>{</span><span class=mi>3</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>18</span><span class=p>}</span><span class=p>,</span>
				<span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>17</span><span class=p>}</span><span class=p>,</span>
				<span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>16</span><span class=p>}</span><span class=p>,</span>
			<span class=p>}</span><span class=p>,</span>
		<span class=p>}</span><span class=p>,</span>
	<span class=p>}</span>
	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tests</span> <span class=p>{</span>
		<span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
			<span class=nx>b</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>board</span><span class=p>{</span><span class=nx>board</span><span class=p>:</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>fields</span><span class=p>.</span><span class=nx>matrix</span><span class=p>}</span>
			<span class=nx>b</span><span class=p>.</span><span class=nf>leftRotate90</span><span class=p>(</span><span class=p>)</span>
			<span class=k>if</span> <span class=p>!</span><span class=nx>reflect</span><span class=p>.</span><span class=nf>DeepEqual</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span> <span class=p>{</span>
				<span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;b.leftRotate90() = %v, want %v&#34;</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span>
			<span class=p>}</span>
		<span class=p>}</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>TestRightRotate90</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
	<span class=kd>type</span> <span class=nx>fields</span> <span class=kd>struct</span> <span class=p>{</span>
		<span class=nx>matrix</span> <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span>
	<span class=p>}</span>

	<span class=nx>tests</span> <span class=o>:=</span> <span class=p>[</span><span class=p>]</span><span class=kd>struct</span> <span class=p>{</span>
		<span class=nx>name</span>   <span class=kt>string</span>
		<span class=nx>fields</span> <span class=nx>fields</span>
		<span class=nx>want</span>   <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span>
	<span class=p>}</span><span class=p>{</span>
		<span class=p>{</span>
			<span class=nx>name</span><span class=p>:</span> <span class=s>&#34;one&#34;</span><span class=p>,</span>
			<span class=nx>fields</span><span class=p>:</span> <span class=nx>fields</span><span class=p>{</span>
				<span class=nx>matrix</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span>
					<span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>9</span><span class=p>}</span><span class=p>,</span>
					<span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>10</span><span class=p>}</span><span class=p>,</span>
					<span class=p>{</span><span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>11</span><span class=p>}</span><span class=p>,</span>
					<span class=p>{</span><span class=mi>16</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=mi>111</span><span class=p>}</span><span class=p>,</span>
				<span class=p>}</span><span class=p>,</span>
			<span class=p>}</span><span class=p>,</span>
			<span class=nx>want</span><span class=p>:</span> <span class=p>[</span><span class=p>]</span><span class=p>[</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span>
				<span class=p>{</span><span class=mi>16</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>}</span><span class=p>,</span>
				<span class=p>{</span><span class=mi>17</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>}</span><span class=p>,</span>
				<span class=p>{</span><span class=mi>18</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span><span class=p>,</span>
				<span class=p>{</span><span class=mi>111</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>9</span><span class=p>}</span><span class=p>,</span>
			<span class=p>}</span><span class=p>,</span>
		<span class=p>}</span><span class=p>,</span>
	<span class=p>}</span>
	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tests</span> <span class=p>{</span>
		<span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
			<span class=nx>b</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>board</span><span class=p>{</span><span class=nx>board</span><span class=p>:</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>fields</span><span class=p>.</span><span class=nx>matrix</span><span class=p>}</span>
			<span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nf>rightRotate90</span><span class=p>(</span><span class=p>)</span><span class=p>;</span> <span class=p>!</span><span class=nx>reflect</span><span class=p>.</span><span class=nf>DeepEqual</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span> <span class=p>{</span>
				<span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;b.rightRotate90() = %v, want %v&#34;</span><span class=p>,</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span>
			<span class=p>}</span>
		<span class=p>}</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><a class=post-dummy-target id=7-分数计算></a><h2>7. 分数计算</h2><p>游戏正常结束后显示当前最大分数和总分数，算是一个小功能。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>//game/board.go
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>board</span><span class=p>)</span> <span class=nf>CountScore</span><span class=p>(</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>total</span><span class=p>,</span> <span class=nx>max</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span>
	<span class=nx>matrix</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>board</span>
	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>_rows</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
		<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>_cols</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
			<span class=nx>total</span> <span class=o>+=</span> <span class=nx>matrix</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span>
			<span class=nx>max</span> <span class=p>=</span> <span class=nf>maxInts</span><span class=p>(</span><span class=nx>max</span><span class=p>,</span> <span class=nx>matrix</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span><span class=p>)</span>
		<span class=p>}</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=nx>max</span><span class=p>,</span> <span class=nx>total</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>maxInts</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
	<span class=k>if</span> <span class=nx>a</span> <span class=p>&gt;</span> <span class=nx>b</span> <span class=p>{</span>
		<span class=k>return</span> <span class=nx>a</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=nx>b</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>//main.go
</span><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Use {W A S D} or Arrow keys to move the board&#34;</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Press and key to start\n&#34;</span><span class=p>)</span>
	<span class=nx>_</span><span class=p>,</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>keyboard</span><span class=p>.</span><span class=nf>GetSingleKey</span><span class=p>(</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalln</span><span class=p>(</span><span class=s>&#34;error while taking input to start the game&#34;</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=nx>b</span> <span class=o>:=</span> <span class=nx>game</span><span class=p>.</span><span class=nf>NewBoard</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>b</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=p>)</span>
	<span class=k>for</span> <span class=kc>true</span> <span class=p>{</span>
		<span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nf>IsOver</span><span class=p>(</span><span class=p>)</span> <span class=p>{</span>
			<span class=k>break</span>
		<span class=p>}</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=p>)</span>
		<span class=nx>b</span><span class=p>.</span><span class=nf>Display</span><span class=p>(</span><span class=p>)</span>
		<span class=nx>res</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nf>TakeInput</span><span class=p>(</span><span class=p>)</span>
		<span class=k>if</span> <span class=p>!</span><span class=nx>res</span> <span class=p>{</span>
			<span class=k>return</span>
		<span class=p>}</span>

	<span class=p>}</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;\n**********  game over  **********&#34;</span><span class=p>)</span>
	<span class=nx>max</span><span class=p>,</span> <span class=nx>total</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nf>CountScore</span><span class=p>(</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Max Score: %v \n&#34;</span><span class=p>,</span> <span class=nx>max</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Total Score %v \n&#34;</span><span class=p>,</span> <span class=nx>total</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><a class=post-dummy-target id=8-代码重构></a><h2>8. 代码重构</h2><p>所有功能完成后，对代码进行重构整理，包括</p><ol><li>将数字移动合并的相关代码移动到单独的 <code>move.go</code> 源文件中；</li><li>（可选）将输入和显示的相关函数都拆分到单独的源文件中；</li><li>为所有代码添加注释，并编写 README.md 文档；</li></ol><a class=post-dummy-target id=9-结果与收获></a><h2>9. 结果与收获</h2><p>完整的项目代码可以查看我的 <a href=https://github.com/shuzang/2048 target=_blank>github 仓库</a>，与原项目有一些实现上的区别，并完善了一些功能。</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/Go_20201008_2048.gif alt=2048 class=lazyload><figcaption class=image-caption>2048</figcaption></figure></p><p>编写该项目的收获有</p><ol><li>开源协议的选择；</li><li>对结构体和接口作用和意义的思考；</li><li>一个项目是从简单到复杂一步步建立的，不要想一步登天做的很完善；</li><li>方法中 (b *board) 和 (b board) 的区别；</li><li>一些重要的可定制的参数可以抽取作为为常量，比如面板规格，常量命名时前面最好加下划线 <code>_</code> 加以区分；</li><li>fmt.Printf 可以输出固定长度的空字符用于占位，fmt.Println() 可以用来换行；</li><li>随机数的生成方法，一个小技巧是使用数组存放待选择数字，然后随机生成数组长度范围内的数字作为索引进行选择；</li><li>结构体对象的生成可以使用工厂模式，比如 NewBoard 函数；</li><li>格式化输出的颜色控制（fatih/color包）；</li><li>清屏的实现方法；</li><li>无需回车不断读取键盘输入的实现方法（eiannone/keyboard包）;</li><li>矩阵旋转等大量关于二维切片的算法实现（PS：刷题还是有用的）；</li><li>测试用例的编写；</li><li>所有功能完成后，根据情况进行重构，比如代码的解耦等，然后完成添加注释、编写文档等工作；</li><li>Go 文档的编写与使用；</li><li>日志系统的使用。</li></ol></div><div class=post-copyright id=post-footer><p class=copyright-item><span>Author:&nbsp;</span>
<span>shuzang</span></p><p class=copyright-item><span>Updated on:&nbsp;</span>
<span>2020-10-10</span></p><p class=copyright-item><span>Share on:&nbsp;</span>
<span><a href="//twitter.com/share?url=https%3a%2f%2fshuzang.github.io%2f2020%2fa-cli-implement-of-2048-game-using-go%2f&text=Go%e5%ae%9e%e7%8e%b02048%e5%b0%8f%e6%b8%b8%e6%88%8f&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-fw"></i></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fshuzang.github.io%2f2020%2fa-cli-implement-of-2048-game-using-go%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook-square fa-fw"></i></a><a href="//reddit.com/submit?url=https%3a%2f%2fshuzang.github.io%2f2020%2fa-cli-implement-of-2048-game-using-go%2f&title=Go%e5%ae%9e%e7%8e%b02048%e5%b0%8f%e6%b8%b8%e6%88%8f" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-fw"></i></a></span></p><p class=copyright-item></p><p class=copyright-item></p></div><br><div class=post-info-more><section><span class=tag><a href=https://shuzang.github.io/tags/go%E5%AE%9E%E6%88%98/><i class="fas fa-tag fa-fw"></i>&nbsp;Go实战</a>&nbsp;</span></section><section><span><a href=javascript:window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=https://shuzang.github.io>Home</a></span></section></div><div class=post-nav><a href=https://shuzang.github.io/2020/efficient-use-of-win10-7-windows-terminal-and-winget/ class=prev rel=prev title=win10效率优化7-终端和winget><i class="fas fa-angle-left fa-fw"></i>win10效率优化7-终端和winget</a>
<a href=https://shuzang.github.io/2020/mysql-learning-supplement-temporary-table-and-derived-table/ class=next rel=next title=Mysql学习补充-临时表与派生表>Mysql学习补充-临时表与派生表<i class="fas fa-angle-right fa-fw"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://shuzang.github.io/about/ target=_blank>shuzang</a> | </span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a> & <a href=https://github.com/dillonzq/LoveIt target=_blank rel="external nofollow noopener noreffer">LoveIt</a></div></div></footer></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span></a>
<script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-209130979-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=/js/lib/jquery/jquery.slim.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.js></script><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><link rel=stylesheet href=/css/lib/katex/katex.min.css><script src=/js/lib/katex/katex.min.js></script><script defer src=/js/lib/katex/auto-render.min.js></script><link rel=stylesheet href=/css/lib/katex/copy-tex.min.css><script defer src=/js/lib/katex/copy-tex.min.js></script><script defer src=/js/lib/katex/mhchem.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true},{left:"$",right:"$",display:false},]});});</script><script src=/js/blog.min.js></script></body></html>