<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Docker-镜像、容器与仓库 - Shuzang's Blog</title><meta name=author content="Shuzang"><meta name=author-link content><meta name=description content="Docker 的三个基本概念是镜像（Image）、容器（Container）和仓库（Repository），理解了这三个概念基本就理解了 Docker。"><meta name=keywords content="linux"><meta itemprop=name content="Docker-镜像、容器与仓库"><meta itemprop=description content="Docker 的三个基本概念是镜像（Image）、容器（Container）和仓库（Repository），理解了这三个概念基本就理解了 Docker。"><meta itemprop=datePublished content="2020-05-18T09:00:00+08:00"><meta itemprop=dateModified content="2020-05-18T09:00:00+08:00"><meta itemprop=wordCount content="4893"><meta itemprop=image content="https://shuzang.github.io/logo.png"><meta itemprop=keywords content="linux,"><meta property="og:title" content="Docker-镜像、容器与仓库"><meta property="og:description" content="Docker 的三个基本概念是镜像（Image）、容器（Container）和仓库（Repository），理解了这三个概念基本就理解了 Docker。"><meta property="og:type" content="article"><meta property="og:url" content="https://shuzang.github.io/2020/image-container-and-repository/"><meta property="og:image" content="https://shuzang.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-18T09:00:00+08:00"><meta property="article:modified_time" content="2020-05-18T09:00:00+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shuzang.github.io/logo.png"><meta name=twitter:title content="Docker-镜像、容器与仓库"><meta name=twitter:description content="Docker 的三个基本概念是镜像（Image）、容器（Container）和仓库（Repository），理解了这三个概念基本就理解了 Docker。"><meta name=application-name content="Shuzang's Blog"><meta name=apple-mobile-web-app-title content="Shuzang's Blog"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://shuzang.github.io/2020/image-container-and-repository/><link rel=prev href=https://shuzang.github.io/2020/algorithm-backtracking/><link rel=next href=https://shuzang.github.io/2020/network/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Docker-镜像、容器与仓库","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shuzang.github.io\/2020\/image-container-and-repository\/"},"genre":"posts","keywords":"linux","wordcount":4893,"url":"https:\/\/shuzang.github.io\/2020\/image-container-and-repository\/","datePublished":"2020-05-18T09:00:00+08:00","dateModified":"2020-05-18T09:00:00+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Shuzang"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title="Shuzang's Blog" data-alt="Shuzang's Blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collection/><i class="fa-solid fa-bookmark fa-fw fa-sm" aria-hidden=true></i> 集子</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title=/images/avatar.png data-alt=/images/avatar.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/collection/><i class="fa-solid fa-bookmark fa-fw fa-sm" aria-hidden=true></i> 集子</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Docker-镜像、容器与仓库</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title=Shuzang data-alt=Shuzang class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;Shuzang</span></span>
<span class=post-category>收录于 <a href=/categories/%E7%88%B1%E7%BC%96%E7%A8%8B%E7%88%B1%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AD%A9%E5%AD%90/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 爱编程爱技术的孩子</a></span></div><div class=post-meta-line><span title="发布于 2020-05-18 09:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2020-05-18>2020-05-18</time></span>&nbsp;<span title="更新于 2020-05-18 09:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2020-05-18>2020-05-18</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 4893 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 10 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-镜像>1. 镜像</a><ul><li><a href=#11-union-fs>1.1 Union FS</a></li><li><a href=#12-镜像使用>1.2 镜像使用</a><ul><li><a href=#获取镜像>获取镜像</a></li><li><a href=#列出镜像>列出镜像</a></li><li><a href=#删除本地镜像>删除本地镜像</a></li><li><a href=#虚悬镜像>虚悬镜像</a></li></ul></li></ul></li><li><a href=#2-容器>2. 容器</a><ul><li><a href=#21-启动>2.1 启动</a><ul><li><a href=#新建并启动>新建并启动</a></li><li><a href=#启动已终止容器>启动已终止容器</a></li></ul></li><li><a href=#22-守护态运行>2.2 守护态运行</a></li><li><a href=#23-终止>2.3 终止</a></li><li><a href=#24-进入容器>2.4 进入容器</a><ul><li><a href=#attach-命令>attach 命令</a></li><li><a href=#exec-命令>exec 命令</a></li></ul></li><li><a href=#25-导出与导入>2.5 导出与导入</a></li><li><a href=#26-删除>2.6 删除</a></li></ul></li><li><a href=#3-仓库>3. 仓库</a></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-exclamation-triangle fa-fw" aria-hidden=true></i>警告<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>本文最后更新于 2020-05-18，文中内容可能已过时。</div></div></div><p>Docker 的三个基本概念是镜像（Image）、容器（Container）和仓库（Repository），理解了这三个概念基本就理解了 Docker。</p><h2 id=1-镜像>1. 镜像</h2><p>尽管都使用了镜像这个词，但 Docker 的镜像和虚拟机上安装的系统镜像并不完全相同。虚拟机安装的镜像是完整的操作系统，包括内核、根文件系统等部分，体积一般较大，比如 ubuntu20.04 LTS 就有2.5GB。而 Docker 的镜像不包括内核，可以看作一个定制的<strong>最小化</strong>的根文件系统，体积往往很小，本文写作时 docker ubuntu latest 仅有73.9MB。实际上，Docker 本身是基于宿主机的内核运行的。</p><h3 id=11-union-fs>1.1 Union FS</h3><p>Docker 镜像保持的如此之小，仅依靠去除内核和删减根文件系统是不够的，更重要的原因是，Docker 使用了 Union FS 的技术，整体设计是一个分层存储的架构。联合文件系统（UnionFS）是一种轻量级的高性能分层文件系统，它支持将文件系统中的修改信息作为一次提交，并层层叠加，同时可以将不同目录挂载到同一个虚拟文件系统下，应用看到的是挂载的最终结果。简单来说，镜像不是一整个文件，而是由一组文件系统组成，更具体一点，由多层文件系统组成。镜像构建时，会一层层构建，前一层是后一层的基础，每一层构建完就不会再发生改变，后一层的任何改变只会发生在自己这一层。比如，删除前一层文件的操作，实际不是真的删除前一层的文件，而是仅在当前层标记为该文件已删除。在最终容器运行的时候，虽然不会看到这个文件，但是实际上该文件会一直跟随镜像。因此，在构建镜像的时候，需要额外小心，每一层尽量只包含该层需要添加的东西，任何额外的东西应该在该层构建结束前清理掉。以 ubuntu 为例，下载镜像时我们可以很清楚的看到分了四层</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker pull ubuntu  
</span></span><span class=line><span class=cl>Using default tag: latest
</span></span><span class=line><span class=cl>latest: Pulling from library/ubuntu
</span></span><span class=line><span class=cl>d51af753c3d3: Pull <span class=nb>complete</span>  
</span></span><span class=line><span class=cl>fc878cd0a91c: Pull <span class=nb>complete</span>   
</span></span><span class=line><span class=cl>6154df8ff988: Pull <span class=nb>complete</span>   
</span></span><span class=line><span class=cl>fee5db0ff82f: Pull <span class=nb>complete</span>    
</span></span><span class=line><span class=cl>Digest: sha256:747d2dbbaaee995098c9792d99bd333c6783ce56150d1b11e333bbceed5c54d7
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> ubuntu:latest
</span></span><span class=line><span class=cl>docker.io/library/ubuntu:latest</span></span></code></pre></td></tr></table></div></div><p>使用 <code>docker history</code> 命令还可以查看镜像构建历史记录</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker <span class=nb>history</span> ubuntu
</span></span><span class=line><span class=cl>IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
</span></span><span class=line><span class=cl>1d622ef86b13        <span class=m>3</span> weeks ago         /bin/sh -c <span class=c1>#(nop)  CMD [&#34;/bin/bash&#34;]            0B</span>
</span></span><span class=line><span class=cl>&lt;missing&gt;           <span class=m>3</span> weeks ago         /bin/sh -c mkdir -p /run/systemd <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s1>&#39;do…   7B
</span></span></span><span class=line><span class=cl><span class=s1>&lt;missing&gt;           3 weeks ago         /bin/sh -c set -xe   &amp;&amp; echo &#39;</span><span class=c1>#!/bin/sh&#39; &gt; /…   811B</span>
</span></span><span class=line><span class=cl>&lt;missing&gt;           <span class=m>3</span> weeks ago         /bin/sh -c <span class=o>[</span> -z <span class=s2>&#34;</span><span class=k>$(</span>apt-get indextargets<span class=k>)</span><span class=s2>&#34;</span> <span class=o>]</span>     1.01MB
</span></span><span class=line><span class=cl>&lt;missing&gt;           <span class=m>3</span> weeks ago         /bin/sh -c <span class=c1>#(nop) ADD file:a58c8b447951f9e30…   72.8MB</span></span></span></code></pre></td></tr></table></div></div><p>分层存储的特征使得镜像的复用、定制变得更加容易，甚至可以用之前构建好的镜像作为基础层，然后一步步添加新层，以定制自己需要的内容，构建新的镜像。</p><h3 id=12-镜像使用>1.2 镜像使用</h3><p>Docker 运行容器前需要本地存在对应的镜像，如果本地不存在该镜像，Docker 会从镜像仓库下载该镜像。</p><h4 id=获取镜像>获取镜像</h4><p>从 Docker 镜像仓库获取镜像的命令是 <code>docker pull</code>。其命令格式为：</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker pull <span class=o>[</span>选项<span class=o>]</span> <span class=o>[</span>Docker Registry 地址<span class=o>[</span>:端口号<span class=o>]</span>/<span class=o>]</span>仓库名<span class=o>[</span>:标签<span class=o>]</span></span></span></code></pre></td></tr></table></div></div><p>选项部分包括三个参数，但很少用到，可以通过 <code>docker pull --help</code> 查看，这里介绍镜像名称的格式</p><ul><li><p>Docker 镜像仓库地址：地址的格式一般是 <code>&lt;域名/IP>[:端口号]</code>。默认地址是 Docker Hub（官方仓库地址）。</p></li><li><p>仓库名：仓库名是两段式名称，即 <code>&lt;用户名>/&lt;软件名></code>。对于 Docker Hub，如果不给出用户名，则默认为 <code>library</code>，也就是官方镜像。</p></li></ul><p>仍以 ubuntu 为例</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker pull ubuntu  
</span></span><span class=line><span class=cl>Using default tag: latest
</span></span><span class=line><span class=cl>latest: Pulling from library/ubuntu
</span></span><span class=line><span class=cl>d51af753c3d3: Pull <span class=nb>complete</span>  
</span></span><span class=line><span class=cl>fc878cd0a91c: Pull <span class=nb>complete</span>   
</span></span><span class=line><span class=cl>6154df8ff988: Pull <span class=nb>complete</span>   
</span></span><span class=line><span class=cl>fee5db0ff82f: Pull <span class=nb>complete</span>    
</span></span><span class=line><span class=cl>Digest: sha256:747d2dbbaaee995098c9792d99bd333c6783ce56150d1b11e333bbceed5c54d7
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> ubuntu:latest
</span></span><span class=line><span class=cl>docker.io/library/ubuntu:latest</span></span></code></pre></td></tr></table></div></div><p>命令中没有给出 Docker 镜像仓库地址，因此将会从 Docker Hub 获取镜像。镜像名称为 <code>ubuntu</code>，因此将会获取官方镜像 <code>library/ubuntu</code> 仓库中标签为 <code>latest</code> 的镜像。下载过程中给出了每一层的 ID 的前 12 位。并且下载结束后，给出该镜像完整的 <code>sha256</code> 的摘要，以确保下载一致性。</p><p><em>如果从 Docker Hub 下载镜像非常缓慢，可以参照</em> <a href=https://yeasy.gitbook.io/docker_practice/install/mirror target=_blank rel="external nofollow noopener noreferrer"><em>镜像加速器</em></a> <em>配置加速器。</em></p><h4 id=列出镜像>列出镜像</h4><p>要想列出已经下载下来的镜像，可以使用 <code>docker image ls</code> 命令。</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker image ls
</span></span><span class=line><span class=cl>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class=line><span class=cl>ubuntu              latest              1d622ef86b13        <span class=m>3</span> weeks ago         73.9MB
</span></span><span class=line><span class=cl>mysql               8.0                 0c27e8e5fcfa        <span class=m>3</span> weeks ago         546MB
</span></span><span class=line><span class=cl>mysql               latest              0c27e8e5fcfa        <span class=m>3</span> weeks ago         546MB
</span></span><span class=line><span class=cl>hello-world         latest              bf756fb1ae65        <span class=m>4</span> months ago        13.3kB</span></span></code></pre></td></tr></table></div></div><p>列表包含了 <code>仓库名</code>、<code>标签</code>、<code>镜像 ID</code>、<code>创建时间</code> 以及 <code>所占用的空间</code>。j镜像ID 是镜像的唯一标识，一个镜像可能对应多个标签，比如上面例子中的 <code>mysql:8.0</code> 和 <code>mysql:latest</code>。</p><p>不加任何参数的情况下，<code>docker image ls</code> 会列出所有顶层镜像，但是有时候我们只希望列出部分镜像。<code>docker image ls</code> 有好几个参数可以帮助做到这个事情。</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker image ls ubuntu <span class=c1>#根据仓库名列出镜像</span>
</span></span><span class=line><span class=cl>$ docker image ls ubuntu:18.04 <span class=c1>#列出指定仓库名和标签的镜像</span>
</span></span><span class=line><span class=cl>$ docker image ls -f <span class=nv>since</span><span class=o>=</span>mongo:3.2 <span class=c1>#使用过滤器列出指定条件的镜像</span></span></span></code></pre></td></tr></table></div></div><h4 id=删除本地镜像>删除本地镜像</h4><p>如果要删除本地的镜像，可以使用 <code>docker image rm</code> 命令，其格式为：</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker image rm <span class=o>[</span>选项<span class=o>]</span> &lt;镜像1&gt; <span class=o>[</span>&lt;镜像2&gt; ...<span class=o>]</span></span></span></code></pre></td></tr></table></div></div><p>其中，<code>&lt;镜像></code> 可以是 <code>镜像短 ID</code>、<code>镜像长 ID</code>、<code>镜像名</code> 或者 <code>镜像摘要</code>。</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker image rm mysql:8.0
</span></span><span class=line><span class=cl>Untagged: mysql:8.0
</span></span><span class=line><span class=cl>$ docker image rm ubuntu
</span></span><span class=line><span class=cl>Untagged: ubuntu:latest
</span></span><span class=line><span class=cl>Untagged: ubuntu@sha256:747d2dbbaaee995098c9792d99bd333c6783ce56150d1b11e333bbceed5c54d7
</span></span><span class=line><span class=cl>Deleted: sha256:1d622ef86b138c7e96d4f797bf5e4baca3249f030c575b9337638594f2b63f01
</span></span><span class=line><span class=cl>Deleted: sha256:279e836b58d9996b5715e82a97b024563f2b175e86a53176846684f0717661c3
</span></span><span class=line><span class=cl>Deleted: sha256:39865913f677c50ea236b68d81560d8fefe491661ce6e668fd331b4b680b1d47
</span></span><span class=line><span class=cl>Deleted: sha256:cac81188485e011e56459f1d9fc9936625a1b62cacdb4fcd3526e5f32e280387
</span></span><span class=line><span class=cl>Deleted: sha256:7789f1a3d4e9258fbe5469a8d657deb6aba168d86967063e9b80ac3e1154333f</span></span></code></pre></td></tr></table></div></div><p>可以注意到删除行为分两类，一类是 <code>Untagged</code>，另一类是 <code>Deleted</code>。前面介绍过，镜像的唯一标识是 ID 和摘要，而一个镜像可以有多个标签，因此当我们使用上面命令删除镜像的时候，实际上是在要求删除某个标签的镜像。所以首先需要做的是将满足我们要求的所有镜像标签都取消，这就是我们看到的 <code>Untagged</code> 的信息。因为一个镜像可以对应多个标签，因此当我们删除了所指定的标签后，可能还有别的标签指向了这个镜像，如果是这种情况，那么 <code>Delete</code> 行为就不会发生。所以并非所有的 <code>docker image rm</code> 都会产生删除镜像的行为，有可能仅仅是取消了某个标签而已。</p><p>镜像的删除也是分层进行的，如果某一层正被其他镜像使用，则不会被删除。另外，如果有基于当前镜像的容器正在进行，该镜像也不会被删除。</p><h4 id=虚悬镜像>虚悬镜像</h4><p>有时候镜像列表中会出现没有仓库名，也没有标签的特殊镜像</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&lt;none&gt;               &lt;none&gt;              00285df0df87        <span class=m>5</span> days ago          <span class=m>342</span> MB</span></span></code></pre></td></tr></table></div></div><p>这个镜像原本应当是有镜像名和标签的，但随着官方镜像维护，发布了新版本后，重新执行 <code>docker pull</code> 时，镜像名和标签被转移到了新下载的镜像上，旧的镜像上的名称则被取消，从而成为 <code>&lt;none></code>。除了 <code>docker pull</code> 可能导致这种情况，<code>docker build</code> 也同样可以导致这种现象。由于新旧镜像同名，旧镜像名称被取消，从而出现仓库名、标签均为 `` 的镜像。这类无标签镜像也被称为 <strong>虚悬镜像(dangling image)</strong> 。一般来说，虚悬镜像已经失去了存在的价值，是可以随意删除的，可以用下面的命令删除。</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker image prune</span></span></code></pre></td></tr></table></div></div><h2 id=2-容器>2. 容器</h2><p>镜像与容器的关系，大致可以比对面向对象中的类与实例。具体来说，容器是独立运行的一个或一组应用，以及它们的运行态环境。</p><h3 id=21-启动>2.1 启动</h3><p>启动容器有两种方式，一种是基于镜像新建一个容器并启动，另外一个是将在终止状态（<code>stopped</code>）的容器重新启动。</p><p>因为 Docker 的容器实在太轻量级了，很多时候用户都是随时删除和新创建容器。</p><h4 id=新建并启动>新建并启动</h4><p>所需要的命令主要为 <code>docker run</code>。</p><p>例如，下面的命令输出一个 “Hello World”，之后终止容器。</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run ubuntu /bin/echo <span class=s1>&#39;hello world&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># windows下使用git命令行需要输入 //bin/echo</span>
</span></span><span class=line><span class=cl>hello world</span></span></code></pre></td></tr></table></div></div><p>这跟在本地直接执行 <code>/bin/echo 'hello world'</code> 几乎感觉不出任何区别。</p><p>下面的命令则启动一个 bash 终端，允许用户进行交互。</p><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -t -i ubuntu:18.04 /bin/bash
</span></span><span class=line><span class=cl>root@af8bae53bdd3:/#</span></span></code></pre></td></tr></table></div></div><p>其中，<code>-t</code> 选项让Docker分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上， <code>-i</code> 则让容器的标准输入保持打开。这两个是最常使用的选项</p><p>在交互模式下，用户可以通过所创建的终端来输入命令，例如</p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@af8bae53bdd3:/# <span class=nb>pwd</span>
</span></span><span class=line><span class=cl>/
</span></span><span class=line><span class=cl>root@af8bae53bdd3:/# ls
</span></span><span class=line><span class=cl>bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var</span></span></code></pre></td></tr></table></div></div><p>当利用 <code>docker run</code> 来创建容器时，Docker 在后台运行的标准操作包括：</p><ul><li>检查本地是否存在指定的镜像，不存在就从公有仓库下载</li><li>利用镜像创建并启动一个容器</li><li>分配一个文件系统，并在只读的镜像层外面挂载一层可读写层</li><li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去</li><li>从地址池配置一个 ip 地址给容器</li><li>执行用户指定的应用程序</li><li>执行完毕后容器被终止</li></ul><h4 id=启动已终止容器>启动已终止容器</h4><p>已启动的容器在执行完毕后不会被自动删除，利用 <code>docker container start</code> 命令，可以将一个已经终止的容器重新启动运行。</p><p>容器的核心为所执行的应用程序，所需要的资源都是应用程序运行所必需的。除此之外，并没有其它的资源。可以在伪终端中利用 <code>ps</code> 或 <code>top</code> 来查看进程信息。</p><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@ba267838cc1b:/# ps
</span></span><span class=line><span class=cl>  PID TTY          TIME CMD
</span></span><span class=line><span class=cl>    <span class=m>1</span> ?        00:00:00 bash
</span></span><span class=line><span class=cl>   <span class=m>11</span> ?        00:00:00 ps</span></span></code></pre></td></tr></table></div></div><p>可见，容器中仅运行了指定的 bash 应用。这种特点使得 Docker 对资源的利用率极高，是货真价实的轻量级虚拟化。</p><h3 id=22-守护态运行>2.2 守护态运行</h3><p>更多的时候，需要让 Docker 在后台运行而不是直接把执行命令的结果输出在当前宿主机下。此时，可以通过添加 <code>-d</code> 参数来实现。比如使用 <code>-d</code> 参数执行上面的命令</p><div class=highlight id=id-15><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -d ubuntu /bin/echo <span class=s1>&#39;hello&#39;</span>
</span></span><span class=line><span class=cl>08e90e1961f8b12434931d5f0a64fa5f4615c9613d4b942310c991de17b9bc40</span></span></code></pre></td></tr></table></div></div><p>此时容器会在后台运行并不会把输出的结果 (STDOUT) 打印到宿主机上面，输出结果可以用 <code>docker logs</code> 查看</p><div class=highlight id=id-16><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker container logs 08e
</span></span><span class=line><span class=cl>hello</span></span></code></pre></td></tr></table></div></div><p>注：容器是否会长久运行，是和 <code>docker run</code> 指定的命令有关，和 <code>-d</code> 参数无关，容器只有在执行完命令后才会关闭，一种极端情况是，执行的命令是一个无限循环，这时容器永远不会关闭。</p><h3 id=23-终止>2.3 终止</h3><p>我们已经知道，当 Docker 容器中指定的应用终结时，容器也自动终止。不过，也可以使用 <code>docker container stop</code> 来终止一个运行中的容器。</p><p>对于前面提到的启动了内置终端的容器，用户通过 <code>exit</code> 命令或 <code>Ctrl+d</code> 来退出终端时，所创建的容器立刻终止。</p><div class=highlight id=id-17><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -t -i ubuntu:18.04 /bin/bash
</span></span><span class=line><span class=cl>root@af8bae53bdd3:/#
</span></span><span class=line><span class=cl><span class=c1># 输入 exit 或 使用 Ctrl+d 快捷键退出</span></span></span></code></pre></td></tr></table></div></div><p>使用 <code>docker container ls</code> 仅能看到运行状态的容器，要查看终止状态的容器需要使用 <code>docker container ls -a</code></p><div class=highlight id=id-18><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker container ls -a
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                         PORTS                               NAMES
</span></span><span class=line><span class=cl>08e90e1961f8        ubuntu              <span class=s2>&#34;//bin/echo hello&#34;</span>       <span class=m>9</span> minutes ago       Exited <span class=o>(</span>0<span class=o>)</span> <span class=m>9</span> minutes ago                                           lucid_napier
</span></span><span class=line><span class=cl>20cd094abd6c        ubuntu              <span class=s2>&#34;//bin/bash&#34;</span>             <span class=m>16</span> minutes ago      Exited <span class=o>(</span>0<span class=o>)</span> <span class=m>10</span> minutes ago                                          awesome_fermat
</span></span><span class=line><span class=cl>b57c3358e522        ubuntu              <span class=s2>&#34;//bin/echo &#39;Hello w…&#34;</span>   <span class=m>18</span> minutes ago      Exited <span class=o>(</span>0<span class=o>)</span> <span class=m>18</span> minutes ago                                          gifted_murdock
</span></span><span class=line><span class=cl>e47304d78c1a        ubuntu:latest       <span class=s2>&#34;C:/Program Files/Gi…&#34;</span>   <span class=m>23</span> minutes ago      Created                                                            serene_shamir
</span></span><span class=line><span class=cl>81284613ca04        hello-world         <span class=s2>&#34;/hello&#34;</span>                 About an hour ago   Exited <span class=o>(</span>0<span class=o>)</span> About an hour ago                                       nostalgic_meitner
</span></span><span class=line><span class=cl>cd6182d13e68        mysql               <span class=s2>&#34;docker-entrypoint.s…&#34;</span>   <span class=m>3</span> weeks ago         Exited <span class=o>(</span>255<span class=o>)</span> <span class=m>3</span> weeks ago       0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   chitchat</span></span></code></pre></td></tr></table></div></div><p>处于终止状态的容器，可以通过 <code>docker container start</code> 命令来重新启动。</p><p>此外，<code>docker container restart</code> 命令会将一个运行态的容器终止，然后再重新启动它。</p><h3 id=24-进入容器>2.4 进入容器</h3><p>在使用 <code>-d</code> 参数时，容器启动后会进入后台。某些时候可能需要进入容器内进行操作，可以使用 <code>docker attach</code> 命令或 <code>docker exec</code> 命令，推荐使用 后者。</p><h4 id=attach-命令>attach 命令</h4><div class=highlight id=id-19><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -it -d ubuntu
</span></span><span class=line><span class=cl>e132b98549ad94ba0809a73e86bd63a3fd5f86067735beb83b6b74a14e51772f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker container ls
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></span><span class=line><span class=cl>e132b98549ad        ubuntu              <span class=s2>&#34;/bin/bash&#34;</span>         <span class=m>5</span> seconds ago       Up <span class=m>4</span> seconds                            intelligent_galois
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker attach e13
</span></span><span class=line><span class=cl>root@e132b98549ad:/# </span></span></code></pre></td></tr></table></div></div><p>如果从这个 stdin 中 exit，会导致容器的停止</p><h4 id=exec-命令>exec 命令</h4><p><code>docker exec</code> 后边可以跟多个参数，这里主要说明 <code>-i</code> <code>-t</code> 参数。</p><p>只用 <code>-i</code> 参数时，由于没有分配伪终端，界面没有我们熟悉的 Linux 命令提示符，但命令执行结果仍然可以返回。当 <code>-i</code> <code>-t</code> 参数一起使用时，则可以看到我们熟悉的 Linux 命令提示符。</p><div class=highlight id=id-20><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -it -d ubuntu
</span></span><span class=line><span class=cl>8486e83970e0c8d2594dff9277df369a867dc662feb1ac3b28c84dd305c8f078
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker <span class=nb>exec</span> -i <span class=m>848</span> bash
</span></span><span class=line><span class=cl>ls
</span></span><span class=line><span class=cl>bin
</span></span><span class=line><span class=cl>boot
</span></span><span class=line><span class=cl>dev
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker <span class=nb>exec</span> -it <span class=m>848</span> bash
</span></span><span class=line><span class=cl>root@69d137adef7a:/#</span></span></code></pre></td></tr></table></div></div><p>如果从这个 stdin 中 exit，不会导致容器的停止，这就是为什么推荐使用 <code>docker exec</code></p><h3 id=25-导出与导入>2.5 导出与导入</h3><p>如果要导出本地某个容器，可以使用 <code>docker export</code> 命令。</p><div class=highlight id=id-21><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker container ls -a
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES
</span></span><span class=line><span class=cl>8486e83970e0        ubuntu              <span class=s2>&#34;/bin/bash&#34;</span>         <span class=m>5</span> minutes ago       Up <span class=m>5</span> minutes                                   hardcore_haslett
</span></span><span class=line><span class=cl>e132b98549ad        ubuntu              <span class=s2>&#34;/bin/bash&#34;</span>         <span class=m>7</span> minutes ago       Exited <span class=o>(</span>0<span class=o>)</span> <span class=m>5</span> minutes ago                       intelligent_galois
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker <span class=nb>export</span> <span class=m>848</span> &gt; ubuntu.tar</span></span></code></pre></td></tr></table></div></div><p>这样将导出容器快照到本地文件，导出的目录为执行该命令的当前目录。</p><p>可以使用 <code>docker import</code> 从容器快照文件中再导入为镜像，例如</p><div class=highlight id=id-22><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat ubuntu.tar <span class=p>|</span> docker import - test/ubuntu:v1.0
</span></span><span class=line><span class=cl>sha256:8b3f836f35916cf3aa2199b06e84e917a6421438a58ed4fc1924cd6d07b85d45
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker image ls
</span></span><span class=line><span class=cl>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class=line><span class=cl>test/ubuntu         v1.0                8b3f836f3591        <span class=m>6</span> seconds ago       73.9MB
</span></span><span class=line><span class=cl>ubuntu              latest              1d622ef86b13        <span class=m>3</span> weeks ago         73.9MB
</span></span><span class=line><span class=cl>ubuntu              18.04               c3c304cb4f22        <span class=m>3</span> weeks ago         64.2MB
</span></span><span class=line><span class=cl>mysql               latest              0c27e8e5fcfa        <span class=m>3</span> weeks ago         546MB
</span></span><span class=line><span class=cl>hello-world         latest              bf756fb1ae65        <span class=m>4</span> months ago        13.3kB</span></span></code></pre></td></tr></table></div></div><p>此外，也可以通过指定 URL 或者某个目录来导入，例如</p><div class=highlight id=id-23><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker import http://example.com/exampleimage.tgz example/imagerepo</span></span></code></pre></td></tr></table></div></div><p><em>注：用户既可以使用</em> <em><code>docker load</code></em> <em>来导入镜像存储文件到本地镜像库，也可以使用</em> <em><code>docker import</code></em> <em>来导入一个容器快照到本地镜像库。这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。</em></p><h3 id=26-删除>2.6 删除</h3><p>可以使用 <code>docker container rm</code> 来删除一个处于终止状态的容器。</p><div class=highlight id=id-24><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker container ls -a
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
</span></span><span class=line><span class=cl>8486e83970e0        ubuntu              <span class=s2>&#34;/bin/bash&#34;</span>         <span class=m>11</span> minutes ago      Up <span class=m>11</span> minutes                                   hardcore_haslett
</span></span><span class=line><span class=cl>e132b98549ad        ubuntu              <span class=s2>&#34;/bin/bash&#34;</span>         <span class=m>13</span> minutes ago      Exited <span class=o>(</span>0<span class=o>)</span> <span class=m>11</span> minutes ago                       intelligent_galois
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker container rm e13
</span></span><span class=line><span class=cl>e13
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker container ls -a
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></span><span class=line><span class=cl>8486e83970e0        ubuntu              <span class=s2>&#34;/bin/bash&#34;</span>         <span class=m>11</span> minutes ago      Up <span class=m>11</span> minutes                           hardcore_haslett</span></span></code></pre></td></tr></table></div></div><p>如果要删除一个运行中的容器，可以添加 <code>-f</code> 参数。Docker 会发送 <code>SIGKILL</code> 信号给容器。</p><div class=highlight id=id-25><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker container rm -f <span class=m>848</span>
</span></span><span class=line><span class=cl><span class=m>848</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker container ls -a
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span></span></code></pre></td></tr></table></div></div><p>如果终止状态的容器太多，一个个删除很麻烦，可以使用下面的命令清理所有处于终止状态的容器</p><div class=highlight id=id-26><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker container prune</span></span></code></pre></td></tr></table></div></div><h2 id=3-仓库>3. 仓库</h2><p>仓库（<code>Repository</code>）是集中存放镜像的地方。</p><p>一个容易混淆的概念是注册服务器（<code>Registry</code>）。实际上注册服务器是管理仓库的具体服务器，每个服务器上可以有多个仓库，而每个仓库下面有多个镜像。从这方面来说，仓库可以被认为是一个具体的项目或目录。例如对于仓库地址 <code>docker.io/ubuntu</code> 来说，<code>docker.io</code> 是注册服务器地址，<code>ubuntu</code> 是仓库名。</p><p>目前 Docker 官方维护了一个公共仓库 <a href=https://hub.docker.com/ target=_blank rel="external nofollow noopener noreferrer">Docker Hub</a>，其中已经包括了数量超过 <a href="https://hub.docker.com/search/?type=image" target=_blank rel="external nofollow noopener noreferrer">3,480,000</a> 的镜像。大部分需求都可以通过在 Docker Hub 中直接下载镜像来实现。</p><p>通过 <code>docker search</code> 命令来查找官方仓库中的镜像，通过 <code>docker pull</code> 命令来将它下载到本地。</p><p>也可以构建自己的私有仓库，但这里不做介绍。</p><p>参考：<a href=https://yeasy.gitbook.io/docker_practice/ target=_blank rel="external nofollow noopener noreferrer">前言 - Docker —— 从入门到实践 (gitbook.io)</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2020-05-18 09:00:00">更新于 2020-05-18&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/2020/image-container-and-repository/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Pocket" data-sharer=pocket data-url=https://shuzang.github.io/2020/image-container-and-repository/><i class="fa-brands fa-get-pocket fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://shuzang.github.io/2020/image-container-and-repository/ data-title=Docker-镜像、容器与仓库><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/linux/ class=post-tag>linux</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2020/algorithm-backtracking/ class=post-nav-item rel=prev title=算法-回溯><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>算法-回溯</a>
<a href=/2020/network/ class=post-nav-item rel=next title=Docker-网络>Docker-网络<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-reward><div class=comment></div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>赞赏</label><div class=reward-ways data-mode=static><div><img loading=lazy src=/images/alipay.png srcset="/images/alipay.png, /images/alipay.png 1.5x, /images/alipay.png 2x" sizes=auto data-title="Shuzang 支付宝" data-alt="Shuzang 支付宝" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span>支付宝</span></div><div><img loading=lazy src=/images/wechatpay.png srcset="/images/wechatpay.png, /images/wechatpay.png 1.5x, /images/wechatpay.png 2x" sizes=auto data-title="Shuzang 微信" data-alt="Shuzang 微信" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span>微信</span></div></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">Hava a great day !</div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/>Shuzang</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/shuzang/shuzang.github.io title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{enable:!1},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0}</script><script src=/js/theme.min.js defer></script></body></html>