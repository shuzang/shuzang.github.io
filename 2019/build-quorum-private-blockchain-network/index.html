<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>研究记录6-Quorum区块链实验平台搭建 - Shuzang's Blog</title><meta name=author content="Shuzang"><meta name=author-link content><meta name=description content="上篇文章已经确定了使用 Quorum 区块链，本文记录搭建 Quorum 私有区块链网络的过程。值得一提的是，相比于之前区块链平台搭建的尝试，本篇所述内容已经是一个完整无冗余的方案，后续对区块链平台搭建过程的优化，更多的是根据具体情况进行取舍，以及使用新出的一些更好用的工具。"><meta name=keywords content="科研记录"><meta itemprop=name content="研究记录6-Quorum区块链实验平台搭建"><meta itemprop=description content="上篇文章已经确定了使用 Quorum 区块链，本文记录搭建 Quorum 私有区块链网络的过程。值得一提的是，相比于之前区块链平台搭建的尝试，本篇所述内容已经是一个完整无冗余的方案，后续对区块链平台搭建过程的优化，更多的是根据具体情况进行取舍，以及使用新出的一些更好用的工具。"><meta itemprop=datePublished content="2019-10-02T00:00:00+00:00"><meta itemprop=dateModified content="2020-11-24T00:00:00+00:00"><meta itemprop=wordCount content="6682"><meta itemprop=image content="https://shuzang.github.io/logo.png"><meta itemprop=keywords content="科研记录,"><meta property="og:title" content="研究记录6-Quorum区块链实验平台搭建"><meta property="og:description" content="上篇文章已经确定了使用 Quorum 区块链，本文记录搭建 Quorum 私有区块链网络的过程。值得一提的是，相比于之前区块链平台搭建的尝试，本篇所述内容已经是一个完整无冗余的方案，后续对区块链平台搭建过程的优化，更多的是根据具体情况进行取舍，以及使用新出的一些更好用的工具。"><meta property="og:type" content="article"><meta property="og:url" content="https://shuzang.github.io/2019/build-quorum-private-blockchain-network/"><meta property="og:image" content="https://shuzang.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-02T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-24T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shuzang.github.io/logo.png"><meta name=twitter:title content="研究记录6-Quorum区块链实验平台搭建"><meta name=twitter:description content="上篇文章已经确定了使用 Quorum 区块链，本文记录搭建 Quorum 私有区块链网络的过程。值得一提的是，相比于之前区块链平台搭建的尝试，本篇所述内容已经是一个完整无冗余的方案，后续对区块链平台搭建过程的优化，更多的是根据具体情况进行取舍，以及使用新出的一些更好用的工具。"><meta name=application-name content="Shuzang's Blog"><meta name=apple-mobile-web-app-title content="Shuzang's Blog"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://shuzang.github.io/2019/build-quorum-private-blockchain-network/><link rel=prev href=https://shuzang.github.io/2019/git-learning-deep-into/><link rel=next href=https://shuzang.github.io/2019/when-intrusion-detection-meets-blockchain-technology-a-review/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"研究记录6-Quorum区块链实验平台搭建","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/shuzang.github.io\/2019\/build-quorum-private-blockchain-network\/"},"genre":"posts","keywords":"科研记录","wordcount":6682,"url":"https:\/\/shuzang.github.io\/2019\/build-quorum-private-blockchain-network\/","datePublished":"2019-10-02T00:00:00+00:00","dateModified":"2020-11-24T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Shuzang"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title="Shuzang's Blog" data-alt="Shuzang's Blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Shuzang's Blog"><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title=/images/avatar.png data-alt=/images/avatar.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Shuzang's Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>研究记录6-Quorum区块链实验平台搭建</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img loading=lazy src=/images/avatar.png srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" sizes=auto data-title=Shuzang data-alt=Shuzang class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;Shuzang</span></span>
<span class=post-category>收录于 <a href=/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 研究生的区块链学习之路</a></span></div><div class=post-meta-line><span title="发布于 2019-10-02 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2019-10-02>2019-10-02</time></span>&nbsp;<span title="更新于 2020-11-24 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2020-11-24>2020-11-24</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 6682 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 14 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-设备整理>1. 设备整理</a></li><li><a href=#2-设备选择与方案构思>2. 设备选择与方案构思</a></li><li><a href=#3-网络拓扑>3. 网络拓扑</a><ul><li><a href=#31-设备和操作系统选择>3.1 设备和操作系统选择</a></li><li><a href=#32-静态ip分配>3.2 静态ip分配</a></li></ul></li><li><a href=#4-主机设置>4. 主机设置</a><ul><li><a href=#41-系统初始化>4.1 系统初始化</a></li><li><a href=#42-静态ip设置>4.2 静态ip设置</a></li><li><a href=#43-软件编译安装>4.3 软件编译安装</a></li></ul></li><li><a href=#5-树莓派启动及配置>5. 树莓派启动及配置</a><ul><li><a href=#51-树莓派启动>5.1 树莓派启动</a></li><li><a href=#52-树莓派基本配置>5.2 树莓派基本配置</a><ul><li><a href=#a-更新源及系统>A. 更新源及系统</a></li><li><a href=#b-安装xrdp供远程连接>B. 安装xrdp供远程连接</a></li><li><a href=#c-开启ftp供文件传输>C. 开启ftp供文件传输</a></li><li><a href=#d-修改pi账户密码时区和主机名>D. 修改pi账户密码，时区和主机名</a></li><li><a href=#e-设置静态ip>E. 设置静态ip</a></li><li><a href=#f-获取并安装geth>F. 获取并安装geth</a></li></ul></li></ul></li><li><a href=#6-网络搭建及测试运行>6. 网络搭建及测试运行</a><ul><li><a href=#61-主机>6.1 主机</a></li><li><a href=#62-树莓派>6.2 树莓派</a></li></ul></li></ul></nav></div></div><div class=content id=content><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>本文最后更新于 2020-11-24，文中内容可能已过时。</div></div></div><p>上篇文章已经确定了使用 Quorum 区块链，本文记录搭建 Quorum 私有区块链网络的过程。值得一提的是，相比于之前区块链平台搭建的尝试，本篇所述内容已经是一个完整无冗余的方案，后续对区块链平台搭建过程的优化，更多的是根据具体情况进行取舍，以及使用新出的一些更好用的工具。</p><h2 id=1-设备整理>1. 设备整理</h2><p>首先整理下手头现有的设备，包括开发板、MCU或其它套件、传感器/执行器等的列表如下</p><table><thead><tr><th>名称</th><th>分类</th><th>数量</th><th>状态</th><th>实物图</th></tr></thead><tbody><tr><td>树莓派</td><td>开发板</td><td>2</td><td>已购买</td><td><img src="https://tse1-mm.cn.bing.net/th?id=OIP.FYIO5Tu0yFhQB6Za9NXFzQHaGH&amp;w=226&amp;h=181&amp;c=7&amp;o=5&amp;pid=1.7" alt="Raspberry Pi" style=zoom:50%></td></tr><tr><td>BeagleBone Black</td><td>开发板</td><td>2</td><td>老师手里</td><td><img src="https://tse3-mm.cn.bing.net/th?id=OIP.Gwsoh9XH-CsXzxdBqjdnOQHaE7&amp;w=282&amp;h=187&amp;c=7&amp;o=5&amp;pid=1.7" alt="BeagelBone Black" style=zoom:50%></td></tr><tr><td><a href=https://www.dragino.com/products/lora/item/106-lora-gps-hat.html target=_blank rel="external nofollow noopener noreferrer">LoRa/GPS Hat</a></td><td>扩展板</td><td>1</td><td>已购买</td><td><img src=http://wiki.dragino.com/images/thumb/d/d6/Lora_GPS_HAT.png/300px-Lora_GPS_HAT.png alt="LoRa/GPS HAT" style=zoom:50%></td></tr><tr><td><a href=http://www.ti.com/tool/LAUNCHXL-CC1350 target=_blank rel="external nofollow noopener noreferrer">CC1350 LaunchPad</a></td><td>扩展版</td><td>2</td><td>老师手里</td><td><img src=http://www.ti.com/diagrams/med_launchxl-cc1350_launchxl-cc1350_dsc_2006.jpg style=zoom:50%></td></tr><tr><td><a href=http://wiki.seeedstudio.com/cn/Grove-XBee_Carrier/ target=_blank rel="external nofollow noopener noreferrer">Grove XBee Carrier</a></td><td>扩展板</td><td>2</td><td>实验室抽屉</td><td><img src="https://tse1-mm.cn.bing.net/th?id=OIP.AS_6GlgBhtmyfUeXRz8LOwHaFj&amp;w=282&amp;h=207&amp;c=7&amp;o=5&amp;pid=1.7" alt="Grove XBee Carrier" style=zoom:50%></td></tr><tr><td><a href=http://wiki.seeedstudio.com/cn/RFbee_V1.1-Wireless_Arduino_compatible_node/ target=_blank rel="external nofollow noopener noreferrer">RFBee</a></td><td>配套Xbee的部件</td><td>2</td><td>实验室抽屉</td><td><img src="https://tse2-mm.cn.bing.net/th?id=OIP.K7mJRbwY21_lhdwIzqyEyAHaFj&amp;w=235&amp;h=172&amp;c=7&amp;o=5&amp;pid=1.7" alt=RFBee style=zoom:50%></td></tr><tr><td><a href=http://wiki.seeedstudio.com/cn/UartSBee_v5/ target=_blank rel="external nofollow noopener noreferrer">UartSBee v5</a></td><td>转换器</td><td>2</td><td>实验室抽屉</td><td><img src="https://tse4-mm.cn.bing.net/th?id=OIP.Pge4Qjh_NuOooLhfQKwNwgAAAA&amp;w=236&amp;h=192&amp;c=7&amp;o=5&amp;pid=1.7" alt=UartSBee style=zoom:50%></td></tr><tr><td><a href=http://wiki.seeedstudio.com/cn/Grove-Loudness_Sensor/ target=_blank rel="external nofollow noopener noreferrer">Grove-Loudness Sensor</a></td><td>传感器</td><td>1</td><td>实验室抽屉</td><td><img src="https://tse1-mm.cn.bing.net/th?id=OIP.ESsCkeUMKCENk1_9qbg09AHaGe&amp;w=228&amp;h=197&amp;c=7&amp;o=5&amp;pid=1.7" alt="Grove-Loudness sensor" style=zoom:80%></td></tr><tr><td><a href=http://wiki.seeedstudio.com/Grove-Dust_Sensor/ target=_blank rel="external nofollow noopener noreferrer">Grove-Dust Sensor</a></td><td>传感器</td><td>1</td><td>实验室抽屉（损坏，不可用）</td><td><img src="https://tse3-mm.cn.bing.net/th?id=OIP.RMDWwFhYOkp8HbWYMocrMAHaFj&amp;w=279&amp;h=209&amp;c=7&amp;o=5&amp;pid=1.7" alt="Dust sensor" style=zoom:80%></td></tr><tr><td><a href=http://wiki.seeedstudio.com/cn/Grove-Chainable_RGB_LED/ target=_blank rel="external nofollow noopener noreferrer">Grove-Chainable RGB LED</a></td><td>执行器</td><td>1</td><td>实验室抽屉</td><td><img src=https://files.seeedstudio.com/wiki/Grove-Chainable_RGB_LED/img/Grove-Chainable_RGB_LED_V2.0.jpg style=zoom:25%></td></tr></tbody></table><p>LoRa/GPS HAT，CC1350 LaunchPad都内置一个温度传感器，LoRa/GPS HAT除了支持LoRa通信，还可以收集并上传GPS数据</p><h2 id=2-设备选择与方案构思>2. 设备选择与方案构思</h2><p>主要考虑使用哪些设备，为了反映所设计的系统的基本结构，需要包括网关和终端IoT设备。有下面几种思路。</p><ol><li><p>有线直连，树莓派/BBB + 传感器/执行器</p><p>将传感器/执行器直接接到树莓派或BBB开发板上，在开发板中使用Python相关库从传感器/执行器读取相关数据并进行处理。工作量较小</p></li><li><p>有线直连，树莓派 + Arduino + 传感器/执行器</p><p>Arduino连接传感器/执行器，并通过串口与树莓派通信，在树莓派中使用Python相关库处理Arduino传过来的数据并进行处理。工作量较小，但目前没有Arduino。</p></li><li><p>无线通信，LoRa</p><p>Arduino连接传感器/执行器，同时连接LoRa模块作为LoRa节点，将收集自传感器的数据通过LoRa模块发送到网关。树莓派连接 LoRa/GPS Hat 作为 LoRa网关接受来自LoRa节点的数据，并提交到<a href=https://www.thethingsnetwork.org/ target=_blank rel="external nofollow noopener noreferrer">The Things Network(TTN)</a> 网络，从TTN后台获取实时数据供区块链处理</p><p>目前没有Arduino，且缺少一个LoRa模块与LoRa/GPS HAT协作传输数据。</p><p>这一方式工作量较大。</p></li><li><p>无线通信，Sub 1GHz</p><p>CC1350 LaunchPad作为终端设备从传感器获取数据，通过Sub 1GHz发送给另一台作为收集器的CC1350，收集器与BeagleBone Black串口通信，网关运行在BBB上。</p><p>CC1350 LaunchPad 编程处理传感器工作量比Arduino大，不熟悉；如何从运行在BBB上的本地网关获取暂时数据也不清楚</p><p>这一方式工作量较大</p></li></ol><p>最后选择的方案是：使用两台树莓派，通过WiFi连接到电脑，终端 IoT 设备通过区块链账户表示，不连接实物。</p><h2 id=3-网络拓扑>3. 网络拓扑</h2><p>在正式开始本实验之前，已经尝试过使用两台电脑和两台树莓派搭建 Quorum 网络，主要使用的是虚拟机，但到最后由于网络质量的问题，共识协议无法正常运行，导致合约部署无法完成。估计主要原因是 PC 上的节点装在了虚拟机里，虚拟机又使用桥接模式，导致最后丢包率和延迟都比较高。因此这次对实验做一定的调整，主要有两点：</p><ol><li>撤销 laptop 的节点，只使用台式机，节点仍然安装在虚拟机中，但不使用桥接模式，而是通过外接无线网卡直接连到路由器的无线网络；</li><li>扩展节点数量到 6 个，虚拟机中设置 4 个验证者节点，以端口号区分，两台树莓派分别代表一个普通节点，在之后加入。</li></ol><p>最终使用了两台树莓派和一台计算机搭建完成 6 节点的 Quorum 网络，采用了 IBFT 共识，未启用隐私管理器。网络拓扑如下：</p><p><img loading=lazy src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/YJS_20191002_%e7%bd%91%e7%bb%9c%e6%8b%93%e6%89%91%e8%ae%be%e8%ae%a1.png srcset="https://picped-1301226557.cos.ap-beijing.myqcloud.com/YJS_20191002_%e7%bd%91%e7%bb%9c%e6%8b%93%e6%89%91%e8%ae%be%e8%ae%a1.png, https://picped-1301226557.cos.ap-beijing.myqcloud.com/YJS_20191002_%e7%bd%91%e7%bb%9c%e6%8b%93%e6%89%91%e8%ae%be%e8%ae%a1.png 1.5x, https://picped-1301226557.cos.ap-beijing.myqcloud.com/YJS_20191002_%e7%bd%91%e7%bb%9c%e6%8b%93%e6%89%91%e8%ae%be%e8%ae%a1.png 2x" sizes=auto data-title=网络拓扑设计 data-alt=网络拓扑设计 style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>注意，当前虚拟机和树莓派都是通过无线网卡接入路由器共享的无线网络(网络名为 quorum)。</p><h3 id=31-设备和操作系统选择>3.1 设备和操作系统选择</h3><p>实验平台共使用了一台台式电脑和两台树莓派。设备和操作系统的详细信息如下，台式电脑的内存和硬盘信息是虚拟机分配的容量。</p><table><thead><tr><th>设备</th><th>CPU</th><th>操作系统</th><th>内存</th><th>硬盘</th></tr></thead><tbody><tr><td>清华同方(台式电脑)</td><td>Intel Core i5-4460, 3.2GHz</td><td>Ubuntu 18.04 LTS(虚拟机)</td><td>2GB</td><td>50GB</td></tr><tr><td>Raspberry Pi 3 Model B Plus</td><td>quad-core ARM Cortex A53, 1.4GHz</td><td>Raspbian Buster</td><td>1GB</td><td>32GB(microSD card)</td></tr><tr><td>Raspberry Pi 3 Model B</td><td>quad-core ARM Cortex A53, 1.2GHz</td><td>Raspbian Buster</td><td>1GB</td><td>16GB(microSD card)</td></tr></tbody></table><h3 id=32-静态ip分配>3.2 静态ip分配</h3><p>台式电脑的操作环境是在虚拟机上完成的，涉及到网络相关操作，这里事先对各设备进行静态ip的分配</p><table><thead><tr><th>设备</th><th>主机名</th><th>节点编号</th><th>IP地址</th><th>操作系统</th></tr></thead><tbody><tr><td>清华同方（PC）</td><td>validator</td><td>node0</td><td>192.168.191.2:30300</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>清华同方（PC）</td><td>validator</td><td>node1</td><td>192.168.191.2:30301</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>清华同方（PC）</td><td>validator</td><td>node2</td><td>192.168.191.2:30302</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>清华同方（PC）</td><td>validator</td><td>node3</td><td>192.168.191.2:30303</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>Pi 3B+</td><td>lightnode1</td><td>node4</td><td>192.168.191.3</td><td>Raspbian Buster</td></tr><tr><td>Pi 3B</td><td>lightnode2</td><td>node5</td><td>192.168.191.4</td><td>Raspbian Buster</td></tr></tbody></table><h2 id=4-主机设置>4. 主机设置</h2><p>在 VMware 中安装 Ubuntu 18.04 虚拟机，安装完成后完成如下基础配置。</p><h3 id=41-系统初始化>4.1 系统初始化</h3><p>更新源和系统</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt-get update
</span></span><span class=line><span class=cl>$ sudo apt-get upgrade</span></span></code></pre></td></tr></table></div></div><p>调整系统时间</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看系统时区是否正确</span>
</span></span><span class=line><span class=cl>$ timedatectl
</span></span><span class=line><span class=cl>                      Local time: 五 2019-09-13 11:07:13 +08
</span></span><span class=line><span class=cl>                  Universal time: 五 2019-09-13 03:07:13 UTC
</span></span><span class=line><span class=cl>                        RTC time: 五 2019-09-13 03:07:13
</span></span><span class=line><span class=cl>                       Time zone: Asia/Ulaanbaatar <span class=o>(</span>+08, +0800<span class=o>)</span>
</span></span><span class=line><span class=cl>       System clock synchronized: yes
</span></span><span class=line><span class=cl>systemd-timesyncd.service active: yes
</span></span><span class=line><span class=cl>                 RTC in <span class=nb>local</span> TZ: no
</span></span><span class=line><span class=cl><span class=c1># 若不正确，使用下列命令设置时区，时区根据自己所处位置调整</span>
</span></span><span class=line><span class=cl>$ timedatectl set-timezone Asia/Shanghai</span></span></code></pre></td></tr></table></div></div><p>设置主机名</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo hostnamectl set-hostname validator</span></span></code></pre></td></tr></table></div></div><p>重启终端查看新的主机名</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ hostnamectl
</span></span><span class=line><span class=cl>   Static hostname: validator
</span></span><span class=line><span class=cl>         Icon name: computer-vm
</span></span><span class=line><span class=cl>           Chassis: vm
</span></span><span class=line><span class=cl>        Machine ID: fea6d1013b564af9ad3667732e5417fc
</span></span><span class=line><span class=cl>           Boot ID: 326e1f8c6fd04269803413d6ac7c6167
</span></span><span class=line><span class=cl>    Virtualization: vmware
</span></span><span class=line><span class=cl>  Operating System: Ubuntu 18.04.3 LTS
</span></span><span class=line><span class=cl>            Kernel: Linux 5.0.0-23-generic
</span></span><span class=line><span class=cl>      Architecture: x86-64</span></span></code></pre></td></tr></table></div></div><h3 id=42-静态ip设置>4.2 静态ip设置</h3><p>执行<code>ifconfig</code>命令需要安装<code>net-tools</code>工具</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt-get install net-tools</span></span></code></pre></td></tr></table></div></div><p>Ubuntu18.04 必须使用<a href=https://ubuntu.com/blog/ubuntu-bionic-netplan target=_blank rel="external nofollow noopener noreferrer">netplan</a>管理网络，但因为这里是 Desktop 版，可以可视化设置，所以暂时不需要理解。</p><p>在设置页面选择无线网络，然后点击网络连接的 quorum 网络的小齿轮图标，进入网络设置页面</p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/YJS_20191002_网络设置1.png style=zoom:80%><p>点击<code>IPv4</code>选项卡，选择<code>Manual</code>，输入我们之前预先设计的IP<code>192.168.191.2</code>，子网掩码、网关和DNS都做相应的设置，然后点击应用。</p><img src=https://picped-1301226557.cos.ap-beijing.myqcloud.com/YJS_20191002_网络设置2.png style=zoom:80%><p>查看设置好的网络地址</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ifconfig
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>wlxb8de5e4dad9c: <span class=nv>flags</span><span class=o>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class=m>1500</span>
</span></span><span class=line><span class=cl>        inet 192.168.191.2  netmask 255.255.255.0  broadcast 192.168.191.255
</span></span><span class=line><span class=cl>        inet6 fe80::bfba:dc41:82e0:e788  prefixlen <span class=m>64</span>  scopeid 0x20&lt;link&gt;
</span></span><span class=line><span class=cl>        ether b8:de:5e:4d:ad:9c  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Ethernet<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX packets <span class=m>238</span>  bytes <span class=m>190654</span> <span class=o>(</span>190.6 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX errors <span class=m>0</span>  dropped <span class=m>1</span>  overruns <span class=m>0</span>  frame <span class=m>0</span>
</span></span><span class=line><span class=cl>        TX packets <span class=m>261</span>  bytes <span class=m>36065</span> <span class=o>(</span>36.0 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        TX errors <span class=m>0</span>  dropped <span class=m>0</span> overruns <span class=m>0</span>  carrier <span class=m>0</span>  collisions <span class=m>0</span></span></span></code></pre></td></tr></table></div></div><p>最后取消有线网络的自动连接，确保网络连接处于<code>quorum</code>无线网络上，不过还需要在每次虚拟机启动时手动断开网卡和主机的连接，然后连到虚拟机上。</p><h3 id=43-软件编译安装>4.3 软件编译安装</h3><p>获取与安装go1.13</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ wget https://dl.google.com/go/go1.13.linux-amd64.tar.gz
</span></span><span class=line><span class=cl>$ sudo tar -xzf go1.13.linux-amd64.tar.gz -C /usr/local
</span></span><span class=line><span class=cl>$ rm go1.13.linux-amd64.tar.gz
</span></span><span class=line><span class=cl><span class=c1># 设置环境变量</span>
</span></span><span class=line><span class=cl>$ sudo nano /etc/profile
</span></span><span class=line><span class=cl><span class=c1># 在打开的文件末尾添加下列语句</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:/usr/local/go/bin
</span></span><span class=line><span class=cl><span class=c1># 更新的环境变量在下一次登录之前不会生效，但可以通过下面的命令使其直接生效</span>
</span></span><span class=line><span class=cl>$ <span class=nb>source</span> /etc/profile
</span></span><span class=line><span class=cl><span class=c1># 查看生效后的环境变量设置</span>
</span></span><span class=line><span class=cl>$ go version
</span></span><span class=line><span class=cl>go version go1.13 linux/amd64
</span></span><span class=line><span class=cl><span class=c1># 注：真正生效必须重启系统</span></span></span></code></pre></td></tr></table></div></div><p>安装geth for quorum</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 获取编译后的二进制包</span>
</span></span><span class=line><span class=cl>$ wget https://bintray.com/quorumengineering/quorum/download_file?file_path<span class=o>=</span>v2.2.5/geth_v2.2.5_linux_amd64.tar.gz
</span></span><span class=line><span class=cl><span class=c1># 解压缩并安装</span>
</span></span><span class=line><span class=cl>$ sudo tar -xzf download_file?file_path<span class=o>=</span>v2.2.5%2Fgeth_v2.2.5_linux_amd64.tar.gz -C /usr/local/bin
</span></span><span class=line><span class=cl>$ rm download_file?file_path<span class=o>=</span>v2.2.5%2Fgeth_v2.2.5_linux_amd64.tar.gz
</span></span><span class=line><span class=cl><span class=c1># 测试安装</span>
</span></span><span class=line><span class=cl>$ geth version
</span></span><span class=line><span class=cl>WARN <span class=o>[</span>10-11<span class=p>|</span>09:41:31.463<span class=o>]</span> Sanitizing cache to Go<span class=err>&#39;</span>s GC limits       <span class=nv>provided</span><span class=o>=</span><span class=m>1024</span> <span class=nv>updated</span><span class=o>=</span><span class=m>655</span>
</span></span><span class=line><span class=cl>Geth
</span></span><span class=line><span class=cl>Version: 1.8.18-stable
</span></span><span class=line><span class=cl>Git Commit: c894c2d70eacf30740d03b53ed2fb39e42641295
</span></span><span class=line><span class=cl>Quorum Version: 2.2.5
</span></span><span class=line><span class=cl>Architecture: amd64
</span></span><span class=line><span class=cl>Protocol Versions: <span class=o>[</span><span class=m>63</span> 62<span class=o>]</span>
</span></span><span class=line><span class=cl>Network Id: <span class=m>1337</span>
</span></span><span class=line><span class=cl>Go Version: go1.11.12
</span></span><span class=line><span class=cl>Operating System: linux
</span></span><span class=line><span class=cl><span class=nv>GOPATH</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>GOROOT</span><span class=o>=</span>/home/travis/.gimme/versions/go1.11.12.linux.amd64</span></span></code></pre></td></tr></table></div></div><p>获取并编译istanbul-tools，该工具用来初始化 IBFT 共识网络及进行网络测试</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt-get install git
</span></span><span class=line><span class=cl>$ mkdir istanbul <span class=o>&amp;&amp;</span> <span class=nb>cd</span> istanbul
</span></span><span class=line><span class=cl>$ git clone https://github.com/jpmorganchase/istanbul-tools.git
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> istanbul-tools
</span></span><span class=line><span class=cl><span class=c1># 执行编译</span>
</span></span><span class=line><span class=cl>$ sudo apt-get install -y build-essential
</span></span><span class=line><span class=cl>$ make
</span></span><span class=line><span class=cl><span class=c1># 编译后的文件位于/build/bin目录下，执行测试</span>
</span></span><span class=line><span class=cl>$ ./build/bin/istanbul --version
</span></span><span class=line><span class=cl>istanbul version v1.0.1</span></span></code></pre></td></tr></table></div></div><h2 id=5-树莓派启动及配置>5. 树莓派启动及配置</h2><p>以 Pi 3B+ 为例，Pi 3B 配置操作基本相同</p><h3 id=51-树莓派启动>5.1 树莓派启动</h3><p>将 Raspbian Buster 镜像写入准备好的 SD卡，重新加载在电脑中的 SD 卡会出现 boot 盘，同时也是树莓派的<code>/boot</code>目录。在 boot 盘根目录新建名为<code>ssh</code>的文件，开启 SSH 连接。同时新建<code>wpa_supplicant.conf</code>文件，编辑其内容如下：</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ctrl_interface</span><span class=o>=</span><span class=nv>DIR</span><span class=o>=</span>/var/run/wpa_supplicant <span class=nv>GROUP</span><span class=o>=</span>netdev
</span></span><span class=line><span class=cl><span class=nv>update_config</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>country</span><span class=o>=</span>CN
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=nv>network</span><span class=o>={</span>
</span></span><span class=line><span class=cl>    <span class=nv>ssid</span><span class=o>=</span><span class=s2>&#34;WiFi名&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>psk</span><span class=o>=</span><span class=s2>&#34;密码&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>priority</span><span class=o>=</span><span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><p>将其中的 ssid 和 psk 更改为自己无线网络的网络名和密码。将配置好的 SD 卡卸载并插入树莓派，通电启动。使用 Advanced IP Scanner 扫描无线网络的网段，获取树莓派 ip，本实验无线网络网段为192.168.191.1-254。</p><p>使用扫描到的 ip 通过 Putty 利用 SSH 协议进行登录。</p><h3 id=52-树莓派基本配置>5.2 树莓派基本配置</h3><h4 id=a-更新源及系统>A. 更新源及系统</h4><p>编辑/etc/apt/sources.list文件</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/apt/sources.list</span></span></code></pre></td></tr></table></div></div><p>注释掉原来的源，将源更新为：</p><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi
</span></span><span class=line><span class=cl>deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi</span></span></code></pre></td></tr></table></div></div><p>保存退出，编辑/etc/apt/sources.list.d/raspi.list文件</p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/apt/sources.list.d/raspi.list</span></span></code></pre></td></tr></table></div></div><p>将源更新为：</p><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deb http://mirror.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui
</span></span><span class=line><span class=cl>deb-src http://mirror.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui</span></span></code></pre></td></tr></table></div></div><p>更新源文件列表，更新软件</p><div class=highlight id=id-15><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt-get update
</span></span><span class=line><span class=cl>$ sudo apt-get upgrade</span></span></code></pre></td></tr></table></div></div><h4 id=b-安装xrdp供远程连接>B. 安装xrdp供远程连接</h4><div class=highlight id=id-16><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt-get install xrdp
</span></span><span class=line><span class=cl><span class=c1># 确认安装</span>
</span></span><span class=line><span class=cl>$ dpkg -l <span class=p>|</span> grep xrdp
</span></span><span class=line><span class=cl>ii  xorgxrdp                              1:0.2.9-1                             armhf        Remote Desktop Protocol <span class=o>(</span>RDP<span class=o>)</span> modules <span class=k>for</span> X.org
</span></span><span class=line><span class=cl>ii  xrdp                                  0.9.9-1                               armhf        Remote Desktop Protocol <span class=o>(</span>RDP<span class=o>)</span> server</span></span></code></pre></td></tr></table></div></div><h4 id=c-开启ftp供文件传输>C. 开启ftp供文件传输</h4><p>安装vsftpd</p><div class=highlight id=id-17><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt-get install vsftpd
</span></span><span class=line><span class=cl><span class=c1># 确认安装</span>
</span></span><span class=line><span class=cl>$ dpkg -l <span class=p>|</span> grep vsftpd
</span></span><span class=line><span class=cl>ii  vsftpd                                3.0.3-12                              armhf        lightweight, efficient FTP server written <span class=k>for</span> security</span></span></code></pre></td></tr></table></div></div><p>编辑配置文件</p><div class=highlight id=id-18><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo nano /etc/vsftpd.conf</span></span></code></pre></td></tr></table></div></div><p>启用对树莓派的写入权限</p><div class=highlight id=id-19><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Uncomment this to enable any form of FTP </span>
</span></span><span class=line><span class=cl>write command.write_enable<span class=o>=</span>YES</span></span></code></pre></td></tr></table></div></div><p>保存退出，启用vsftpd</p><div class=highlight id=id-20><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo service vsftpd start</span></span></code></pre></td></tr></table></div></div><h4 id=d-修改pi账户密码时区和主机名>D. 修改pi账户密码，时区和主机名</h4><div class=highlight id=id-21><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo raspi-config</span></span></code></pre></td></tr></table></div></div><p>选择第一项<code>Change User Password</code>，键入新密码并确定，</p><p>选择第四项<code>Localisation Options</code>，选择<code>Change Timezone</code>，将时区更改为<code>Asia/Shanghai</code></p><p>全部设置完成后选择<code>Finish</code>退出，终端将看到如下输出</p><div class=highlight id=id-22><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Current default <span class=nb>time</span> zone: <span class=s1>&#39;Asia/Shanghai&#39;</span>
</span></span><span class=line><span class=cl>Local <span class=nb>time</span> is now:      Fri Sep <span class=m>13</span> 18:40:56 CST 2019.
</span></span><span class=line><span class=cl>Universal Time is now:  Fri Sep <span class=m>13</span> 10:40:56 UTC 2019.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>New password:
</span></span><span class=line><span class=cl>Retype new password:
</span></span><span class=line><span class=cl>passwd: password updated successfully
</span></span><span class=line><span class=cl>OK</span></span></code></pre></td></tr></table></div></div><p>设置主机名</p><div class=highlight id=id-23><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo hostnamectl set-hostname node5</span></span></code></pre></td></tr></table></div></div><p>编辑/etc/hosts文件，将127.0.1.1对应的raspberry更改为node5</p><div class=highlight id=id-24><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>127.0.0.1       localhost
</span></span><span class=line><span class=cl>::1             localhost ip6-localhost ip6-loopback
</span></span><span class=line><span class=cl>ff02::1         ip6-allnodes
</span></span><span class=line><span class=cl>ff02::2         ip6-allrouters
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>127.0.1.1       node5</span></span></code></pre></td></tr></table></div></div><p>退出终端并使用新密码重新登录，主机名将更改为node5。注意此时用户名仍为pi。</p><h4 id=e-设置静态ip>E. 设置静态ip</h4><p>编辑<code>/etc/dhcpcd.conf</code>文件</p><div class=highlight id=id-25><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo nano /etc/dhcpcd.conf</span></span></code></pre></td></tr></table></div></div><p>在末尾添加如下内容</p><div class=highlight id=id-26><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>interface wlan0
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>static <span class=nv>ip_address</span><span class=o>=</span>192.168.191.3/24
</span></span><span class=line><span class=cl>static <span class=nv>routers</span><span class=o>=</span>192.168.191.1
</span></span><span class=line><span class=cl>static <span class=nv>domain_name_servers</span><span class=o>=</span>192.168.191.1</span></span></code></pre></td></tr></table></div></div><p>重启并以新的ip登录树莓派。</p><h4 id=f-获取并安装geth>F. 获取并安装geth</h4><p>已经交叉编译过了，这里下载的是最后生成的文件，放到了Github上。交叉编译的过程可以参考本系列文章的两篇补充说明。</p><div class=highlight id=id-27><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git clone -b gethonly https://github.com/shuzang/quorum-raspbian.git
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> quorum-raspbian
</span></span><span class=line><span class=cl>$ sudo cp geth /usr/local/bin
</span></span><span class=line><span class=cl>$ sudo chmod +x /usr/local/bin/geth</span></span></code></pre></td></tr></table></div></div><p>测试安装是否成功</p><div class=highlight id=id-28><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ geth version
</span></span><span class=line><span class=cl>WARN <span class=o>[</span>09-13<span class=p>|</span>19:51:40.051<span class=o>]</span> Sanitizing cache to Go<span class=err>&#39;</span>s GC limits       <span class=nv>provided</span><span class=o>=</span><span class=m>1024</span> <span class=nv>updated</span><span class=o>=</span><span class=m>308</span>
</span></span><span class=line><span class=cl>Geth
</span></span><span class=line><span class=cl>Version: 1.8.18-stable
</span></span><span class=line><span class=cl>Quorum Version: 2.2.5
</span></span><span class=line><span class=cl>Architecture: arm
</span></span><span class=line><span class=cl>Protocol Versions: <span class=o>[</span><span class=m>63</span> 62<span class=o>]</span>
</span></span><span class=line><span class=cl>Network Id: <span class=m>1337</span>
</span></span><span class=line><span class=cl>Go Version: go1.11.6
</span></span><span class=line><span class=cl>Operating System: linux
</span></span><span class=line><span class=cl><span class=nv>GOPATH</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>GOROOT</span><span class=o>=</span>/usr/lib/go-1.11</span></span></code></pre></td></tr></table></div></div><h2 id=6-网络搭建及测试运行>6. 网络搭建及测试运行</h2><h3 id=61-主机>6.1 主机</h3><p>各节点数据和相关文件的前期生成都在台式电脑中由 istanbul-tools 工具完成。切换到台式电脑，在 istanbul 目录下创建各节点的工作目录</p><div class=highlight id=id-29><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> ~/istanbul
</span></span><span class=line><span class=cl>$ mkdir node0 node1 node2 node3</span></span></code></pre></td></tr></table></div></div><p>进入领导节点（这里是node0）目录，使用 istanbul-tools 工具为各节点生成文件，该命令会为所有的初始验证者节点生成 <code>static-nodes.json</code>, <code>genesis.json</code>和 nodekeys 三种文件。</p><div class=highlight id=id-30><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> node0
</span></span><span class=line><span class=cl>$ ../istanbul-tools/build/bin/istanbul setup --num <span class=m>4</span> --nodes --quorum --save --verbose</span></span></code></pre></td></tr></table></div></div><p>将输出生成的文件信息</p><div class=highlight id=id-31><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>validators</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Address&#34;</span><span class=p>:</span> <span class=s2>&#34;0x7fec892a867a2da2e4f1ae1646c29e40d0d7a5c6&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Nodekey&#34;</span><span class=p>:</span> <span class=s2>&#34;d698db367eeb7a43c6eb6c79213482ba6ca6f2781c03e8bc8b6d4d2b9bbfd7e5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;NodeInfo&#34;</span><span class=p>:</span> <span class=s2>&#34;enode://7117f995cdb2d79eb90bc4a575c5f82bbe4aa6ac87f966b18e2e19bd29e728ba9ca85062a6af5c188bb159641392e2ac3559712d9a31e965220659412a4a8c3e@0.0.0.0:30303?discport=0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Address&#34;</span><span class=p>:</span> <span class=s2>&#34;0x65cc0df8e88fa0fbda0337b3e0b10be9c27325c3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Nodekey&#34;</span><span class=p>:</span> <span class=s2>&#34;0010d6506fe219d1e0c35f481ee4bd1fc26cadb84c0510128f186e32d7be3f0f&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;NodeInfo&#34;</span><span class=p>:</span> <span class=s2>&#34;enode://cb790b57310d70bfb13e417e9dc22f3b0afc0065f4c5babc2f95e3ff75e99d343547585a0b2ad6be6f0497f401e93c16dadec5a68d820cb918fa0255696940f2@0.0.0.0:30303?discport=0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Address&#34;</span><span class=p>:</span> <span class=s2>&#34;0x786083c93b12404fd4100ec497810b5cfa0a7191&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Nodekey&#34;</span><span class=p>:</span> <span class=s2>&#34;51fbf8274352fe6d39dbe99be75b13a2a882af210e84ea16935a5b52aa68c662&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;NodeInfo&#34;</span><span class=p>:</span> <span class=s2>&#34;enode://0e6118122721993e84da84416cb9752a4b5c1b0077a915eb89d0cdff00862c3f13d9edc676c583997f6d9051245ba0f5587750d09d04482774a11f6d13a1c43b@0.0.0.0:30303?discport=0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Address&#34;</span><span class=p>:</span> <span class=s2>&#34;0x28cd575468829f98dabe99f22fd6f3f09b658700&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Nodekey&#34;</span><span class=p>:</span> <span class=s2>&#34;e2ebbcdb7a82c3cac3f0d25a14b57f21dd4a2616f6797a73ab51e8c10b522055&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;NodeInfo&#34;</span><span class=p>:</span> <span class=s2>&#34;enode://8d510973b1b245cb8cec8369948080b7e5adca90730112739307096ab445182415e92967de7096c013644f4b92025c7e29db23a145040cb3b9d46831fab0e8e2@0.0.0.0:30303?discport=0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>static-nodes.json</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://7117f995cdb2d79eb90bc4a575c5f82bbe4aa6ac87f966b18e2e19bd29e728ba9ca85062a6af5c188bb159641392e2ac3559712d9a31e965220659412a4a8c3e@0.0.0.0:30303?discport=0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://cb790b57310d70bfb13e417e9dc22f3b0afc0065f4c5babc2f95e3ff75e99d343547585a0b2ad6be6f0497f401e93c16dadec5a68d820cb918fa0255696940f2@0.0.0.0:30303?discport=0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://0e6118122721993e84da84416cb9752a4b5c1b0077a915eb89d0cdff00862c3f13d9edc676c583997f6d9051245ba0f5587750d09d04482774a11f6d13a1c43b@0.0.0.0:30303?discport=0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://8d510973b1b245cb8cec8369948080b7e5adca90730112739307096ab445182415e92967de7096c013644f4b92025c7e29db23a145040cb3b9d46831fab0e8e2@0.0.0.0:30303?discport=0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>genesis.json</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;config&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;chainId&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;homesteadBlock&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;eip150Block&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;eip150Hash&#34;</span><span class=p>:</span> <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;eip155Block&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;eip158Block&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;byzantiumBlock&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;constantinopleBlock&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;istanbul&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;epoch&#34;</span><span class=p>:</span> <span class=mi>30000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;policy&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;txnSizeLimit&#34;</span><span class=p>:</span> <span class=mi>64</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;isQuorum&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;nonce&#34;</span><span class=p>:</span> <span class=s2>&#34;0x0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;0x5e00998d&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;extraData&#34;</span><span class=p>:</span> <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000f89af854947fec892a867a2da2e4f1ae1646c29e40d0d7a5c69465cc0df8e88fa0fbda0337b3e0b10be9c27325c394786083c93b12404fd4100ec497810b5cfa0a71919428cd575468829f98dabe99f22fd6f3f09b658700b8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gasLimit&#34;</span><span class=p>:</span> <span class=s2>&#34;0xe0000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;difficulty&#34;</span><span class=p>:</span> <span class=s2>&#34;0x1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;mixHash&#34;</span><span class=p>:</span> <span class=s2>&#34;0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;coinbase&#34;</span><span class=p>:</span> <span class=s2>&#34;0x0000000000000000000000000000000000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;alloc&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;28cd575468829f98dabe99f22fd6f3f09b658700&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;balance&#34;</span><span class=p>:</span> <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;65cc0df8e88fa0fbda0337b3e0b10be9c27325c3&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;balance&#34;</span><span class=p>:</span> <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;786083c93b12404fd4100ec497810b5cfa0a7191&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;balance&#34;</span><span class=p>:</span> <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;7fec892a867a2da2e4f1ae1646c29e40d0d7a5c6&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;balance&#34;</span><span class=p>:</span> <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;number&#34;</span><span class=p>:</span> <span class=s2>&#34;0x0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gasUsed&#34;</span><span class=p>:</span> <span class=s2>&#34;0x0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;parentHash&#34;</span><span class=p>:</span> <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>查看生成的文件</p><div class=highlight id=id-32><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls -l
</span></span><span class=line><span class=cl>total <span class=m>24</span>
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> shuzang shuzang <span class=m>4096</span> Dec <span class=m>23</span> 18:40 <span class=m>0</span>
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> shuzang shuzang <span class=m>4096</span> Dec <span class=m>23</span> 18:40 <span class=m>1</span>
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> shuzang shuzang <span class=m>4096</span> Dec <span class=m>23</span> 18:40 <span class=m>2</span>
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> shuzang shuzang <span class=m>4096</span> Dec <span class=m>23</span> 18:40 <span class=m>3</span>
</span></span><span class=line><span class=cl>-rwxr-xr-x <span class=m>1</span> shuzang shuzang <span class=m>1792</span> Dec <span class=m>23</span> 18:40 genesis.json
</span></span><span class=line><span class=cl>-rwxr-xr-x <span class=m>1</span> shuzang shuzang  <span class=m>666</span> Dec <span class=m>23</span> 18:40 static-nodes.json</span></span></code></pre></td></tr></table></div></div><p>使用预定的IP和端口号为所有验证者节点更新 <code>static-nodes.json</code> 文件。 在 <code>static-nodes.json</code>中，每个节点占据一行，按节点标号顺序排列</p><div class=highlight id=id-33><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat static-nodes.json
</span></span><span class=line><span class=cl>....更新ip和端口号如下
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://7117f995cdb2d79eb90bc4a575c5f82bbe4aa6ac87f966b18e2e19bd29e728ba9ca85062a6af5c188bb159641392e2ac3559712d9a31e965220659412a4a8c3e@192.168.191.2:30300?discport=0&#34;</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://cb790b57310d70bfb13e417e9dc22f3b0afc0065f4c5babc2f95e3ff75e99d343547585a0b2ad6be6f0497f401e93c16dadec5a68d820cb918fa0255696940f2@192.168.191.2:30301?discport=0&#34;</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://0e6118122721993e84da84416cb9752a4b5c1b0077a915eb89d0cdff00862c3f13d9edc676c583997f6d9051245ba0f5587750d09d04482774a11f6d13a1c43b@192.168.191.2:30302?discport=0&#34;</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://8d510973b1b245cb8cec8369948080b7e5adca90730112739307096ab445182415e92967de7096c013644f4b92025c7e29db23a145040cb3b9d46831fab0e8e2@192.168.191.2:30303?discport=0&#34;</span>
</span></span><span class=line><span class=cl><span class=o>]</span></span></span></code></pre></td></tr></table></div></div><p>在每个节点的工作目录创建名为<code>data</code>的数据目录，在<code>data</code>目录创建<code>geth</code>目录</p><div class=highlight id=id-34><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>$ mkdir -p node0/data/geth
</span></span><span class=line><span class=cl>$ mkdir -p node1/data/geth
</span></span><span class=line><span class=cl>$ mkdir -p node2/data/geth
</span></span><span class=line><span class=cl>$ mkdir -p node3/data/geth</span></span></code></pre></td></tr></table></div></div><p>挑选部分节点，在各自节点的工作目录为其生成初始账户，账户地址会显示在终端，记住为每个节点账户所设的密码</p><div class=highlight id=id-35><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ geth --datadir node0/data account new
</span></span><span class=line><span class=cl>WARN <span class=o>[</span>12-23<span class=p>|</span>18:45:02.029<span class=o>]</span> Sanitizing cache to Go<span class=s1>&#39;s GC limits       provided=1024 updated=655
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:45:02.031] Maximum peer count                       ETH=25 LES=0 total=25
</span></span></span><span class=line><span class=cl><span class=s1>Your new account is locked with a password. Please give a password. Do not forget this password.
</span></span></span><span class=line><span class=cl><span class=s1>Passphrase: 
</span></span></span><span class=line><span class=cl><span class=s1>Repeat passphrase: 
</span></span></span><span class=line><span class=cl><span class=s1>Address: {bffe4ff0cbd0a7590fb71966d1e6bb1a4c2359e0}
</span></span></span><span class=line><span class=cl><span class=s1>$ geth --datadir node1/data account new
</span></span></span><span class=line><span class=cl><span class=s1>WARN [12-23|18:45:13.335] Sanitizing cache to Go&#39;</span>s GC limits       <span class=nv>provided</span><span class=o>=</span><span class=m>1024</span> <span class=nv>updated</span><span class=o>=</span><span class=m>655</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:45:13.337<span class=o>]</span> Maximum peer count                       <span class=nv>ETH</span><span class=o>=</span><span class=m>25</span> <span class=nv>LES</span><span class=o>=</span><span class=m>0</span> <span class=nv>total</span><span class=o>=</span><span class=m>25</span>
</span></span><span class=line><span class=cl>Your new account is locked with a password. Please give a password. Do not forget this password.
</span></span><span class=line><span class=cl>Passphrase: 
</span></span><span class=line><span class=cl>Repeat passphrase: 
</span></span><span class=line><span class=cl>Address: <span class=o>{</span>dfb9cd6f474188fecbaafb9335d2905f08794612<span class=o>}</span>
</span></span><span class=line><span class=cl>$ geth --datadir node2/data account new
</span></span><span class=line><span class=cl>WARN <span class=o>[</span>12-23<span class=p>|</span>18:45:26.461<span class=o>]</span> Sanitizing cache to Go<span class=s1>&#39;s GC limits       provided=1024 updated=655
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:45:26.462] Maximum peer count                       ETH=25 LES=0 total=25
</span></span></span><span class=line><span class=cl><span class=s1>Your new account is locked with a password. Please give a password. Do not forget this password.
</span></span></span><span class=line><span class=cl><span class=s1>Passphrase: 
</span></span></span><span class=line><span class=cl><span class=s1>Repeat passphrase: 
</span></span></span><span class=line><span class=cl><span class=s1>Address: {b7ce2bd1cb7232b92220f91aa44bfd48d0d4e806}
</span></span></span><span class=line><span class=cl><span class=s1>$ geth --datadir node3/data account new
</span></span></span><span class=line><span class=cl><span class=s1>WARN [12-23|18:45:35.615] Sanitizing cache to Go&#39;</span>s GC limits       <span class=nv>provided</span><span class=o>=</span><span class=m>1024</span> <span class=nv>updated</span><span class=o>=</span><span class=m>655</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:45:35.616<span class=o>]</span> Maximum peer count                       <span class=nv>ETH</span><span class=o>=</span><span class=m>25</span> <span class=nv>LES</span><span class=o>=</span><span class=m>0</span> <span class=nv>total</span><span class=o>=</span><span class=m>25</span>
</span></span><span class=line><span class=cl>Your new account is locked with a password. Please give a password. Do not forget this password.
</span></span><span class=line><span class=cl>Passphrase: 
</span></span><span class=line><span class=cl>Repeat passphrase: 
</span></span><span class=line><span class=cl>Address: <span class=o>{</span>174ec46a6cda172678dfebe0ed8b0c7da685c9a4<span class=o>}</span></span></span></code></pre></td></tr></table></div></div><p>为了添加账户到初始区块，使用上述产生的账户地址更新<code>genesis.json</code>文件的<code>alloc</code>字段内容。</p><div class=highlight id=id-36><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat node0/genesis.json
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;config&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;chainId&#34;</span>: 10,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;homesteadBlock&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;eip150Block&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;eip150Hash&#34;</span>: <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;eip155Block&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;eip158Block&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;byzantiumBlock&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;constantinopleBlock&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;istanbul&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;epoch&#34;</span>: 30000,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;policy&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;txnSizeLimit&#34;</span>: 64,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;isQuorum&#34;</span>: <span class=nb>true</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;nonce&#34;</span>: <span class=s2>&#34;0x0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timestamp&#34;</span>: <span class=s2>&#34;0x5e00998d&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;extraData&#34;</span>: <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000f89af854947fec892a867a2da2e4f1ae1646c29e40d0d7a5c69465cc0df8e88fa0fbda0337b3e0b10be9c27325c394786083c93b12404fd4100ec497810b5cfa0a71919428cd575468829f98dabe99f22fd6f3f09b658700b8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;gasLimit&#34;</span>: <span class=s2>&#34;0xe0000000&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;difficulty&#34;</span>: <span class=s2>&#34;0x1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;mixHash&#34;</span>: <span class=s2>&#34;0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;coinbase&#34;</span>: <span class=s2>&#34;0x0000000000000000000000000000000000000000&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;alloc&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;bffe4ff0cbd0a7590fb71966d1e6bb1a4c2359e0&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;balance&#34;</span>: <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;dfb9cd6f474188fecbaafb9335d2905f08794612&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;balance&#34;</span>: <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;b7ce2bd1cb7232b92220f91aa44bfd48d0d4e806&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;balance&#34;</span>: <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;174ec46a6cda172678dfebe0ed8b0c7da685c9a4&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;balance&#34;</span>: <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;number&#34;</span>: <span class=s2>&#34;0x0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;gasUsed&#34;</span>: <span class=s2>&#34;0x0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;parentHash&#34;</span>: <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><p>将之前步骤中产生的初始化文件移动到相应节点的工作目录。这些文件现在位于领导节点的工作目录。<code>genesis.json</code>放到每个节点的工作目录, <code>static-nodes.json</code>放到每个节点的<code>data</code>目录。<code>X/nodekey</code>放到对应节点的<code>data/geth</code></p><div class=highlight id=id-37><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cp node0/genesis.json node1
</span></span><span class=line><span class=cl>$ cp node0/genesis.json node2
</span></span><span class=line><span class=cl>$ cp node0/genesis.json node3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ cp node0/static-nodes.json node0/data/
</span></span><span class=line><span class=cl>$ cp node0/static-nodes.json node1/data/
</span></span><span class=line><span class=cl>$ cp node0/static-nodes.json node2/data/
</span></span><span class=line><span class=cl>$ cp node0/static-nodes.json node3/data/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ cp node0/0/nodekey node0/data/geth
</span></span><span class=line><span class=cl>$ cp node0/1/nodekey node1/data/geth
</span></span><span class=line><span class=cl>$ cp node0/2/nodekey node2/data/geth
</span></span><span class=line><span class=cl>$ cp node0/3/nodekey node3/data/geth</span></span></code></pre></td></tr></table></div></div><p>分别在各自节点工作目录执行节点初始化工作</p><div class=highlight id=id-38><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> node0
</span></span><span class=line><span class=cl>$ geth --datadir data init genesis.json
</span></span><span class=line><span class=cl>WARN <span class=o>[</span>12-23<span class=p>|</span>18:52:30.425<span class=o>]</span> Sanitizing cache to Go<span class=s1>&#39;s GC limits       provided=1024 updated=655
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.438] Maximum peer count                       ETH=25 LES=0 total=25
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.439] Allocated cache and file handles         database=/home/shuzang/istanbul/node0/data/geth/chaindata cache=16 handles=16
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.453] Writing custom genesis block 
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.455] Persisted trie from memory database      nodes=5 size=819.00B time=76.952µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.456] Successfully wrote genesis state         database=chaindata                                        hash=afaace…b46039
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.456] Allocated cache and file handles         database=/home/shuzang/istanbul/node0/data/geth/lightchaindata cache=16 handles=16
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.460] Writing custom genesis block 
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.460] Persisted trie from memory database      nodes=5 size=819.00B time=47.175µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:52:30.460] Successfully wrote genesis state         database=lightchaindata                                        hash=afaace…b46039
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>$ cd ../node1
</span></span></span><span class=line><span class=cl><span class=s1>$ geth --datadir data init genesis.json
</span></span></span><span class=line><span class=cl><span class=s1>WARN [12-23|18:53:24.245] Sanitizing cache to Go&#39;</span>s GC limits       <span class=nv>provided</span><span class=o>=</span><span class=m>1024</span> <span class=nv>updated</span><span class=o>=</span><span class=m>655</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.246<span class=o>]</span> Maximum peer count                       <span class=nv>ETH</span><span class=o>=</span><span class=m>25</span> <span class=nv>LES</span><span class=o>=</span><span class=m>0</span> <span class=nv>total</span><span class=o>=</span><span class=m>25</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.247<span class=o>]</span> Allocated cache and file handles         <span class=nv>database</span><span class=o>=</span>/home/shuzang/istanbul/node1/data/geth/chaindata <span class=nv>cache</span><span class=o>=</span><span class=m>16</span> <span class=nv>handles</span><span class=o>=</span><span class=m>16</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.251<span class=o>]</span> Writing custom genesis block 
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.252<span class=o>]</span> Persisted trie from memory database      <span class=nv>nodes</span><span class=o>=</span><span class=m>5</span> <span class=nv>size</span><span class=o>=</span>819.00B <span class=nv>time</span><span class=o>=</span>51.433µs <span class=nv>gcnodes</span><span class=o>=</span><span class=m>0</span> <span class=nv>gcsize</span><span class=o>=</span>0.00B <span class=nv>gctime</span><span class=o>=</span>0s <span class=nv>livenodes</span><span class=o>=</span><span class=m>1</span> <span class=nv>livesize</span><span class=o>=</span>0.00B
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.252<span class=o>]</span> Successfully wrote genesis state         <span class=nv>database</span><span class=o>=</span>chaindata                                        <span class=nv>hash</span><span class=o>=</span>afaace…b46039
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.252<span class=o>]</span> Allocated cache and file handles         <span class=nv>database</span><span class=o>=</span>/home/shuzang/istanbul/node1/data/geth/lightchaindata <span class=nv>cache</span><span class=o>=</span><span class=m>16</span> <span class=nv>handles</span><span class=o>=</span><span class=m>16</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.255<span class=o>]</span> Writing custom genesis block 
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.255<span class=o>]</span> Persisted trie from memory database      <span class=nv>nodes</span><span class=o>=</span><span class=m>5</span> <span class=nv>size</span><span class=o>=</span>819.00B <span class=nv>time</span><span class=o>=</span>48.23µs  <span class=nv>gcnodes</span><span class=o>=</span><span class=m>0</span> <span class=nv>gcsize</span><span class=o>=</span>0.00B <span class=nv>gctime</span><span class=o>=</span>0s <span class=nv>livenodes</span><span class=o>=</span><span class=m>1</span> <span class=nv>livesize</span><span class=o>=</span>0.00B
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:53:24.255<span class=o>]</span> Successfully wrote genesis state         <span class=nv>database</span><span class=o>=</span>lightchaindata                                        <span class=nv>hash</span><span class=o>=</span>afaace…b46039
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> ../node2
</span></span><span class=line><span class=cl>$ geth --datadir data init genesis.json
</span></span><span class=line><span class=cl>WARN <span class=o>[</span>12-23<span class=p>|</span>18:53:52.025<span class=o>]</span> Sanitizing cache to Go<span class=s1>&#39;s GC limits       provided=1024 updated=655
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.026] Maximum peer count                       ETH=25 LES=0 total=25
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.027] Allocated cache and file handles         database=/home/shuzang/istanbul/node2/data/geth/chaindata cache=16 handles=16
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.032] Writing custom genesis block 
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.032] Persisted trie from memory database      nodes=5 size=819.00B time=76.54µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.032] Successfully wrote genesis state         database=chaindata                                        hash=afaace…b46039
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.032] Allocated cache and file handles         database=/home/shuzang/istanbul/node2/data/geth/lightchaindata cache=16 handles=16
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.035] Writing custom genesis block 
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.035] Persisted trie from memory database      nodes=5 size=819.00B time=44.94µs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
</span></span></span><span class=line><span class=cl><span class=s1>INFO [12-23|18:53:52.035] Successfully wrote genesis state         database=lightchaindata                                        hash=afaace…b46039
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>$ cd ../node3
</span></span></span><span class=line><span class=cl><span class=s1>$ geth --datadir data init genesis.json
</span></span></span><span class=line><span class=cl><span class=s1>WARN [12-23|18:54:13.106] Sanitizing cache to Go&#39;</span>s GC limits       <span class=nv>provided</span><span class=o>=</span><span class=m>1024</span> <span class=nv>updated</span><span class=o>=</span><span class=m>655</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.107<span class=o>]</span> Maximum peer count                       <span class=nv>ETH</span><span class=o>=</span><span class=m>25</span> <span class=nv>LES</span><span class=o>=</span><span class=m>0</span> <span class=nv>total</span><span class=o>=</span><span class=m>25</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.108<span class=o>]</span> Allocated cache and file handles         <span class=nv>database</span><span class=o>=</span>/home/shuzang/istanbul/node3/data/geth/chaindata <span class=nv>cache</span><span class=o>=</span><span class=m>16</span> <span class=nv>handles</span><span class=o>=</span><span class=m>16</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.115<span class=o>]</span> Writing custom genesis block 
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.122<span class=o>]</span> Persisted trie from memory database      <span class=nv>nodes</span><span class=o>=</span><span class=m>5</span> <span class=nv>size</span><span class=o>=</span>819.00B <span class=nv>time</span><span class=o>=</span>65.787µs <span class=nv>gcnodes</span><span class=o>=</span><span class=m>0</span> <span class=nv>gcsize</span><span class=o>=</span>0.00B <span class=nv>gctime</span><span class=o>=</span>0s <span class=nv>livenodes</span><span class=o>=</span><span class=m>1</span> <span class=nv>livesize</span><span class=o>=</span>0.00B
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.123<span class=o>]</span> Successfully wrote genesis state         <span class=nv>database</span><span class=o>=</span>chaindata                                        <span class=nv>hash</span><span class=o>=</span>afaace…b46039
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.123<span class=o>]</span> Allocated cache and file handles         <span class=nv>database</span><span class=o>=</span>/home/shuzang/istanbul/node3/data/geth/lightchaindata <span class=nv>cache</span><span class=o>=</span><span class=m>16</span> <span class=nv>handles</span><span class=o>=</span><span class=m>16</span>
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.126<span class=o>]</span> Writing custom genesis block 
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.127<span class=o>]</span> Persisted trie from memory database      <span class=nv>nodes</span><span class=o>=</span><span class=m>5</span> <span class=nv>size</span><span class=o>=</span>819.00B <span class=nv>time</span><span class=o>=</span>45.203µs <span class=nv>gcnodes</span><span class=o>=</span><span class=m>0</span> <span class=nv>gcsize</span><span class=o>=</span>0.00B <span class=nv>gctime</span><span class=o>=</span>0s <span class=nv>livenodes</span><span class=o>=</span><span class=m>1</span> <span class=nv>livesize</span><span class=o>=</span>0.00B
</span></span><span class=line><span class=cl>INFO <span class=o>[</span>12-23<span class=p>|</span>18:54:13.127<span class=o>]</span> Successfully wrote genesis state         <span class=nv>database</span><span class=o>=</span>lightchaindata                                        <span class=nv>hash</span><span class=o>=</span>afaace…b46039</span></span></code></pre></td></tr></table></div></div><p>通过创建并运行脚本一次启动所有节点</p><div class=highlight id=id-39><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 当前位于node4目录下，先跳出</span>
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>$ nano startall.sh
</span></span><span class=line><span class=cl>.... 粘贴以下内容，使端口号符合static-nodes.json中设置的端口号
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> node0
</span></span><span class=line><span class=cl><span class=nv>PRIVATE_CONFIG</span><span class=o>=</span>ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod <span class=m>5</span> --syncmode full --mine --minerthreads <span class=m>1</span> --verbosity <span class=m>5</span> --networkid <span class=m>10</span> --rpc --rpcaddr 0.0.0.0 --rpcport <span class=m>22000</span> --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins<span class=o>=</span><span class=s2>&#34;*&#34;</span> --wsaddr 0.0.0.0 --wsport <span class=m>8545</span> --emitcheckpoints --port <span class=m>30300</span> 2&gt;&gt;node.log <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ../node1
</span></span><span class=line><span class=cl><span class=nv>PRIVATE_CONFIG</span><span class=o>=</span>ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod <span class=m>5</span> --syncmode full --mine --minerthreads <span class=m>1</span> --verbosity <span class=m>5</span> --networkid <span class=m>10</span> --rpc --rpcaddr 0.0.0.0 --rpcport <span class=m>22001</span> --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins<span class=o>=</span><span class=s2>&#34;*&#34;</span> --wsaddr 0.0.0.0 --wsport <span class=m>8546</span> --emitcheckpoints --port <span class=m>30301</span> 2&gt;&gt;node.log <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ../node2
</span></span><span class=line><span class=cl><span class=nv>PRIVATE_CONFIG</span><span class=o>=</span>ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod <span class=m>5</span> --syncmode full --mine --minerthreads <span class=m>1</span> --verbosity <span class=m>5</span> --networkid <span class=m>10</span> --rpc --rpcaddr 0.0.0.0 --rpcport <span class=m>22002</span> --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins<span class=o>=</span><span class=s2>&#34;*&#34;</span> --wsaddr 0.0.0.0 --wsport <span class=m>8547</span> --emitcheckpoints --port <span class=m>30302</span> 2&gt;&gt;node.log <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ../node3
</span></span><span class=line><span class=cl><span class=nv>PRIVATE_CONFIG</span><span class=o>=</span>ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod <span class=m>5</span> --syncmode full --mine --minerthreads <span class=m>1</span> --verbosity <span class=m>5</span> --networkid <span class=m>10</span> --rpc --rpcaddr 0.0.0.0 --rpcport <span class=m>22003</span> --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins<span class=o>=</span><span class=s2>&#34;*&#34;</span> --wsaddr 0.0.0.0 --wsport <span class=m>8548</span> --emitcheckpoints --port <span class=m>30303</span> 2&gt;&gt;node.log <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$
</span></span><span class=line><span class=cl>See <span class=k>if</span> the any geth nodes are running.
</span></span><span class=line><span class=cl>$ ps <span class=p>|</span> grep geth
</span></span><span class=line><span class=cl>Kill geth processes
</span></span><span class=line><span class=cl>$ killall -INT geth
</span></span><span class=line><span class=cl>$
</span></span><span class=line><span class=cl>$ chmod +x startall.sh
</span></span><span class=line><span class=cl>$ ./startall.sh
</span></span><span class=line><span class=cl>$ ps
</span></span><span class=line><span class=cl>   PID TTY          TIME CMD
</span></span><span class=line><span class=cl>  <span class=m>3740</span> pts/0    00:00:00 bash
</span></span><span class=line><span class=cl>  <span class=m>4057</span> pts/0    00:00:00 geth
</span></span><span class=line><span class=cl>  <span class=m>4058</span> pts/0    00:00:00 geth
</span></span><span class=line><span class=cl>  <span class=m>4059</span> pts/0    00:00:00 geth
</span></span><span class=line><span class=cl>  <span class=m>4060</span> pts/0    00:00:00 geth
</span></span><span class=line><span class=cl>  <span class=m>4119</span> pts/0    00:00:00 ps</span></span></code></pre></td></tr></table></div></div><p>第一次启动不需要使用<code>ps</code>和<code>killall</code>命令，只有之后忘记客户端是否启动的时候才需要</p><h3 id=62-树莓派>6.2 树莓派</h3><p>以 raspberry pi 3B+ 为例，介绍添加节点到当前网络的操作，raspberry pi 3B 操作相似。</p><p>在台式电脑中创建节点工作目录</p><div class=highlight id=id-40><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mkdir node4</span></span></code></pre></td></tr></table></div></div><p>进入工作目录，生成相关文件</p><div class=highlight id=id-41><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> node4
</span></span><span class=line><span class=cl>$ ../istanbul-tools/build/bin/istanbul setup --num <span class=m>1</span> --verbose --quorum --save
</span></span><span class=line><span class=cl>validators
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;Address&#34;</span>: <span class=s2>&#34;0x93b770a0d6f1b4eb8a96daf8a3f1e9a2d860696c&#34;</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;Nodekey&#34;</span>: <span class=s2>&#34;244857df9699fab362c80864888a497caa5d98d48cd87a9cebd12696fcb0289b&#34;</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;NodeInfo&#34;</span>: <span class=s2>&#34;enode://195c4a09528db47ba3625cbb21de2c8f0f15cf1a821a95e2decd46837369e7b1d192a7108b627a3840ece306baba38ca6c11ab0dc236a3542bc56ab9204eb75e@0.0.0.0:30303?discport=0&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>genesis.json
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;config&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;chainId&#34;</span>: 10,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;homesteadBlock&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;eip150Block&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;eip150Hash&#34;</span>: <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;eip155Block&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;eip158Block&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;byzantiumBlock&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;constantinopleBlock&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;istanbul&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;epoch&#34;</span>: 30000,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;policy&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;txnSizeLimit&#34;</span>: 64,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;isQuorum&#34;</span>: <span class=nb>true</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;nonce&#34;</span>: <span class=s2>&#34;0x0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timestamp&#34;</span>: <span class=s2>&#34;0x5e00afc6&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;extraData&#34;</span>: <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000f85ad59493b770a0d6f1b4eb8a96daf8a3f1e9a2d860696cb8410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;gasLimit&#34;</span>: <span class=s2>&#34;0xe0000000&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;difficulty&#34;</span>: <span class=s2>&#34;0x1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;mixHash&#34;</span>: <span class=s2>&#34;0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;coinbase&#34;</span>: <span class=s2>&#34;0x0000000000000000000000000000000000000000&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;alloc&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;93b770a0d6f1b4eb8a96daf8a3f1e9a2d860696c&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;balance&#34;</span>: <span class=s2>&#34;0x446c3b15f9926687d2c40534fdb564000000000000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;number&#34;</span>: <span class=s2>&#34;0x0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;gasUsed&#34;</span>: <span class=s2>&#34;0x0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;parentHash&#34;</span>: <span class=s2>&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><p>将产生的节点信息添加到node0目录的<code>static-nodes.json</code>文件，设置 IP 地址和端口号</p><div class=highlight id=id-42><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://7117f995cdb2d79eb90bc4a575c5f82bbe4aa6ac87f966b18e2e19bd29e728ba9ca85062a6af5c188bb159641392e2ac3559712d9a31e965220659412a4a8c3e@192.168.191.2:30300?discport=0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://cb790b57310d70bfb13e417e9dc22f3b0afc0065f4c5babc2f95e3ff75e99d343547585a0b2ad6be6f0497f401e93c16dadec5a68d820cb918fa0255696940f2@192.168.191.2:30301?discport=0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://0e6118122721993e84da84416cb9752a4b5c1b0077a915eb89d0cdff00862c3f13d9edc676c583997f6d9051245ba0f5587750d09d04482774a11f6d13a1c43b@192.168.191.2:30302?discport=0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://8d510973b1b245cb8cec8369948080b7e5adca90730112739307096ab445182415e92967de7096c013644f4b92025c7e29db23a145040cb3b9d46831fab0e8e2@192.168.191.2:30303?discport=0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enode://195c4a09528db47ba3625cbb21de2c8f0f15cf1a821a95e2decd46837369e7b1d192a7108b627a3840ece306baba38ca6c11ab0dc236a3542bc56ab9204eb75e@192.168.191.3:30303?discport=0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></td></tr></table></div></div><p>复制已运行区块链的<code>static-nodes.json</code>和<code>genesis.json</code>文件到当前节点相应目录</p><div class=highlight id=id-43><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cp ../node0/genesis.json .</span></span></code></pre></td></tr></table></div></div><p>复制新的<code>static-nodes.json</code>文件到所有节点的<code>data</code>目录</p><div class=highlight id=id-44><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mkdir -p data/geth
</span></span><span class=line><span class=cl>$ cp ../node0/static-nodes.json data
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>$ cp node0/static-nodes.json node0/data
</span></span><span class=line><span class=cl>$ cp node0/static-nodes.json node1/data
</span></span><span class=line><span class=cl>$ cp node0/static-nodes.json node2/data
</span></span><span class=line><span class=cl>$ cp node0/static-nodes.json node3/data</span></span></code></pre></td></tr></table></div></div><p>复制之前生成的 nodekey 到新节点工作目录的geth目录</p><div class=highlight id=id-45><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> node4
</span></span><span class=line><span class=cl>$ cp 0/nodekey data/geth</span></span></code></pre></td></tr></table></div></div><p>利用 win10 的远程桌面连接(xrdp已安装)或者 ftp 等文件(vsftpd已安装)传输协议，将 node4 整个工作目录复制到 raspberry pi 3B+ 中</p><p>生成节点账户并记录账户地址</p><div class=highlight id=id-46><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> node4
</span></span><span class=line><span class=cl>$ geth --datadir data account new</span></span></code></pre></td></tr></table></div></div><p>初始化节点</p><div class=highlight id=id-47><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ geth --datadir data init genesis.json</span></span></code></pre></td></tr></table></div></div><p>创建 start.sh 脚本用于启动节点，脚本基本内容如下</p><div class=highlight id=id-48><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nv>PRIVATE_CONFIG</span><span class=o>=</span>ignore nohup geth --datadir data --nodiscover --istanbul.blockperiod <span class=m>5</span> --syncmode full --verbosity <span class=m>5</span> --networkid <span class=m>10</span> --rpc --rpcaddr 0.0.0.0 --rpcport <span class=m>22000</span> --rpcapi admin,db,eth,debug,miner,net,shh,txpool,personal,web3,quorum,istanbul --ws --wsorigins<span class=o>=</span><span class=s2>&#34;*&#34;</span> --wsaddr 0.0.0.0 --wsport <span class=m>8545</span> --emitcheckpoints --port <span class=m>30303</span> 2&gt;&gt;node.log <span class=p>&amp;</span></span></span></code></pre></td></tr></table></div></div><p>授予 start.sh 脚本执行权限，执行该脚本</p><div class=highlight id=id-49><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.... 跳转到脚本所在目录
</span></span><span class=line><span class=cl>$ sudo chmod +x start.sh
</span></span><span class=line><span class=cl>$ ./start.sh</span></span></code></pre></td></tr></table></div></div><p>执行完后查找 geth 进程是否启动，并执行<code>geth attach</code>命令接入 geth 控制台</p><div class=highlight id=id-50><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ps <span class=p>|</span> grep geth
</span></span><span class=line><span class=cl> <span class=m>16877</span> pts/0    00:00:01 geth</span></span></code></pre></td></tr></table></div></div><p>接下来可在任一设备的节点目录下通过 websocket 进行操作。</p><p>至此利用 Quorum 搭建私链网络完毕，用作之后的实验平台，接下来进行交易验证、合约部署和测试。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2020-11-24 00:00:00">更新于 2020-11-24&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/2019/build-quorum-private-blockchain-network/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Pocket" data-sharer=pocket data-url=https://shuzang.github.io/2019/build-quorum-private-blockchain-network/><i class="fa-brands fa-get-pocket fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://shuzang.github.io/2019/build-quorum-private-blockchain-network/ data-title=研究记录6-Quorum区块链实验平台搭建><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95/ class=post-tag>科研记录</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2019/git-learning-deep-into/ class=post-nav-item rel=prev title="Git深入-子模块, 徽章, 开源协议"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Git深入-子模块, 徽章, 开源协议</a>
<a href=/2019/when-intrusion-detection-meets-blockchain-technology-a-review/ class=post-nav-item rel=next title="When Intrusion Detection Meets Blockchain Technology A Review">When Intrusion Detection Meets Blockchain Technology A Review<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-reward><div class=comment></div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>赞赏</label><div class=reward-ways data-mode=static><div><img loading=lazy src=/images/alipay.png srcset="/images/alipay.png, /images/alipay.png 1.5x, /images/alipay.png 2x" sizes=auto data-title="Shuzang 支付宝" data-alt="Shuzang 支付宝" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span>支付宝</span></div><div><img loading=lazy src=/images/wechatpay.png srcset="/images/wechatpay.png, /images/wechatpay.png 1.5x, /images/wechatpay.png 2x" sizes=auto data-title="Shuzang 微信" data-alt="Shuzang 微信" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span>微信</span></div></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom">Hava a great day !</div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/>Shuzang</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/shuzang/shuzang.github.io title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{enable:!1},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0}</script><script src=/js/theme.min.js defer></script></body></html>